{"componentChunkName":"component---src-templates-post-template-js","path":"/2019/11/jsf-ck-does-code-weirdness-affect-execution-performance","result":{"data":{"markdownRemark":{"fields":{"slug":"/2019/11/jsf-ck-does-code-weirdness-affect-execution-performance","tagSlugs":["/tag/javascript/","/tag/performance/","/tag/internals/"],"readTime":{"text":"16 min read","minutes":15.05}},"frontmatter":{"description":"Checking if how we write JS can change the performance of its execution even if it is the same code?","tags":["Javascript","Performance","Internals"],"date":"2019-11-07","title":"JSF*ck - Does code weirdness affect execution performance?"},"html":"<blockquote>\n<p>This post is created base on Martin Kleppe’s (<a href=\"https://twitter.com/aemkei\">@aemkei</a>) work about converting JS to only six basic characters and still keeping it executable. It is a response to comment from <a href=\"https://www.youtube.com/watch?v=sRWE5tnaxlI&#x26;lc=Ugw8lYvWtPQReYaahmZ4AaABAg\">Jonathan Means</a>.</p>\n</blockquote>\n<p>For those who are reading this out of the context, I’m going to spend a while explaining the problem before jumping to tests.</p>\n<h3 id=\"what-is-jsfck\"><a href=\"#what-is-jsfck\" aria-label=\"what is jsfck permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is JSF*ck?</h3>\n<p>Except for being NSFW, it’s a programming style that only using six characters to write and execute code in JS. We can do that because of sth called <strong>Type Coercion</strong>. JS coercion comes up once in a while on JS conferences (and mostly to make some funny video out of it), it’s purpose is to allow users to operate on a different type of types without explicitly casting them into one.</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"javascript\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">a</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;</span><span class=\"mtk4\">1</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">+</span><span class=\"mtk1\"> </span><span class=\"mtk5\">5</span><span class=\"mtk1\"> </span><span class=\"mtk3 mtki\">// &quot;15&quot;</span></span></span></code></pre>\n<p>The idea is great but sometimes (or more likely quite often) people don’t understand how it actually works under the hood. For those who are interested in the idea here is a link to the specification <a href=\"http://www.ecma-international.org/ecma-262/#sec-type-conversion\">http://www.ecma-international.org/ecma-262/#sec-type-conversion</a>.</p>\n<p>Most of those talks are picking some of the non-intuitive examples like</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"javascript\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">a</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> [] </span><span class=\"mtk6\">+</span><span class=\"mtk1\"> [] </span><span class=\"mtk3 mtki\">// &quot;&quot;</span></span></span></code></pre>\n<p>or one of the most famous one (<code>+ +\"a\"</code> returns <strong>“NaN”</strong>)</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"javascript\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">yellowFruit</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> (</span><span class=\"mtk6\">&quot;</span><span class=\"mtk4\">b</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">+</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;</span><span class=\"mtk4\">a</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">+</span><span class=\"mtk1\"> </span><span class=\"mtk6\">+&quot;</span><span class=\"mtk4\">a</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">+</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;</span><span class=\"mtk4\">a</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">)</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">toLocaleLowerCase</span><span class=\"mtk1\">() </span><span class=\"mtk3 mtki\">// &quot;banana&quot;</span></span></span></code></pre>\n<h3 id=\"what-can-we-do-with-that\"><a href=\"#what-can-we-do-with-that\" aria-label=\"what can we do with that permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What can we do with that?</h3>\n<p>Because of coercion we should be able to create any valid sentence in JavaScript (including evaluation). If we could do that, then we should be able to convert our code into sth like:</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"javascript\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3 mtki\">// 5+4</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">[</span><span class=\"mtk6\">!+</span><span class=\"mtk1\">[]</span><span class=\"mtk6\">+!+</span><span class=\"mtk1\">[]</span><span class=\"mtk6\">+!+</span><span class=\"mtk1\">[]</span><span class=\"mtk6\">+!+</span><span class=\"mtk1\">[]</span><span class=\"mtk6\">+!+</span><span class=\"mtk1\">[]]</span><span class=\"mtk6\">+</span><span class=\"mtk1\">(</span><span class=\"mtk6\">+</span><span class=\"mtk1\">(</span><span class=\"mtk6\">+!+</span><span class=\"mtk1\">[]</span><span class=\"mtk6\">+</span><span class=\"mtk1\">(</span><span class=\"mtk6\">!+</span><span class=\"mtk1\">[]</span><span class=\"mtk6\">+</span><span class=\"mtk1\">[])[</span><span class=\"mtk6\">!+</span><span class=\"mtk1\">[]</span><span class=\"mtk6\">+!+</span><span class=\"mtk1\">[]</span><span class=\"mtk6\">+!+</span><span class=\"mtk1\">[]]</span><span class=\"mtk6\">+</span><span class=\"mtk1\">[</span><span class=\"mtk6\">+!+</span><span class=\"mtk1\">[]]</span><span class=\"mtk6\">+</span><span class=\"mtk1\">[</span><span class=\"mtk6\">+</span><span class=\"mtk1\">[]]</span><span class=\"mtk6\">+</span><span class=\"mtk1\">[</span><span class=\"mtk6\">+</span><span class=\"mtk1\">[]])</span><span class=\"mtk6\">+</span><span class=\"mtk1\">[])[</span><span class=\"mtk6\">!+</span><span class=\"mtk1\">[]</span><span class=\"mtk6\">+!+</span><span class=\"mtk1\">[]]</span><span class=\"mtk6\">+</span><span class=\"mtk1\">[</span><span class=\"mtk6\">!+</span><span class=\"mtk1\">[]</span><span class=\"mtk6\">+!+</span><span class=\"mtk1\">[]</span><span class=\"mtk6\">+!+</span><span class=\"mtk1\">[]</span><span class=\"mtk6\">+!+</span><span class=\"mtk1\">[]]</span></span></span></code></pre>\n<p>Achieving this is not that straightforward as you might think.</p>\n<p>To get a number as a string you could use</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"javascript\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">+</span><span class=\"mtk1\">[] </span><span class=\"mtk3 mtki\">// &quot;0&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">+!+</span><span class=\"mtk1\">[] </span><span class=\"mtk3 mtki\">// &quot;1&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">[</span><span class=\"mtk6\">+!+</span><span class=\"mtk1\">[]]</span><span class=\"mtk6\">+</span><span class=\"mtk1\">[</span><span class=\"mtk6\">+</span><span class=\"mtk1\">[]] </span><span class=\"mtk3 mtki\">// &quot;10</span></span></span></code></pre>\n<p>Getting strings is even more difficult</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"javascript\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">[][[]][</span><span class=\"mtk6\">!+</span><span class=\"mtk1\">[]</span><span class=\"mtk6\">+!+</span><span class=\"mtk1\">[]] </span><span class=\"mtk3 mtki\">// &quot;d&quot; or &quot;undefined&quot;[2]</span></span></span></code></pre>\n<p>It is using the fact that strings could be accessed as an array of chars and you can generate <strong>“undefined”</strong> string quite easily by calling <code>[][[]]</code>.</p>\n<p>I’m not going to explain every single one of them in detail. There is a great video released by LowLevelJS <a href=\"https://www.youtube.com/watch?v=sRWE5tnaxlI\">https://www.youtube.com/watch?v=sRWE5tnaxlI</a> that covers the topic. If you want to play with it please go to <a href=\"http://www.jsfuck.com/\">http://www.jsfuck.com/</a> and try your code in there.</p>\n<h3 id=\"implications-on-performance\"><a href=\"#implications-on-performance\" aria-label=\"implications on performance permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Implications on performance</h3>\n<p>As you might notice writing down the whole bunch of code this way is quite space expensive. I’ve managed to parse some of the test code into JSF convention and code which looks like</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"javascript\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">startT1</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtkb\">Date</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">now</span><span class=\"mtk1\">()</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">N</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">10000</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">let</span><span class=\"mtk1\"> </span><span class=\"mtk7\">f</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> tmp</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp2</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp3</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp4</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp5</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> a</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Gandalf</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> b</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">The Grey</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">let</span><span class=\"mtk1\"> </span><span class=\"mtk7\">f2</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> tmp</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp2</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp3</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp4</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp5</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> a</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Jack</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> b</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Sparrow</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">let</span><span class=\"mtk1\"> </span><span class=\"mtk7\">f3</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> tmp</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp2</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp3</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp4</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp5</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> a</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Charles</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> b</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Xavier</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">let</span><span class=\"mtk1\"> </span><span class=\"mtk7\">f4</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> tmp</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp2</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp3</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp4</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp5</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> a</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Frodo</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> b</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Baggins</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">let</span><span class=\"mtk1\"> </span><span class=\"mtk7\">f5</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> tmp</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp2</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp3</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp4</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp5</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> a</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Legolas</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> b</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Thranduilion</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">let</span><span class=\"mtk1\"> </span><span class=\"mtk7\">f6</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> tmp</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp2</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp3</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp4</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> tmp5</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> a</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Indiana</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> b</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Jones</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">function</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk6\">(</span><span class=\"mtk7\">obj</span><span class=\"mtk6\">)</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">let</span><span class=\"mtk1\"> </span><span class=\"mtk7\">result</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;&#39;;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk7\">let</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">0</span><span class=\"mtk6\">;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">N</span><span class=\"mtk6\">;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">+=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">1</span><span class=\"mtk1\">) </span><span class=\"mtk6\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">result</span><span class=\"mtk1\"> </span><span class=\"mtk6\">+=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">obj</span><span class=\"mtk6\">.</span><span class=\"mtk7\">a</span><span class=\"mtk1\"> </span><span class=\"mtk6\">+</span><span class=\"mtk1\"> </span><span class=\"mtk7\">obj</span><span class=\"mtk6\">.</span><span class=\"mtk7\">b</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">result</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">for</span><span class=\"mtk1\">(</span><span class=\"mtk7\">let</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">0</span><span class=\"mtk6\">;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">N</span><span class=\"mtk6\">;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">+=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">1</span><span class=\"mtk1\">) </span><span class=\"mtk6\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk7\">f</span><span class=\"mtk1\">)</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk7\">f2</span><span class=\"mtk1\">)</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk7\">f3</span><span class=\"mtk1\">)</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk7\">f4</span><span class=\"mtk1\">)</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk7\">f5</span><span class=\"mtk1\">)</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk7\">f6</span><span class=\"mtk1\">)</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7 mtkb\">console</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">log</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;</span><span class=\"mtk4\">test with one shape:</span><span class=\"mtk6\">&quot;,</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtkb\">Date</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">now</span><span class=\"mtk1\">() </span><span class=\"mtk6\">-</span><span class=\"mtk1\"> </span><span class=\"mtk7\">startT1</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;</span><span class=\"mtk4\">ms.</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">)</span><span class=\"mtk6\">;</span></span></span></code></pre>\n<p>Parses into 847192 lines long string. So instead of having >1KB file, we have 828KB now. You can get that code <a href=\"https://gist.github.com/burnpiro/5a177d8bb307005c4d8f5672fe9ff0a3\">Here</a> and execute it just by calling <code>node index.js</code>.</p>\n<h4 id=\"its-time-to-start-testing-our-code\"><a href=\"#its-time-to-start-testing-our-code\" aria-label=\"its time to start testing our code permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>It’s time to start testing our code!!!</h4>\n<p>Test Env:</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Ubuntu 18.04</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Node 12.13.0</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Intel i7-7820X</span></span></code></pre>\n<p>Test examples:</p>\n<ul>\n<li>standard call - <a href=\"https://gist.github.com/burnpiro/56be270ac032924faf48824e08995687\">https://gist.github.com/burnpiro/56be270ac032924faf48824e08995687</a></li>\n<li>string eval - <a href=\"https://gist.github.com/burnpiro/ffaa8edac33370e1aa5126c83fb728bb\">https://gist.github.com/burnpiro/ffaa8edac33370e1aa5126c83fb728bb</a></li>\n<li>JSF eval - <a href=\"https://gist.github.com/burnpiro/5a177d8bb307005c4d8f5672fe9ff0a3\">https://gist.github.com/burnpiro/5a177d8bb307005c4d8f5672fe9ff0a3</a></li>\n</ul>\n<p>I’m testing standard function twice be able to spot the difference in <code>eval</code> execution.</p>\n<h5 id=\"test-results\"><a href=\"#test-results\" aria-label=\"test results permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Test Results:</h5>\n<p>standard call (50 samples)</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">AVG: 3274ms</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Std. Dev: 7ms</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Heap: 8.06MB</span></span></code></pre>\n<p>string eval (50 samples)</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">AVG: 3272ms</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Std. Dev: 6ms</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Heap: 8.08MB</span></span></code></pre>\n<p>JSF eval (50 samples):</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">AVG: 3241ms</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Std. Dev: 8ms</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Heap: 18.88MB</span></span></code></pre>\n<blockquote>\n<p>NOTE! Values on your machine might be different because you’re using different version of nodeJS or different processor. </p>\n</blockquote>\n<h3 id=\"conclusions\"><a href=\"#conclusions\" aria-label=\"conclusions permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusions</h3>\n<p>There is no difference in execution performance between different versions of the same code in V8 (node). It was an expected but important thing to see here is the amount of memory used by V8. There is almost no difference between evaluation and standard function call, but parsing your code to JSF takes a lot more memory than the original one.</p>\n<p>It’s not that surprising if you look at it. Storing and parsing almost 1MB file in JS Engine should take a lot more memory than a 1KB file.</p>\n<p>Even if JSF code is not practical people might get a better understanding of how JS works just by reading some of it. Type coercion is not some magic as many people on twitter things. I know that <strong><em>“Any sufficiently advanced technology is indistinguishable from magic”</em></strong> (Clarke’s First Law) but I like to rephrase that: <strong><em>“Any incomprehensible technology is indistinguishable from magic”</em></strong>. If you can understand it, it’s not magic any more :)</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .quiet-light { background-color: #F5F5F5; }\n  .quiet-light .mtkb { font-weight: bold; }\n  .quiet-light .mtki { font-style: italic; }\n  .quiet-light .mtk7 { color: #7A3E9D; }\n  .quiet-light .mtk1 { color: #333333; }\n  .quiet-light .mtk6 { color: #777777; }\n  .quiet-light .mtk4 { color: #448C27; }\n  .quiet-light .mtk5 { color: #9C5D27; }\n  .quiet-light .mtk3 { color: #AAAAAA; }\n  .quiet-light .mtk9 { color: #AA3731; }\n  .quiet-light .mtk10 { color: #4B69C6; }\n  .quiet-light .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));\n  }\n</style>"}},"pageContext":{"slug":"/2019/11/jsf-ck-does-code-weirdness-affect-execution-performance"}}}