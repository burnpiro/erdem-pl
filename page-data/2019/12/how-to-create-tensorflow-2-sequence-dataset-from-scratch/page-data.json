{"componentChunkName":"component---src-templates-post-template-js","path":"/2019/12/how-to-create-tensorflow-2-sequence-dataset-from-scratch","result":{"data":{"markdownRemark":{"fields":{"slug":"/2019/12/how-to-create-tensorflow-2-sequence-dataset-from-scratch","tagSlugs":["/tag/tensorflow/","/tag/machine-learning/","/tag/ai/","/tag/data/"],"readTime":{"text":"41 min read","minutes":40.516666666666666}},"frontmatter":{"description":"How to create your own Dataset for Tensorflow model training by extending Sequence class?","tags":["Tensorflow","Machine Learning","AI","Data"],"date":"2019-12-28","title":"How to create Tensorflow 2 Sequence Dataset from scratch","img":{"publicURL":"/static/11eabe31675d3e4b757b0582e281ab7c/dataset.png"}},"html":"<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1280px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 26.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABPElEQVQY0wExAc7+AEFgKU5qM1RzNkNdL0p5MFt3N1JzPF19PEJgLzhQKGppVmg1FIFvWHSXUXSBU2xNQEckCmNuXnaRWbixswBPYTpNaDVPcDJKWDZiik91ilZZcD9QdDxHVSxWRjRveVUkHhhTWFFWYTp/iWQ4PzUUGAlDTUdcZ0PdoaYAdW5aaHVOX21BjIppg4dkS1U3RlAzIyUnb1xNX0w6YlpZHBkeX1VUam9siJGQRDU6JBUXX19mdm1o6rS0AHtrZL62sxsYEWtIQ3J5TkxTOyssIDIsJEY6L0tHTmVfZFEzKlpSUXyhiHqQcEY2OjQ0NVxiWoWRbIqhegChnZp/fXcREA8bGxkqLSpLR0M/ODcgISEnJSBhZ213dX5CKy9mZEakmYqhgYJHVEAlOzFFXFxaaWJlamTgVWYBIEfrfwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Dataset Example\" title=\"Dataset Example\" src=\"/static/11eabe31675d3e4b757b0582e281ab7c/21b4d/dataset.png\" srcset=\"/static/11eabe31675d3e4b757b0582e281ab7c/72799/dataset.png 320w,\n/static/11eabe31675d3e4b757b0582e281ab7c/6af66/dataset.png 640w,\n/static/11eabe31675d3e4b757b0582e281ab7c/21b4d/dataset.png 1280w,\n/static/11eabe31675d3e4b757b0582e281ab7c/29114/dataset.png 1920w,\n/static/11eabe31675d3e4b757b0582e281ab7c/373fb/dataset.png 2068w\" sizes=\"(max-width: 1280px) 100vw, 1280px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>Image source: https://swinghu.github.io/assets/face-detection-recognition/From_Facial_Parts_Responses_to_Face_Detection_A_Deep_Learning_Approach_index.png</figcaption>\n</figure>\n<h2 id=\"the-problem\" style=\"position:relative;\"><a href=\"#the-problem\" aria-label=\"the problem permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The problem</h2>\n<p>Modern Machine Learning solutions require a huge amount of data, that’s definitely the case when working with image recognition/object detection. Because of that, we need to create more and more complex datasets to teach our models. At this moment we cannot store the whole thing in the memory (sometimes even hard drive has a problem), quite often a description of that dataset is not directly readable by Tensorflow’s <strong>Dataset</strong>. That’s why we need to create a modern solution to handle and preprocess an enormous amount of data in easy to understand way using Sequences.</p>\n<blockquote>\n<p><strong>TLDR</strong>:</p>\n<p>Here is a code: <a href=\"https://gist.github.com/burnpiro/c3835a1f914545f2034f4190b1e83153\">https://gist.github.com/burnpiro/c3835a1f914545f2034f4190b1e83153</a></p>\n<p>Use Sequences to make datasets maintainable and fast.</p>\n</blockquote>\n<h2 id=\"what-is-the-sequence\" style=\"position:relative;\"><a href=\"#what-is-the-sequence\" aria-label=\"what is the sequence permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is the Sequence?</h2>\n<p>According to documentation, Sequence is:</p>\n<blockquote>\n<p><strong>Base object for fitting to a sequence of data, such as a dataset.</strong></p>\n</blockquote>\n<p>Sequence object is created using <a href=\"https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/keras/utils/data_utils.py#L331-L406\"><strong>Sequence Class</strong></a>. The best thing about it is that we can extend it. Every Sequence has to implement 3 methods:</p>\n<ul>\n<li><code>__getitem__</code> - used to extract an item from dataset</li>\n<li><code>__len__</code> - returns the length of our dataset</li>\n<li><code>__init__</code> - initializing our dataset (this one is not required but we need some kind of initialization)</li>\n</ul>\n<p>Sequence allows us to create complex datasets and even modify them at the end of each epoch by implementing <code>on_epoch_end</code>. We’re going to focus only on those 3 methods but if you can you can play with <code>on_epoch_end</code>.</p>\n<h2 id=\"our-test-dataset\" style=\"position:relative;\"><a href=\"#our-test-dataset\" aria-label=\"our test dataset permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Our Test Dataset</h2>\n<p>In our example, we’re going to use WIDER FACE dataset</p>\n<blockquote>\n<p>Instruction how to get dataset is <a href=\"https://github.com/burnpiro/tiny-face-detection-tensorflow2#dataset\">Here</a></p>\n</blockquote>\n<p>This dataset contains over 32k images and weights around 2GB so we don’t really want to keep it in the memory all the time. This dataset is used to teach object detection models so it contains bounding boxes for every face on the image.</p>\n<h3 id=\"data-structure\" style=\"position:relative;\"><a href=\"#data-structure\" aria-label=\"data structure permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Data structure</h3>\n<p>Dataset is already split into <strong>Train</strong> and <strong>Validation</strong> so we don’t have to do it again. We have two folders: <strong>WIDER_train</strong> and <strong>WIDER_val</strong>. The image description is stored in <code>wider_face_train_bbx_gt.txt</code> and <code>wider_face_val_bbx_gt.txt</code>. Here is an example of one of the images</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAQBAwL/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAefijibOrG5OLYDf/8QAHBAAAgICAwAAAAAAAAAAAAAAAQIAEQMEEhMy/9oACAEBAAEFAjqMB0VALh9PYiIoXG5zrXEkz//EABkRAAEFAAAAAAAAAAAAAAAAAAABAhARQf/aAAgBAwEBPwFCh+R//8QAGBEAAgMAAAAAAAAAAAAAAAAAAAIQIUH/2gAIAQIBAT8BKF2P/8QAHhAAAgMAAQUAAAAAAAAAAAAAAAECETEQMkJRgZH/2gAIAQEABj8CbUotHUl5Nh9Hd7rHGrs7fbJRnhSb4//EABsQAQADAQEBAQAAAAAAAAAAAAEAESExUUFx/9oACAEBAAE/IQSIvHY26EBa4RxYpfWQ6wIPSogYCm/aOQjZfr0lRFisjxYPsTPyf//aAAwDAQACAAMAAAAQQMgA/8QAGREAAgMBAAAAAAAAAAAAAAAAAAEQESEx/9oACAEDAQE/EKPgg2w//8QAGBEBAQADAAAAAAAAAAAAAAAAAQAQETH/2gAIAQIBAT8Q0nZYcP/EAB4QAQEAAgIDAQEAAAAAAAAAAAERACExQWGRsVGB/9oACAEBAAE/EHgrQp6YQ7t9CuuOnU/vGJKQAQoMs/MDHEJa4NfPWSsWbRdh2QwdpGy29Z1wi1k3TzcRSoLyT5h0LYPHzP/Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Image Example\" title=\"Image Example\" src=\"/static/1fbd4b1b30208290b1eca0b275330f4d/72e01/22_Picnic_Picnic_22_277.jpg\" srcset=\"/static/1fbd4b1b30208290b1eca0b275330f4d/cb69c/22_Picnic_Picnic_22_277.jpg 320w,\n/static/1fbd4b1b30208290b1eca0b275330f4d/c08c5/22_Picnic_Picnic_22_277.jpg 640w,\n/static/1fbd4b1b30208290b1eca0b275330f4d/72e01/22_Picnic_Picnic_22_277.jpg 1024w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>Image source: WIDER FACE dataset</figcaption>\n</figure>\n<p>Description for that image in <code>.txt</code> file is as follows:</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">22--Picnic/22_Picnic_Picnic_22_277.jpg</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">3</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">196 410 74 114 1 0 0 0 0 0 </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">344 404 62 88 1 0 0 0 0 0 </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">634 222 58 86 1 0 0 0 0 0 </span></span></code></pre>\n<p>It might seem unclear at first but everything is explained in Dataset’s Readme file:</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">File name</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Number of bounding box</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">x1, y1, w, h, blur, expression, illumination, invalid, occlusion, pose</span></span></code></pre>\n<p>So our image contains 3 boxes. The first two numbers are X and Y coordinates followed by box width and height. After that we have more information about the face inside the box, we’re not going to use those ones because our goal is just object detection (face detection) but feel free to check Readme file for properties description.</p>\n<h2 id=\"models-input-and-output\" style=\"position:relative;\"><a href=\"#models-input-and-output\" aria-label=\"models input and output permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Model’s input and output</h2>\n<p>Now after we know how our dataset looks like we need to figure out what is an input and output of our <strong>Model</strong>.</p>\n<blockquote>\n<p>You can skip this section if you want. It’s not necessary to know anything more than the input and output size of the model to construct training examples.</p>\n<ul>\n<li>Input - <strong>224x224x3</strong></li>\n<li>Output - <strong>7x7x5</strong></li>\n</ul>\n<p>Imho, it’s beneficial to understand it but not required. I’ve selected this model because most of the guides are using simple examples from regression networks and it’s hard to find a solution for a complex one.</p>\n</blockquote>\n<p>For this example, we’re going to use <strong>MobileNetV2</strong> (<code>mobilenet_v2_0.75_224</code> to be precise), our model has an input size of <strong>224x224x3</strong> (width x height x RGB). So every example in our sentence has to produce input of that size.</p>\n<p>Output, on the other hand, is completely up to us. We’re using MobileNet as a feature extractor that gives us output from the last Conv layer of <strong>7x7x240</strong>. We want to keep 7x7 grid and our detection requires only 5 values per grid (because we have only one class). In the end, our output should look like <strong>7x7x5</strong> (grid width x grid width x number of classes times 5).</p>\n<p>I’m not going to discuss how this network works, you can easily find any tutorial on CNNs and how to use them as a feature extractor for object detection (maybe some other guide in the future).</p>\n<p>This is how our model looks like at the end:</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">__________________________________________________________________________________________________</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Layer (type)                    Output Shape         Param #     Connected to                     </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">==================================================================================================</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">input_1 (InputLayer)            [(None, 224, 224, 3) 0                   </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">________________________________________________________________________</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                         </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">----- Rest of MobileNetV2 ------</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">__________________________________________________________________________________________________</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">block_16_project_BN (BatchNorma (None, 7, 7, 240)    960         block_16_project[0][0]           </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">__________________________________________________________________________________________________</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">----- Our Layers conected to MobileNet output------    </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">__________________________________________________________________________________________________</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">conv2d_2 (Conv2D)               (None, 7, 7, 5)      1205        activation[0][0]                 </span></span></code></pre>\n<p>Now it should be clear that our Dataset should generate examples like:</p>\n<ul>\n<li>Input - <strong>224x224x3</strong></li>\n<li>Output - <strong>7x7x5</strong></li>\n</ul>\n<h2 id=\"extend-sequence-class\" style=\"position:relative;\"><a href=\"#extend-sequence-class\" aria-label=\"extend sequence class permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Extend Sequence Class</h2>\n<pre class=\"grvsc-container quiet-light\" data-language=\"python\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3 mtki\"># Data generator boilerplace</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtkb\">DataGenerator</span><span class=\"mtk6\">(</span><span class=\"mtk7 mtkb\">tf</span><span class=\"mtk6\">.</span><span class=\"mtk7 mtkb\">keras</span><span class=\"mtk6\">.</span><span class=\"mtk7 mtkb\">utils</span><span class=\"mtk6\">.</span><span class=\"mtk7 mtkb\">Sequence</span><span class=\"mtk6\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">__init__</span><span class=\"mtk6\">(</span><span class=\"mtk7\">self</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk7\">file_path</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk7\">config_path</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk7\">debug</span><span class=\"mtk6\">=</span><span class=\"mtk5\">False</span><span class=\"mtk6\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3 mtki\"># Sequence initialization</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">__len__</span><span class=\"mtk6\">(</span><span class=\"mtk7\">self</span><span class=\"mtk6\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3 mtki\"># Should return Sequence length</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">__getitem__</span><span class=\"mtk6\">(</span><span class=\"mtk7\">self</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk7\">idx</span><span class=\"mtk6\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3 mtki\"># Returns preprocessed data</span></span></span></code></pre>\n<h3 id=\"initialization\" style=\"position:relative;\"><a href=\"#initialization\" aria-label=\"initialization permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Initialization</h3>\n<p>The first thing we need to implement is data initialization. </p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"python\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">__init__</span><span class=\"mtk6\">(</span><span class=\"mtk7\">self</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk7\">file_path</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk7\">config_path</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk7\">debug</span><span class=\"mtk6\">=</span><span class=\"mtk5\">False</span><span class=\"mtk6\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3 mtki\"># Sequence initialization</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span></span></span></code></pre>\n<p>Because dataset description is located in two different files (one for training and one for validation) we need to pass paths to the folder with images (<code>file_path</code>) and the path to our dataset spec (<code>config_path</code>). <code>debug</code> options allow us to display additional messages when processing dataset.</p>\n<p>Inside <code>__init__</code> method we have access to <code>self</code> object. This object represents our sequence and we want to initialize some default values on it.</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"python\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">self</span><span class=\"mtk6\">.</span><span class=\"mtk1\">boxes </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">[]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">self</span><span class=\"mtk6\">.</span><span class=\"mtk1\">debug </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> debug</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">self</span><span class=\"mtk6\">.</span><span class=\"mtk1\">data_path </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> file_path</span></span></span></code></pre>\n<ul>\n<li><code>self.boxes</code> is going to store all boxes definitions from dataset</li>\n<li><code>self.debug</code> enables <strong>debug</strong> mode</li>\n<li><code>self.data_path</code> stores path to images for later processing</li>\n</ul>\n<p>After initialization, we need to check if paths are valid (if not there is no reason to create Sequence).</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"python\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">if</span><span class=\"mtk1\"> </span><span class=\"mtk6\">not</span><span class=\"mtk1\"> os</span><span class=\"mtk6\">.</span><span class=\"mtk1\">path</span><span class=\"mtk6\">.</span><span class=\"mtk1\">isfile</span><span class=\"mtk6\">(</span><span class=\"mtk1\">config_path</span><span class=\"mtk6\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtkb\">print</span><span class=\"mtk6\">(&quot;</span><span class=\"mtk4\">File path </span><span class=\"mtk5\">{}</span><span class=\"mtk4\"> does not exist. Exiting...</span><span class=\"mtk6\">&quot;.</span><span class=\"mtk1\">format</span><span class=\"mtk6\">(</span><span class=\"mtk1\">config_path</span><span class=\"mtk6\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    sys</span><span class=\"mtk6\">.</span><span class=\"mtk1\">exit</span><span class=\"mtk6\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">if</span><span class=\"mtk1\"> </span><span class=\"mtk6\">not</span><span class=\"mtk1\"> os</span><span class=\"mtk6\">.</span><span class=\"mtk1\">path</span><span class=\"mtk6\">.</span><span class=\"mtk1\">isdir</span><span class=\"mtk6\">(</span><span class=\"mtk1\">file_path</span><span class=\"mtk6\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtkb\">print</span><span class=\"mtk6\">(&quot;</span><span class=\"mtk4\">Images folder path </span><span class=\"mtk5\">{}</span><span class=\"mtk4\"> does not exist. Exiting...</span><span class=\"mtk6\">&quot;.</span><span class=\"mtk1\">format</span><span class=\"mtk6\">(</span><span class=\"mtk1\">file_path</span><span class=\"mtk6\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    sys</span><span class=\"mtk6\">.</span><span class=\"mtk1\">exit</span><span class=\"mtk6\">()</span></span></span></code></pre>\n<p>When everything is correct we can start reading config file</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"python\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">with</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">open</span><span class=\"mtk6\">(</span><span class=\"mtk1\">config_path</span><span class=\"mtk6\">)</span><span class=\"mtk1\"> </span><span class=\"mtk10\">as</span><span class=\"mtk1\"> fp</span><span class=\"mtk6\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    image_name </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> fp</span><span class=\"mtk6\">.</span><span class=\"mtk1\">readline</span><span class=\"mtk6\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    cnt </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">while</span><span class=\"mtk1\"> image_name</span><span class=\"mtk6\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3 mtki\"># image_name - relative path to our image</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3 mtki\"># in this loop we have to process each image definition</span></span></span></code></pre>\n<p>We’re going to read this file line by line but as you remember file is structured in a specific way:</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">File name</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Number of bounding box</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">x1, y1, w, h, blur, expression, illumination, invalid, occlusion, pose</span></span></code></pre>\n<p>So after reading <strong>File name</strong> and <strong>Number of bounding box</strong> we need to use that number to know how many lines to read as bounding boxes definition.</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"python\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">with</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">open</span><span class=\"mtk6\">(</span><span class=\"mtk1\">config_path</span><span class=\"mtk6\">)</span><span class=\"mtk1\"> </span><span class=\"mtk10\">as</span><span class=\"mtk1\"> fp</span><span class=\"mtk6\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    image_name </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> fp</span><span class=\"mtk6\">.</span><span class=\"mtk1\">readline</span><span class=\"mtk6\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    cnt </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">while</span><span class=\"mtk1\"> image_name</span><span class=\"mtk6\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        num_of_obj </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">int</span><span class=\"mtk6\">(</span><span class=\"mtk1\">fp</span><span class=\"mtk6\">.</span><span class=\"mtk1\">readline</span><span class=\"mtk6\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">for</span><span class=\"mtk1\"> i </span><span class=\"mtk6\">in</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">range</span><span class=\"mtk6\">(</span><span class=\"mtk1\">num_of_obj</span><span class=\"mtk6\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            obj_box </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> fp</span><span class=\"mtk6\">.</span><span class=\"mtk1\">readline</span><span class=\"mtk6\">().</span><span class=\"mtk1\">split</span><span class=\"mtk6\">(&#39;</span><span class=\"mtk4\"> </span><span class=\"mtk6\">&#39;)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            x0</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> y0</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> w</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> h </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> get_box</span><span class=\"mtk6\">(</span><span class=\"mtk1\">obj_box</span><span class=\"mtk6\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> w </span><span class=\"mtk6\">==</span><span class=\"mtk1\"> </span><span class=\"mtk5\">0</span><span class=\"mtk6\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3 mtki\"># remove boxes with no width</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk10\">continue</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> h </span><span class=\"mtk6\">==</span><span class=\"mtk1\"> </span><span class=\"mtk5\">0</span><span class=\"mtk6\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3 mtki\"># remove boxes with no height</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk10\">continue</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk5\">self</span><span class=\"mtk6\">.</span><span class=\"mtk1\">boxes</span><span class=\"mtk6\">.</span><span class=\"mtk1\">append</span><span class=\"mtk6\">((</span><span class=\"mtk1\">image_name</span><span class=\"mtk6\">.</span><span class=\"mtk1\">strip</span><span class=\"mtk6\">(),</span><span class=\"mtk1\"> x0</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> y0</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> w</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> h</span><span class=\"mtk6\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        image_name </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> fp</span><span class=\"mtk6\">.</span><span class=\"mtk1\">readline</span><span class=\"mtk6\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        cnt </span><span class=\"mtk6\">+=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">1</span></span></span></code></pre>\n<p>The first thing we have to do inside <code>while</code> loop is to extract how many boxes there are. To do this we’re calling <code>int(tf.readline()</code> which returns next line value as an integer. We’re using this number to iterate through the next <code>num_of_obj</code> lines. Each line values are separated by an empty string so we have to split values before processing <code>obj_box = fp.readline().split(' ')</code>. We’re interested in the first 4 values from each line but those values have to be integers. To extract those values it’s easier to create a helper function <code>get_box</code>:</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"python\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3 mtki\"># Input: [x0, y0, w, h, blur, expression, illumination, invalid, occlusion, pose]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3 mtki\"># Output: x0, y0, w, h</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">get_box</span><span class=\"mtk6\">(</span><span class=\"mtk7\">data</span><span class=\"mtk6\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    x0 </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">int</span><span class=\"mtk6\">(</span><span class=\"mtk1\">data</span><span class=\"mtk6\">[</span><span class=\"mtk5\">0</span><span class=\"mtk6\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    y0 </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">int</span><span class=\"mtk6\">(</span><span class=\"mtk1\">data</span><span class=\"mtk6\">[</span><span class=\"mtk5\">1</span><span class=\"mtk6\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    w </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">int</span><span class=\"mtk6\">(</span><span class=\"mtk1\">data</span><span class=\"mtk6\">[</span><span class=\"mtk5\">2</span><span class=\"mtk6\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    h </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">int</span><span class=\"mtk6\">(</span><span class=\"mtk1\">data</span><span class=\"mtk6\">[</span><span class=\"mtk5\">3</span><span class=\"mtk6\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> x0</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> y0</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> w</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> h</span></span></span></code></pre>\n<p>This function receives a list of strings and returns 4 integers we need. After that, we’re appending our box to Sequence object <code>self.boxes.append((image_name.strip(), x0, y0, w, h))</code> and read the next line.</p>\n<p>Everything seems fine and we should be ready to move to the next part, but if we try to execute this code it will fail.</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"bash\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">ValueError: invalid literal </span><span class=\"mtk10\">for</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">int</span><span class=\"mtk6\">()</span><span class=\"mtk1\"> with base 10: </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">0--Parade/0_Parade_Parade_0_630.jpg\\n</span><span class=\"mtk6\">&#39;</span></span></span></code></pre>\n<p>Did we make a mistake in the code? No, we didn’t. We just didn’t explore our dataset carefully enough. If we jump to our <strong>.txt</strong> file and find the line with that sentence it’s much clearer what just happen.</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">0--Parade/0_Parade_Parade_0_452.jpg</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">0</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">0 0 0 0 0 0 0 0 0 0 </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">0--Parade/0_Parade_Parade_0_630.jpg</span></span></code></pre>\n<p>We didn’t anticipate there are images without faces and because of how our iteration is designed it’s not going to skip line with zeros after reading <code>num_of_obj = 0</code>. Knowing that we can create a quick fix just after for loop:</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"python\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">if</span><span class=\"mtk1\"> num_of_obj </span><span class=\"mtk6\">==</span><span class=\"mtk1\"> </span><span class=\"mtk5\">0</span><span class=\"mtk6\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    obj_box </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> fp</span><span class=\"mtk6\">.</span><span class=\"mtk1\">readline</span><span class=\"mtk6\">().</span><span class=\"mtk1\">split</span><span class=\"mtk6\">(&#39;</span><span class=\"mtk4\"> </span><span class=\"mtk6\">&#39;)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    x0</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> y0</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> w</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> h </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> get_box</span><span class=\"mtk6\">(</span><span class=\"mtk1\">obj_box</span><span class=\"mtk6\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">self</span><span class=\"mtk6\">.</span><span class=\"mtk1\">boxes</span><span class=\"mtk6\">.</span><span class=\"mtk1\">append</span><span class=\"mtk6\">((</span><span class=\"mtk1\">image_name</span><span class=\"mtk6\">.</span><span class=\"mtk1\">strip</span><span class=\"mtk6\">(),</span><span class=\"mtk1\"> x0</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> y0</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> w</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> h</span><span class=\"mtk6\">))</span></span></span></code></pre>\n<p>That way, when there are no faces on an image we’re going to create an empty example.</p>\n<h3 id=\"return-length-of-the-dataset\" style=\"position:relative;\"><a href=\"#return-length-of-the-dataset\" aria-label=\"return length of the dataset permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Return length of the dataset</h3>\n<p>That should be easy… But it isn’t :) When implementing <code>__len__</code> method we need to remember that training works in batches. Because of that, we have to divide the number of boxes by our batch size and return that instead of just the length of our array.</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"python\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">__len__</span><span class=\"mtk6\">(</span><span class=\"mtk7\">self</span><span class=\"mtk6\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> math</span><span class=\"mtk6\">.</span><span class=\"mtk1\">ceil</span><span class=\"mtk6\">(</span><span class=\"mtk9 mtkb\">len</span><span class=\"mtk6\">(</span><span class=\"mtk5\">self</span><span class=\"mtk6\">.</span><span class=\"mtk1\">boxes</span><span class=\"mtk6\">)</span><span class=\"mtk1\"> </span><span class=\"mtk6\">/</span><span class=\"mtk1\"> cfg</span><span class=\"mtk6\">.</span><span class=\"mtk5\">TRAIN</span><span class=\"mtk6\">.</span><span class=\"mtk5\">BATCH_SIZE</span><span class=\"mtk6\">)</span></span></span></code></pre>\n<p>Notice that we’re using a mysterious config called <code>cfg</code>. This is just an <code>EasyDict</code> dictionary that holds our dataset settings. You don’t have to worry about it right now, I’ll show you its definition at the end. For now, just assume that it stores all config values.</p>\n<h3 id=\"returning-items\" style=\"position:relative;\"><a href=\"#returning-items\" aria-label=\"returning items permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Returning items</h3>\n<p>Till now we’ve managed to create our Sequence but we still didn’t define how to process images in the dataset. Each box in Sequence has 5 values:</p>\n<ul>\n<li>path to image</li>\n<li>x value for box center</li>\n<li>y value for box center</li>\n<li>box width</li>\n<li>box height</li>\n</ul>\n<p><code>__getitem__(self, idx)</code> method should return two values (input, output). But because we’re working in batches those values will be arrays with multiple images and corresponding boxes.</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"python\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">__getitem__</span><span class=\"mtk6\">(</span><span class=\"mtk7\">self</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk7\">idx</span><span class=\"mtk6\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    boxes </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">self</span><span class=\"mtk6\">.</span><span class=\"mtk1\">boxes</span><span class=\"mtk6\">[</span><span class=\"mtk1\">idx </span><span class=\"mtk6\">*</span><span class=\"mtk1\"> cfg</span><span class=\"mtk6\">.</span><span class=\"mtk5\">TRAIN</span><span class=\"mtk6\">.</span><span class=\"mtk5\">BATCH_SIZE</span><span class=\"mtk6\">:(</span><span class=\"mtk1\">idx </span><span class=\"mtk6\">+</span><span class=\"mtk1\"> </span><span class=\"mtk5\">1</span><span class=\"mtk6\">)</span><span class=\"mtk1\"> </span><span class=\"mtk6\">*</span><span class=\"mtk1\"> cfg</span><span class=\"mtk6\">.</span><span class=\"mtk5\">TRAIN</span><span class=\"mtk6\">.</span><span class=\"mtk5\">BATCH_SIZE</span><span class=\"mtk6\">]</span></span></span></code></pre>\n<p>First, we have to extract boxes definition from given <strong>idx</strong> to <strong>idx + BATCH_SIZE</strong>. So if our <strong>BATCH_SIZE</strong> is <strong>16</strong> and <strong>idx</strong> is <strong>0</strong> then we’re processing boxes from <strong>0</strong> to <strong>16</strong>.</p>\n<p>Now we have to define zeros matrix for input and output</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"python\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">batch_images </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> np</span><span class=\"mtk6\">.</span><span class=\"mtk1\">zeros</span><span class=\"mtk6\">((</span><span class=\"mtk9 mtkb\">len</span><span class=\"mtk6\">(</span><span class=\"mtk1\">boxes</span><span class=\"mtk6\">),</span><span class=\"mtk1\"> cfg</span><span class=\"mtk6\">.</span><span class=\"mtk5\">NN</span><span class=\"mtk6\">.</span><span class=\"mtk5\">INPUT_SIZE</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> cfg</span><span class=\"mtk6\">.</span><span class=\"mtk5\">NN</span><span class=\"mtk6\">.</span><span class=\"mtk5\">INPUT_SIZE</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">),</span><span class=\"mtk1\"> </span><span class=\"mtk7\">dtype</span><span class=\"mtk6\">=</span><span class=\"mtk1\">np</span><span class=\"mtk6\">.</span><span class=\"mtk1\">float32</span><span class=\"mtk6\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">batch_boxes </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> np</span><span class=\"mtk6\">.</span><span class=\"mtk1\">zeros</span><span class=\"mtk6\">((</span><span class=\"mtk9 mtkb\">len</span><span class=\"mtk6\">(</span><span class=\"mtk1\">boxes</span><span class=\"mtk6\">),</span><span class=\"mtk1\"> cfg</span><span class=\"mtk6\">.</span><span class=\"mtk5\">NN</span><span class=\"mtk6\">.</span><span class=\"mtk5\">GRID_SIZE</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> cfg</span><span class=\"mtk6\">.</span><span class=\"mtk5\">NN</span><span class=\"mtk6\">.</span><span class=\"mtk5\">GRID_SIZE</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk5\">5</span><span class=\"mtk6\">),</span><span class=\"mtk1\"> </span><span class=\"mtk7\">dtype</span><span class=\"mtk6\">=</span><span class=\"mtk1\">np</span><span class=\"mtk6\">.</span><span class=\"mtk1\">float32</span><span class=\"mtk6\">)</span></span></span></code></pre>\n<ul>\n<li><code>batch_images</code> contains images and has a size of <strong>16x224x224x3</strong>. </li>\n<li><code>batch_boxes</code> contains expected output in a grid and has a size of <strong>16x7x7x5</strong>.</li>\n</ul>\n<p>Now we have to iterate over our batch and process each example.</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"python\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">for</span><span class=\"mtk1\"> i</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> row </span><span class=\"mtk6\">in</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">enumerate</span><span class=\"mtk6\">(</span><span class=\"mtk1\">boxes</span><span class=\"mtk6\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    path</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> x0</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> y0</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> w</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> h </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> row</span></span></span></code></pre>\n<p>First, we have to create an input from the image path. To do that we’re going to use <code>tf.keras.preprocessing.image.load_img</code>.</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"python\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">proc_image </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> tf</span><span class=\"mtk6\">.</span><span class=\"mtk1\">keras</span><span class=\"mtk6\">.</span><span class=\"mtk1\">preprocessing</span><span class=\"mtk6\">.</span><span class=\"mtk1\">image</span><span class=\"mtk6\">.</span><span class=\"mtk1\">load_img</span><span class=\"mtk6\">(</span><span class=\"mtk5\">self</span><span class=\"mtk6\">.</span><span class=\"mtk1\">data_path </span><span class=\"mtk6\">+</span><span class=\"mtk1\"> path</span><span class=\"mtk6\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">image_width </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> proc_image</span><span class=\"mtk6\">.</span><span class=\"mtk1\">width</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">image_height </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> proc_image</span><span class=\"mtk6\">.</span><span class=\"mtk1\">height</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">proc_image </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> tf</span><span class=\"mtk6\">.</span><span class=\"mtk1\">keras</span><span class=\"mtk6\">.</span><span class=\"mtk1\">preprocessing</span><span class=\"mtk6\">.</span><span class=\"mtk1\">image</span><span class=\"mtk6\">.</span><span class=\"mtk1\">load_img</span><span class=\"mtk6\">(</span><span class=\"mtk5\">self</span><span class=\"mtk6\">.</span><span class=\"mtk1\">data_path </span><span class=\"mtk6\">+</span><span class=\"mtk1\"> path</span><span class=\"mtk6\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                               </span><span class=\"mtk7\">target_size</span><span class=\"mtk6\">=(</span><span class=\"mtk1\">cfg</span><span class=\"mtk6\">.</span><span class=\"mtk5\">NN</span><span class=\"mtk6\">.</span><span class=\"mtk5\">INPUT_SIZE</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> cfg</span><span class=\"mtk6\">.</span><span class=\"mtk5\">NN</span><span class=\"mtk6\">.</span><span class=\"mtk5\">INPUT_SIZE</span><span class=\"mtk6\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">proc_image </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> tf</span><span class=\"mtk6\">.</span><span class=\"mtk1\">keras</span><span class=\"mtk6\">.</span><span class=\"mtk1\">preprocessing</span><span class=\"mtk6\">.</span><span class=\"mtk1\">image</span><span class=\"mtk6\">.</span><span class=\"mtk1\">img_to_array</span><span class=\"mtk6\">(</span><span class=\"mtk1\">proc_image</span><span class=\"mtk6\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">proc_image </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> np</span><span class=\"mtk6\">.</span><span class=\"mtk1\">expand_dims</span><span class=\"mtk6\">(</span><span class=\"mtk1\">proc_image</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk7\">axis</span><span class=\"mtk6\">=</span><span class=\"mtk5\">0</span><span class=\"mtk6\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">proc_image </span><span class=\"mtk6\">-</span><span class=\"mtk1\"> tf</span><span class=\"mtk6\">.</span><span class=\"mtk1\">keras</span><span class=\"mtk6\">.</span><span class=\"mtk1\">applications</span><span class=\"mtk6\">.</span><span class=\"mtk1\">mobilenet_v2</span><span class=\"mtk6\">.</span><span class=\"mtk1\">preprocess_input</span><span class=\"mtk6\">(</span><span class=\"mtk1\">proc_image</span><span class=\"mtk6\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">batch_images</span><span class=\"mtk6\">[</span><span class=\"mtk1\">i</span><span class=\"mtk6\">]</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> proc_image</span></span></span></code></pre>\n<p>For each image, we need to extract original width and height to be able to scale <strong>x0, y0, w, h</strong> of our box. That’s why we’re calling this method twice (second time with <code>target_size</code> set to our <strong>224x224</strong>). In the end, our processed image is stored in <code>batch_images</code>.</p>\n<p>Next, we have to deal with box position and size. Original values are integers and represent a point on the original image. What we need to do is to scale them into <strong>&#x3C;0,1></strong> values. That’s why we need <code>image_width</code> and <code>image_height</code> from the original image.</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"python\" data-index=\"19\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    image_width </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> proc_image</span><span class=\"mtk6\">.</span><span class=\"mtk1\">width</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    image_height </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> proc_image</span><span class=\"mtk6\">.</span><span class=\"mtk1\">height</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3 mtki\"># make sure none of the points is out of image border</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    x0 </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">max</span><span class=\"mtk6\">(</span><span class=\"mtk1\">x0</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk5\">0</span><span class=\"mtk6\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    y0 </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">max</span><span class=\"mtk6\">(</span><span class=\"mtk1\">y0</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk5\">0</span><span class=\"mtk6\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    x0 </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">min</span><span class=\"mtk6\">(</span><span class=\"mtk1\">x0</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> image_width</span><span class=\"mtk6\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    y0 </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">min</span><span class=\"mtk6\">(</span><span class=\"mtk1\">y0</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> image_height</span><span class=\"mtk6\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    x_c </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">(</span><span class=\"mtk1\">cfg</span><span class=\"mtk6\">.</span><span class=\"mtk5\">NN</span><span class=\"mtk6\">.</span><span class=\"mtk5\">GRID_SIZE</span><span class=\"mtk1\"> </span><span class=\"mtk6\">/</span><span class=\"mtk1\"> image_width</span><span class=\"mtk6\">)</span><span class=\"mtk1\"> </span><span class=\"mtk6\">*</span><span class=\"mtk1\"> x0</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    y_c </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">(</span><span class=\"mtk1\">cfg</span><span class=\"mtk6\">.</span><span class=\"mtk5\">NN</span><span class=\"mtk6\">.</span><span class=\"mtk5\">GRID_SIZE</span><span class=\"mtk1\"> </span><span class=\"mtk6\">/</span><span class=\"mtk1\"> image_height</span><span class=\"mtk6\">)</span><span class=\"mtk1\"> </span><span class=\"mtk6\">*</span><span class=\"mtk1\"> y0</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    floor_y </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> math</span><span class=\"mtk6\">.</span><span class=\"mtk1\">floor</span><span class=\"mtk6\">(</span><span class=\"mtk1\">y_c</span><span class=\"mtk6\">)</span><span class=\"mtk1\">  </span><span class=\"mtk3 mtki\"># handle case when x i on the corner</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    floor_x </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> math</span><span class=\"mtk6\">.</span><span class=\"mtk1\">floor</span><span class=\"mtk6\">(</span><span class=\"mtk1\">x_c</span><span class=\"mtk6\">)</span><span class=\"mtk1\">  </span><span class=\"mtk3 mtki\"># handle case when y i on the corner</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    batch_boxes</span><span class=\"mtk6\">[</span><span class=\"mtk1\">i</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> floor_y</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> floor_x</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk5\">0</span><span class=\"mtk6\">]</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> h </span><span class=\"mtk6\">/</span><span class=\"mtk1\"> image_height</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    batch_boxes</span><span class=\"mtk6\">[</span><span class=\"mtk1\">i</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> floor_y</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> floor_x</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk5\">1</span><span class=\"mtk6\">]</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> w </span><span class=\"mtk6\">/</span><span class=\"mtk1\"> image_width</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    batch_boxes</span><span class=\"mtk6\">[</span><span class=\"mtk1\">i</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> floor_y</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> floor_x</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk5\">2</span><span class=\"mtk6\">]</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> y_c </span><span class=\"mtk6\">-</span><span class=\"mtk1\"> floor_y</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    batch_boxes</span><span class=\"mtk6\">[</span><span class=\"mtk1\">i</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> floor_y</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> floor_x</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk5\">3</span><span class=\"mtk6\">]</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> x_c </span><span class=\"mtk6\">-</span><span class=\"mtk1\"> floor_x</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    batch_boxes</span><span class=\"mtk6\">[</span><span class=\"mtk1\">i</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> floor_y</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> floor_x</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk5\">4</span><span class=\"mtk6\">]</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">1</span></span></span></code></pre>\n<p>This section applies extra validation to be sure that our point lays inside the image. Except that we’re calculating relative position of that point to whatever grid cell it is in. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1018px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC2UlEQVQ4y42Uay+rURCF35/uLyCEzw6tqEvEXWn4QI9eVKsXocS1VIu6lUazzjz72D0k5JhkZ6ZvZ8+smVmzg4mJCZXLZU1PT2t9fV2lUkmjo6Pa3t7W7u6us7PZrDvhcFjFYtH54e/vra6u6uTkRP39/Qr4iBwfH+v5+dnZhUJBXoofbP+92Wy6AAi60Wg4m8ABGQg2OzurjY0Nl3VsclI5Q1I6OFBkakoFswkWiUS0v7/v/PDn3tzcnNbW1nRxcaGBgQEFwAcZTqW9PTVubhSzIBWza0dHillLqmdnql5fK7q8rNvbW9cW/P29XC6nt7c3hUIhBfyJlA1N4+lJardVsCCywHp8VGFsTKpWnc9OJuM0JfpWoWu1mrOXlpYU0HRfznIsprxlDPX1KW5DSFmykDU6Y44JG9LQ0JAyFjQajWp8fNzdQy8sLLhWdHd3K2CaCLArIHl40G/rT9NQtO/vtWU9ap2eqmU+8Xjc+VYqFccABO0HxDwC/wel1+/upJcXpQ1BG7teV3plRbq6cj6pZNLpun3fsx4jaBIgDOhTydH3ksM9PYqn00pZsnBvb6fkXz8pGcI6juXzqlpm2WCSVnLLhoMkLWvbKMGvxNaW+1a11nhOQvTz83Nnz8zMfBHw9VU7hrp1eCgZXbIjI2pfXv48IOvUKdl4tmMJhoaH3QBSqZSzE9a7RCLxacr45w0Een5+/l/JZED4AGmRzDvfvrPvbGAHxlsEXX3n6eLi4t9NYTfdptikIS0ImBzTxOYCB5tgTHZzc9NtChqmdDYF7sCjj7vM5HDiop+mbwuICAJF/C4DCgCDg4P/f20+2vQMwQ9/fw/UyIpxtoOQTN8hpM+cHyHkDaNvPEGsH4sOUUmCEza04DBNekkygoAMzfqCGhYEfg95z2isn7iXr2z8/LqhfasIHvBsg5LHkSnxBMEnWkE52BCWgw018KM8eoYGGcG6urr0BzjDc4YnnT0OAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Object\"\n        title=\"Object\"\n        src=\"/static/d5813d7e1967e2a979a22e9eee965cbd/3dde1/grid.png\"\n        srcset=\"/static/d5813d7e1967e2a979a22e9eee965cbd/72799/grid.png 320w,\n/static/d5813d7e1967e2a979a22e9eee965cbd/6af66/grid.png 640w,\n/static/d5813d7e1967e2a979a22e9eee965cbd/3dde1/grid.png 1018w\"\n        sizes=\"(max-width: 1018px) 100vw, 1018px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Default values for this point might be:</p>\n<ul>\n<li>x = 0.35 (relative to top left corner)</li>\n<li>y = 0.35 (relative to top left corner)</li>\n</ul>\n<p>But our output requires position in relation to the grid cell (one which contains the point). Because of that new coordinates are as follows:</p>\n<ul>\n<li>x = 0.5 (relative to cell top left corner)</li>\n<li>y = 0.5 (relative to cell top left corner)</li>\n</ul>\n<p>In the end, we’re saving those values inside i-th output and 3x3 grid cell (rest of them remains zero). Notice that the <strong>width</strong> and the <strong>height</strong> of the box are still scaled to the full image.</p>\n<p>After we process all examples in the batch we need to only return both arrays</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"python\" data-index=\"20\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">return</span><span class=\"mtk1\"> batch_images</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> batch_boxes</span></span></span></code></pre>\n<p>To use our generator just create an instance of it and pass right paths</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"python\" data-index=\"21\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">train_datagen </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> DataGenerator</span><span class=\"mtk6\">(</span><span class=\"mtk7\">file_path</span><span class=\"mtk6\">=</span><span class=\"mtk1\">cfg</span><span class=\"mtk6\">.</span><span class=\"mtk5\">TRAIN</span><span class=\"mtk6\">.</span><span class=\"mtk5\">DATA_PATH</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk7\">config_path</span><span class=\"mtk6\">=</span><span class=\"mtk1\">cfg</span><span class=\"mtk6\">.</span><span class=\"mtk5\">TRAIN</span><span class=\"mtk6\">.</span><span class=\"mtk5\">ANNOTATION_PATH</span><span class=\"mtk6\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">val_generator </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> DataGenerator</span><span class=\"mtk6\">(</span><span class=\"mtk7\">file_path</span><span class=\"mtk6\">=</span><span class=\"mtk1\">cfg</span><span class=\"mtk6\">.</span><span class=\"mtk5\">TEST</span><span class=\"mtk6\">.</span><span class=\"mtk5\">DATA_PATH</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk7\">config_path</span><span class=\"mtk6\">=</span><span class=\"mtk1\">cfg</span><span class=\"mtk6\">.</span><span class=\"mtk5\">TEST</span><span class=\"mtk6\">.</span><span class=\"mtk5\">ANNOTATION_PATH</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk7\">debug</span><span class=\"mtk6\">=</span><span class=\"mtk5\">False</span><span class=\"mtk6\">)</span></span></span></code></pre>\n<p>now we can fit our data for training</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"python\" data-index=\"22\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">model</span><span class=\"mtk6\">.</span><span class=\"mtk1\">fit_generator</span><span class=\"mtk6\">(</span><span class=\"mtk7\">generator</span><span class=\"mtk6\">=</span><span class=\"mtk1\">train_datagen</span><span class=\"mtk6\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk7\">epochs</span><span class=\"mtk6\">=</span><span class=\"mtk1\">cfg</span><span class=\"mtk6\">.</span><span class=\"mtk5\">TRAIN</span><span class=\"mtk6\">.</span><span class=\"mtk5\">EPOCHS</span><span class=\"mtk6\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk7\">callbacks</span><span class=\"mtk6\">=[</span><span class=\"mtk3 mtki\"># your callbacks for TF],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        shuffle=</span><span class=\"mtk5\">True</span><span class=\"mtk6\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        verbose=</span><span class=\"mtk5\">1</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<p>Here is full code for <strong>DataGenerator</strong> Class:\n<a href=\"https://gist.github.com/burnpiro/c3835a1f914545f2034f4190b1e83153\">https://gist.github.com/burnpiro/c3835a1f914545f2034f4190b1e83153</a></p>\n<h2 id=\"summary\" style=\"position:relative;\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h2>\n<p>If you’re working with complex datasets (or just really large ones) it’s a good idea to think about Sequences and create your won Sequence Class for data generation. It’s efficient (multithreading out of the box) and easy to maintain way you’ll appreciate, especially when working with the team of engineers and version control.</p>\n<p>This code is just an example, your implementation may (and probably will) look different. Everything depends on specific problems and structure of the dataset but imho it’s a lot easier to define data processing inside class than using C like approach you can find inside Tensorflow guides.</p>\n<p>Have a Happy New Year and see you in 2020!!!</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .quiet-light { background-color: #F5F5F5; }\n  .quiet-light .mtkb { font-weight: bold; }\n  .quiet-light .mtki { font-style: italic; }\n  .quiet-light .mtk3 { color: #AAAAAA; }\n  .quiet-light .mtk7 { color: #7A3E9D; }\n  .quiet-light .mtk1 { color: #333333; }\n  .quiet-light .mtk6 { color: #777777; }\n  .quiet-light .mtk9 { color: #AA3731; }\n  .quiet-light .mtk5 { color: #9C5D27; }\n  .quiet-light .mtk10 { color: #4B69C6; }\n  .quiet-light .mtk4 { color: #448C27; }\n  .quiet-light .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));\n  }\n</style>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1280px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 26.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABPElEQVQY0wExAc7+AEFgKU5qM1RzNkNdL0p5MFt3N1JzPF19PEJgLzhQKGppVmg1FIFvWHSXUXSBU2xNQEckCmNuXnaRWbixswBPYTpNaDVPcDJKWDZiik91ilZZcD9QdDxHVSxWRjRveVUkHhhTWFFWYTp/iWQ4PzUUGAlDTUdcZ0PdoaYAdW5aaHVOX21BjIppg4dkS1U3RlAzIyUnb1xNX0w6YlpZHBkeX1VUam9siJGQRDU6JBUXX19mdm1o6rS0AHtrZL62sxsYEWtIQ3J5TkxTOyssIDIsJEY6L0tHTmVfZFEzKlpSUXyhiHqQcEY2OjQ0NVxiWoWRbIqhegChnZp/fXcREA8bGxkqLSpLR0M/ODcgISEnJSBhZ213dX5CKy9mZEakmYqhgYJHVEAlOzFFXFxaaWJlamTgVWYBIEfrfwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Dataset Example","title":"Dataset Example","src":"/static/11eabe31675d3e4b757b0582e281ab7c/21b4d/dataset.png","srcSet":["/static/11eabe31675d3e4b757b0582e281ab7c/72799/dataset.png 320w","/static/11eabe31675d3e4b757b0582e281ab7c/6af66/dataset.png 640w","/static/11eabe31675d3e4b757b0582e281ab7c/21b4d/dataset.png 1280w","/static/11eabe31675d3e4b757b0582e281ab7c/29114/dataset.png 1920w","/static/11eabe31675d3e4b757b0582e281ab7c/373fb/dataset.png 2068w"],"sizes":["(max-width:","1280px)","100vw,","1280px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"Image source: https://swinghu.github.io/assets/face-detection-recognition/From_Facial_Parts_Responses_to_Face_Detection_A_Deep_Learning_Approach_index.png"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"the-problem","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#the-problem","ariaLabel":"the problem permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"The problem"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Modern Machine Learning solutions require a huge amount of data, that’s definitely the case when working with image recognition/object detection. Because of that, we need to create more and more complex datasets to teach our models. At this moment we cannot store the whole thing in the memory (sometimes even hard drive has a problem), quite often a description of that dataset is not directly readable by Tensorflow’s "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Dataset"}]},{"type":"text","value":". That’s why we need to create a modern solution to handle and preprocess an enormous amount of data in easy to understand way using Sequences."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"TLDR"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Here is a code: "},{"type":"element","tagName":"a","properties":{"href":"https://gist.github.com/burnpiro/c3835a1f914545f2034f4190b1e83153"},"children":[{"type":"text","value":"https://gist.github.com/burnpiro/c3835a1f914545f2034f4190b1e83153"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Use Sequences to make datasets maintainable and fast."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"what-is-the-sequence","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#what-is-the-sequence","ariaLabel":"what is the sequence permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"What is the Sequence?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"According to documentation, Sequence is:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Base object for fitting to a sequence of data, such as a dataset."}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sequence object is created using "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/keras/utils/data_utils.py#L331-L406"},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Sequence Class"}]}]},{"type":"text","value":". The best thing about it is that we can extend it. Every Sequence has to implement 3 methods:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"__getitem__"}]},{"type":"text","value":" - used to extract an item from dataset"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"__len__"}]},{"type":"text","value":" - returns the length of our dataset"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"__init__"}]},{"type":"text","value":" - initializing our dataset (this one is not required but we need some kind of initialization)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sequence allows us to create complex datasets and even modify them at the end of each epoch by implementing "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"on_epoch_end"}]},{"type":"text","value":". We’re going to focus only on those 3 methods but if you can you can play with "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"on_epoch_end"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"our-test-dataset","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#our-test-dataset","ariaLabel":"our test dataset permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Our Test Dataset"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In our example, we’re going to use WIDER FACE dataset"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Instruction how to get dataset is "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/burnpiro/tiny-face-detection-tensorflow2#dataset"},"children":[{"type":"text","value":"Here"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This dataset contains over 32k images and weights around 2GB so we don’t really want to keep it in the memory all the time. This dataset is used to teach object detection models so it contains bounding boxes for every face on the image."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"data-structure","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#data-structure","ariaLabel":"data structure permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Data structure"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Dataset is already split into "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Train"}]},{"type":"text","value":" and "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Validation"}]},{"type":"text","value":" so we don’t have to do it again. We have two folders: "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"WIDER_train"}]},{"type":"text","value":" and "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"WIDER_val"}]},{"type":"text","value":". The image description is stored in "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"wider_face_train_bbx_gt.txt"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"wider_face_val_bbx_gt.txt"}]},{"type":"text","value":". Here is an example of one of the images"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAQBAwL/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAefijibOrG5OLYDf/8QAHBAAAgICAwAAAAAAAAAAAAAAAQIAEQMEEhMy/9oACAEBAAEFAjqMB0VALh9PYiIoXG5zrXEkz//EABkRAAEFAAAAAAAAAAAAAAAAAAABAhARQf/aAAgBAwEBPwFCh+R//8QAGBEAAgMAAAAAAAAAAAAAAAAAAAIQIUH/2gAIAQIBAT8BKF2P/8QAHhAAAgMAAQUAAAAAAAAAAAAAAAECETEQMkJRgZH/2gAIAQEABj8CbUotHUl5Nh9Hd7rHGrs7fbJRnhSb4//EABsQAQADAQEBAQAAAAAAAAAAAAEAESExUUFx/9oACAEBAAE/IQSIvHY26EBa4RxYpfWQ6wIPSogYCm/aOQjZfr0lRFisjxYPsTPyf//aAAwDAQACAAMAAAAQQMgA/8QAGREAAgMBAAAAAAAAAAAAAAAAAAEQESEx/9oACAEDAQE/EKPgg2w//8QAGBEBAQADAAAAAAAAAAAAAAAAAQAQETH/2gAIAQIBAT8Q0nZYcP/EAB4QAQEAAgIDAQEAAAAAAAAAAAERACExQWGRsVGB/9oACAEBAAE/EHgrQp6YQ7t9CuuOnU/vGJKQAQoMs/MDHEJa4NfPWSsWbRdh2QwdpGy29Z1wi1k3TzcRSoLyT5h0LYPHzP/Z'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Image Example","title":"Image Example","src":"/static/1fbd4b1b30208290b1eca0b275330f4d/72e01/22_Picnic_Picnic_22_277.jpg","srcSet":["/static/1fbd4b1b30208290b1eca0b275330f4d/cb69c/22_Picnic_Picnic_22_277.jpg 320w","/static/1fbd4b1b30208290b1eca0b275330f4d/c08c5/22_Picnic_Picnic_22_277.jpg 640w","/static/1fbd4b1b30208290b1eca0b275330f4d/72e01/22_Picnic_Picnic_22_277.jpg 1024w"],"sizes":["(max-width:","1024px)","100vw,","1024px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"Image source: WIDER FACE dataset"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Description for that image in "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".txt"}]},{"type":"text","value":" file is as follows:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"","dataIndex":"0"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"22--Picnic/22_Picnic_Picnic_22_277.jpg"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"3"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"196 410 74 114 1 0 0 0 0 0 "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"344 404 62 88 1 0 0 0 0 0 "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"634 222 58 86 1 0 0 0 0 0 "}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It might seem unclear at first but everything is explained in Dataset’s Readme file:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"","dataIndex":"1"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"File name"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"Number of bounding box"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"x1, y1, w, h, blur, expression, illumination, invalid, occlusion, pose"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So our image contains 3 boxes. The first two numbers are X and Y coordinates followed by box width and height. After that we have more information about the face inside the box, we’re not going to use those ones because our goal is just object detection (face detection) but feel free to check Readme file for properties description."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"models-input-and-output","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#models-input-and-output","ariaLabel":"models input and output permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Model’s input and output"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now after we know how our dataset looks like we need to figure out what is an input and output of our "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Model"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can skip this section if you want. It’s not necessary to know anything more than the input and output size of the model to construct training examples."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Input - "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"224x224x3"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Output - "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"7x7x5"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Imho, it’s beneficial to understand it but not required. I’ve selected this model because most of the guides are using simple examples from regression networks and it’s hard to find a solution for a complex one."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For this example, we’re going to use "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"MobileNetV2"}]},{"type":"text","value":" ("},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"mobilenet_v2_0.75_224"}]},{"type":"text","value":" to be precise), our model has an input size of "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"224x224x3"}]},{"type":"text","value":" (width x height x RGB). So every example in our sentence has to produce input of that size."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Output, on the other hand, is completely up to us. We’re using MobileNet as a feature extractor that gives us output from the last Conv layer of "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"7x7x240"}]},{"type":"text","value":". We want to keep 7x7 grid and our detection requires only 5 values per grid (because we have only one class). In the end, our output should look like "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"7x7x5"}]},{"type":"text","value":" (grid width x grid width x number of classes times 5)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"I’m not going to discuss how this network works, you can easily find any tutorial on CNNs and how to use them as a feature extractor for object detection (maybe some other guide in the future)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This is how our model looks like at the end:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"","dataIndex":"2"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"__________________________________________________________________________________________________"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"Layer (type)                    Output Shape         Param #     Connected to                     "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"=================================================================================================="}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"input_1 (InputLayer)            [(None, 224, 224, 3) 0                   "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"________________________________________________________________________"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"                         "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"----- Rest of MobileNetV2 ------"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"__________________________________________________________________________________________________"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"block_16_project_BN (BatchNorma (None, 7, 7, 240)    960         block_16_project[0][0]           "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"__________________________________________________________________________________________________"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"----- Our Layers conected to MobileNet output------    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"__________________________________________________________________________________________________"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"conv2d_2 (Conv2D)               (None, 7, 7, 5)      1205        activation[0][0]                 "}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now it should be clear that our Dataset should generate examples like:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Input - "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"224x224x3"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Output - "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"7x7x5"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"extend-sequence-class","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#extend-sequence-class","ariaLabel":"extend sequence class permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Extend Sequence Class"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"python","dataIndex":"3"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk3","mtki"]},"children":[{"type":"text","value":"# Data generator boilerplace"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"class"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7","mtkb"]},"children":[{"type":"text","value":"DataGenerator"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk7","mtkb"]},"children":[{"type":"text","value":"tf"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk7","mtkb"]},"children":[{"type":"text","value":"keras"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk7","mtkb"]},"children":[{"type":"text","value":"utils"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk7","mtkb"]},"children":[{"type":"text","value":"Sequence"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"):"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"def"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"__init__"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"self"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"file_path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"config_path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"debug"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"False"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"):"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        "}]},{"type":"element","tagName":"span","properties":{"className":["mtk3","mtki"]},"children":[{"type":"text","value":"# Sequence initialization"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        "}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"def"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"__len__"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"self"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"):"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        "}]},{"type":"element","tagName":"span","properties":{"className":["mtk3","mtki"]},"children":[{"type":"text","value":"# Should return Sequence length"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"def"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"__getitem__"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"self"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"idx"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"):"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        "}]},{"type":"element","tagName":"span","properties":{"className":["mtk3","mtki"]},"children":[{"type":"text","value":"# Returns preprocessed data"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"initialization","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#initialization","ariaLabel":"initialization permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Initialization"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The first thing we need to implement is data initialization. "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"python","dataIndex":"4"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"def"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"__init__"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"self"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"file_path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"config_path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"debug"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"False"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"):"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        "}]},{"type":"element","tagName":"span","properties":{"className":["mtk3","mtki"]},"children":[{"type":"text","value":"# Sequence initialization"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        "}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Because dataset description is located in two different files (one for training and one for validation) we need to pass paths to the folder with images ("},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"file_path"}]},{"type":"text","value":") and the path to our dataset spec ("},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"config_path"}]},{"type":"text","value":"). "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"debug"}]},{"type":"text","value":" options allow us to display additional messages when processing dataset."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Inside "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"__init__"}]},{"type":"text","value":" method we have access to "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"self"}]},{"type":"text","value":" object. This object represents our sequence and we want to initialize some default values on it."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"python","dataIndex":"5"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"self"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"boxes "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"[]"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"self"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"debug "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" debug"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"self"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"data_path "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" file_path"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"self.boxes"}]},{"type":"text","value":" is going to store all boxes definitions from dataset"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"self.debug"}]},{"type":"text","value":" enables "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"debug"}]},{"type":"text","value":" mode"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"self.data_path"}]},{"type":"text","value":" stores path to images for later processing"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After initialization, we need to check if paths are valid (if not there is no reason to create Sequence)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"python","dataIndex":"6"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"not"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" os"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"isfile"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"config_path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"):"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"print"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"(\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"File path "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"{}"}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":" does not exist. Exiting..."}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"\"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"format"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"config_path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"))"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    sys"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"exit"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"()"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"not"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" os"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"isdir"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"file_path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"):"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"print"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"(\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"Images folder path "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"{}"}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":" does not exist. Exiting..."}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"\"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"format"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"file_path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"))"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    sys"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"exit"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"()"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When everything is correct we can start reading config file"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"python","dataIndex":"7"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"with"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"open"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"config_path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"as"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" fp"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":":"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    image_name "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" fp"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"readline"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"()"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    cnt "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"1"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"while"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" image_name"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":":"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        "}]},{"type":"element","tagName":"span","properties":{"className":["mtk3","mtki"]},"children":[{"type":"text","value":"# image_name - relative path to our image"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        "}]},{"type":"element","tagName":"span","properties":{"className":["mtk3","mtki"]},"children":[{"type":"text","value":"# in this loop we have to process each image definition"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We’re going to read this file line by line but as you remember file is structured in a specific way:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"","dataIndex":"8"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"File name"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"Number of bounding box"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"x1, y1, w, h, blur, expression, illumination, invalid, occlusion, pose"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So after reading "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"File name"}]},{"type":"text","value":" and "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Number of bounding box"}]},{"type":"text","value":" we need to use that number to know how many lines to read as bounding boxes definition."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"python","dataIndex":"9"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"with"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"open"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"config_path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"as"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" fp"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":":"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    image_name "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" fp"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"readline"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"()"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    cnt "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"1"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"while"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" image_name"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":":"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        num_of_obj "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"int"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"fp"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"readline"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"())"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"for"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" i "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"in"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"range"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"num_of_obj"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"):"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            obj_box "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" fp"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"readline"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"()."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"split"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"('"}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"')"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            x0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" y0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" w"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" h "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" get_box"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"obj_box"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" w "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"=="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":":"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk3","mtki"]},"children":[{"type":"text","value":"# remove boxes with no width"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"continue"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" h "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"=="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":":"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk3","mtki"]},"children":[{"type":"text","value":"# remove boxes with no height"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"continue"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"self"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"boxes"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"append"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"(("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"image_name"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"strip"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"(),"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" x0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" y0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" w"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" h"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"))"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        image_name "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" fp"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"readline"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"()"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        cnt "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"+="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"1"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The first thing we have to do inside "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"while"}]},{"type":"text","value":" loop is to extract how many boxes there are. To do this we’re calling "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"int(tf.readline()"}]},{"type":"text","value":" which returns next line value as an integer. We’re using this number to iterate through the next "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"num_of_obj"}]},{"type":"text","value":" lines. Each line values are separated by an empty string so we have to split values before processing "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"obj_box = fp.readline().split(' ')"}]},{"type":"text","value":". We’re interested in the first 4 values from each line but those values have to be integers. To extract those values it’s easier to create a helper function "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"get_box"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"python","dataIndex":"10"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk3","mtki"]},"children":[{"type":"text","value":"# Input: [x0, y0, w, h, blur, expression, illumination, invalid, occlusion, pose]"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk3","mtki"]},"children":[{"type":"text","value":"# Output: x0, y0, w, h"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"def"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"get_box"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"data"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"):"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    x0 "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"int"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"data"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"])"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    y0 "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"int"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"data"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"])"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    w "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"int"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"data"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"2"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"])"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    h "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"int"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"data"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"3"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"])"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"return"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" x0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" y0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" w"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" h"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This function receives a list of strings and returns 4 integers we need. After that, we’re appending our box to Sequence object "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"self.boxes.append((image_name.strip(), x0, y0, w, h))"}]},{"type":"text","value":" and read the next line."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Everything seems fine and we should be ready to move to the next part, but if we try to execute this code it will fail."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"bash","dataIndex":"11"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"ValueError: invalid literal "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"for"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"int"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"()"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" with base 10: "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"'"}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"0--Parade/0_Parade_Parade_0_630.jpg\\n"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"'"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Did we make a mistake in the code? No, we didn’t. We just didn’t explore our dataset carefully enough. If we jump to our "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":".txt"}]},{"type":"text","value":" file and find the line with that sentence it’s much clearer what just happen."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"","dataIndex":"12"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"0--Parade/0_Parade_Parade_0_452.jpg"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"0"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"0 0 0 0 0 0 0 0 0 0 "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"text","value":"0--Parade/0_Parade_Parade_0_630.jpg"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We didn’t anticipate there are images without faces and because of how our iteration is designed it’s not going to skip line with zeros after reading "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"num_of_obj = 0"}]},{"type":"text","value":". Knowing that we can create a quick fix just after for loop:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"python","dataIndex":"13"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" num_of_obj "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"=="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":":"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    obj_box "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" fp"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"readline"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"()."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"split"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"('"}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"')"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    x0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" y0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" w"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" h "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" get_box"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"obj_box"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"self"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"boxes"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"append"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"(("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"image_name"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"strip"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"(),"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" x0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" y0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" w"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" h"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"))"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"That way, when there are no faces on an image we’re going to create an empty example."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"return-length-of-the-dataset","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#return-length-of-the-dataset","ariaLabel":"return length of the dataset permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Return length of the dataset"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"That should be easy… But it isn’t :) When implementing "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"__len__"}]},{"type":"text","value":" method we need to remember that training works in batches. Because of that, we have to divide the number of boxes by our batch size and return that instead of just the length of our array."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"python","dataIndex":"14"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"def"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"__len__"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"self"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"):"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"return"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" math"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"ceil"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"len"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"self"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"boxes"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"/"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" cfg"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"TRAIN"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"BATCH_SIZE"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Notice that we’re using a mysterious config called "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"cfg"}]},{"type":"text","value":". This is just an "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"EasyDict"}]},{"type":"text","value":" dictionary that holds our dataset settings. You don’t have to worry about it right now, I’ll show you its definition at the end. For now, just assume that it stores all config values."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"returning-items","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#returning-items","ariaLabel":"returning items permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Returning items"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Till now we’ve managed to create our Sequence but we still didn’t define how to process images in the dataset. Each box in Sequence has 5 values:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"path to image"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"x value for box center"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"y value for box center"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"box width"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"box height"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"__getitem__(self, idx)"}]},{"type":"text","value":" method should return two values (input, output). But because we’re working in batches those values will be arrays with multiple images and corresponding boxes."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"python","dataIndex":"15"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"def"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"__getitem__"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"self"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"idx"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"):"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    boxes "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"self"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"boxes"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"idx "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"*"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" cfg"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"TRAIN"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"BATCH_SIZE"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":":("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"idx "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"+"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"*"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" cfg"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"TRAIN"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"BATCH_SIZE"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"]"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"First, we have to extract boxes definition from given "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"idx"}]},{"type":"text","value":" to "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"idx + BATCH_SIZE"}]},{"type":"text","value":". So if our "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"BATCH_SIZE"}]},{"type":"text","value":" is "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"16"}]},{"type":"text","value":" and "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"idx"}]},{"type":"text","value":" is "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"0"}]},{"type":"text","value":" then we’re processing boxes from "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"0"}]},{"type":"text","value":" to "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"16"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we have to define zeros matrix for input and output"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"python","dataIndex":"16"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"batch_images "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" np"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"zeros"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"(("}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"len"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"boxes"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"),"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" cfg"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"NN"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"INPUT_SIZE"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" cfg"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"NN"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"INPUT_SIZE"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"3"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"),"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"dtype"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"np"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"float32"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"batch_boxes "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" np"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"zeros"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"(("}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"len"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"boxes"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"),"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" cfg"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"NN"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"GRID_SIZE"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" cfg"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"NN"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"GRID_SIZE"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"5"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"),"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"dtype"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"np"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"float32"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"batch_images"}]},{"type":"text","value":" contains images and has a size of "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"16x224x224x3"}]},{"type":"text","value":". "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"batch_boxes"}]},{"type":"text","value":" contains expected output in a grid and has a size of "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"16x7x7x5"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we have to iterate over our batch and process each example."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"python","dataIndex":"17"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"for"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" i"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" row "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"in"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"enumerate"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"boxes"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"):"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" x0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" y0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" w"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" h "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" row"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"First, we have to create an input from the image path. To do that we’re going to use "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"tf.keras.preprocessing.image.load_img"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"python","dataIndex":"18"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"proc_image "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" tf"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"keras"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"preprocessing"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"load_img"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"self"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"data_path "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"+"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"image_width "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" proc_image"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"width"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"image_height "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" proc_image"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"height"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"proc_image "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" tf"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"keras"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"preprocessing"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"load_img"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"self"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"data_path "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"+"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                                               "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"target_size"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"=("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"cfg"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"NN"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"INPUT_SIZE"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" cfg"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"NN"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"INPUT_SIZE"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"))"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"proc_image "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" tf"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"keras"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"preprocessing"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"img_to_array"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"proc_image"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"proc_image "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" np"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"expand_dims"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"proc_image"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"axis"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"proc_image "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"-"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" tf"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"keras"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"applications"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"mobilenet_v2"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"preprocess_input"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"proc_image"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"batch_images"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"i"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" proc_image"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For each image, we need to extract original width and height to be able to scale "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"x0, y0, w, h"}]},{"type":"text","value":" of our box. That’s why we’re calling this method twice (second time with "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"target_size"}]},{"type":"text","value":" set to our "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"224x224"}]},{"type":"text","value":"). In the end, our processed image is stored in "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"batch_images"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Next, we have to deal with box position and size. Original values are integers and represent a point on the original image. What we need to do is to scale them into "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"<0,1>"}]},{"type":"text","value":" values. That’s why we need "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"image_width"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"image_height"}]},{"type":"text","value":" from the original image."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"python","dataIndex":"19"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    image_width "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" proc_image"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"width"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    image_height "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" proc_image"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"height"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk3","mtki"]},"children":[{"type":"text","value":"# make sure none of the points is out of image border"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    x0 "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"max"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"x0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    y0 "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"max"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"y0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    x0 "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"min"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"x0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" image_width"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    y0 "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk9","mtkb"]},"children":[{"type":"text","value":"min"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"y0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" image_height"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    x_c "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"cfg"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"NN"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"GRID_SIZE"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"/"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" image_width"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"*"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" x0"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    y_c "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"cfg"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"NN"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"GRID_SIZE"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"/"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" image_height"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"*"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" y0"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    floor_y "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" math"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"floor"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"y_c"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"  "}]},{"type":"element","tagName":"span","properties":{"className":["mtk3","mtki"]},"children":[{"type":"text","value":"# handle case when x i on the corner"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    floor_x "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" math"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"floor"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"x_c"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"  "}]},{"type":"element","tagName":"span","properties":{"className":["mtk3","mtki"]},"children":[{"type":"text","value":"# handle case when y i on the corner"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    batch_boxes"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"i"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" floor_y"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" floor_x"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" h "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"/"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" image_height"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    batch_boxes"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"i"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" floor_y"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" floor_x"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" w "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"/"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" image_width"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    batch_boxes"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"i"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" floor_y"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" floor_x"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"2"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" y_c "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"-"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" floor_y"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    batch_boxes"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"i"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" floor_y"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" floor_x"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"3"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" x_c "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"-"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" floor_x"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    batch_boxes"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"i"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" floor_y"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" floor_x"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"4"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"1"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This section applies extra validation to be sure that our point lays inside the image. Except that we’re calculating relative position of that point to whatever grid cell it is in. "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1018px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC2UlEQVQ4y42Uay+rURCF35/uLyCEzw6tqEvEXWn4QI9eVKsXocS1VIu6lUazzjz72D0k5JhkZ6ZvZ8+smVmzg4mJCZXLZU1PT2t9fV2lUkmjo6Pa3t7W7u6us7PZrDvhcFjFYtH54e/vra6u6uTkRP39/Qr4iBwfH+v5+dnZhUJBXoofbP+92Wy6AAi60Wg4m8ABGQg2OzurjY0Nl3VsclI5Q1I6OFBkakoFswkWiUS0v7/v/PDn3tzcnNbW1nRxcaGBgQEFwAcZTqW9PTVubhSzIBWza0dHillLqmdnql5fK7q8rNvbW9cW/P29XC6nt7c3hUIhBfyJlA1N4+lJardVsCCywHp8VGFsTKpWnc9OJuM0JfpWoWu1mrOXlpYU0HRfznIsprxlDPX1KW5DSFmykDU6Y44JG9LQ0JAyFjQajWp8fNzdQy8sLLhWdHd3K2CaCLArIHl40G/rT9NQtO/vtWU9ap2eqmU+8Xjc+VYqFccABO0HxDwC/wel1+/upJcXpQ1BG7teV3plRbq6cj6pZNLpun3fsx4jaBIgDOhTydH3ksM9PYqn00pZsnBvb6fkXz8pGcI6juXzqlpm2WCSVnLLhoMkLWvbKMGvxNaW+1a11nhOQvTz83Nnz8zMfBHw9VU7hrp1eCgZXbIjI2pfXv48IOvUKdl4tmMJhoaH3QBSqZSzE9a7RCLxacr45w0Een5+/l/JZED4AGmRzDvfvrPvbGAHxlsEXX3n6eLi4t9NYTfdptikIS0ImBzTxOYCB5tgTHZzc9NtChqmdDYF7sCjj7vM5HDiop+mbwuICAJF/C4DCgCDg4P/f20+2vQMwQ9/fw/UyIpxtoOQTN8hpM+cHyHkDaNvPEGsH4sOUUmCEza04DBNekkygoAMzfqCGhYEfg95z2isn7iXr2z8/LqhfasIHvBsg5LHkSnxBMEnWkE52BCWgw018KM8eoYGGcG6urr0BzjDc4YnnT0OAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Object","title":"Object","src":"/static/d5813d7e1967e2a979a22e9eee965cbd/3dde1/grid.png","srcSet":["/static/d5813d7e1967e2a979a22e9eee965cbd/72799/grid.png 320w","/static/d5813d7e1967e2a979a22e9eee965cbd/6af66/grid.png 640w","/static/d5813d7e1967e2a979a22e9eee965cbd/3dde1/grid.png 1018w"],"sizes":["(max-width:","1018px)","100vw,","1018px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Default values for this point might be:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"x = 0.35 (relative to top left corner)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"y = 0.35 (relative to top left corner)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"But our output requires position in relation to the grid cell (one which contains the point). Because of that new coordinates are as follows:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"x = 0.5 (relative to cell top left corner)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"y = 0.5 (relative to cell top left corner)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In the end, we’re saving those values inside i-th output and 3x3 grid cell (rest of them remains zero). Notice that the "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"width"}]},{"type":"text","value":" and the "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"height"}]},{"type":"text","value":" of the box are still scaled to the full image."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After we process all examples in the batch we need to only return both arrays"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"python","dataIndex":"20"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"return"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" batch_images"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" batch_boxes"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To use our generator just create an instance of it and pass right paths"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"python","dataIndex":"21"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"train_datagen "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" DataGenerator"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"file_path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"cfg"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"TRAIN"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"DATA_PATH"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"config_path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"cfg"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"TRAIN"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"ANNOTATION_PATH"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"val_generator "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" DataGenerator"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"file_path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"cfg"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"TEST"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"DATA_PATH"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"config_path"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"cfg"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"TEST"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"ANNOTATION_PATH"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"debug"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"False"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":")"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"now we can fit our data for training"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","quiet-light"],"dataLanguage":"python","dataIndex":"22"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"model"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"fit_generator"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"generator"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"train_datagen"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                        "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"epochs"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"cfg"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"TRAIN"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"EPOCHS"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                        "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"callbacks"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"=["}]},{"type":"element","tagName":"span","properties":{"className":["mtk3","mtki"]},"children":[{"type":"text","value":"# your callbacks for TF],"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                        shuffle="}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"True"}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":","}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                        verbose="}]},{"type":"element","tagName":"span","properties":{"className":["mtk5"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":")"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Here is full code for "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"DataGenerator"}]},{"type":"text","value":" Class:\n"},{"type":"element","tagName":"a","properties":{"href":"https://gist.github.com/burnpiro/c3835a1f914545f2034f4190b1e83153"},"children":[{"type":"text","value":"https://gist.github.com/burnpiro/c3835a1f914545f2034f4190b1e83153"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"summary","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#summary","ariaLabel":"summary permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Summary"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you’re working with complex datasets (or just really large ones) it’s a good idea to think about Sequences and create your won Sequence Class for data generation. It’s efficient (multithreading out of the box) and easy to maintain way you’ll appreciate, especially when working with the team of engineers and version control."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This code is just an example, your implementation may (and probably will) look different. Everything depends on specific problems and structure of the dataset but imho it’s a lot easier to define data processing inside class than using C like approach you can find inside Tensorflow guides."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Have a Happy New Year and see you in 2020!!!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"style","properties":{"className":["grvsc-styles"]},"children":[{"type":"text","value":"\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .quiet-light { background-color: #F5F5F5; }\n  .quiet-light .mtkb { font-weight: bold; }\n  .quiet-light .mtki { font-style: italic; }\n  .quiet-light .mtk3 { color: #AAAAAA; }\n  .quiet-light .mtk7 { color: #7A3E9D; }\n  .quiet-light .mtk1 { color: #333333; }\n  .quiet-light .mtk6 { color: #777777; }\n  .quiet-light .mtk9 { color: #AA3731; }\n  .quiet-light .mtk5 { color: #9C5D27; }\n  .quiet-light .mtk10 { color: #4B69C6; }\n  .quiet-light .mtk4 { color: #448C27; }\n  .quiet-light .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));\n  }\n"}]}],"data":{"quirksMode":false}}}},"pageContext":{"slug":"/2019/12/how-to-create-tensorflow-2-sequence-dataset-from-scratch"}},"staticQueryHashes":["2857265606","3631363646"]}