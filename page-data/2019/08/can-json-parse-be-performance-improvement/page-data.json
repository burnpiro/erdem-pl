{"componentChunkName":"component---src-templates-post-template-js","path":"/2019/08/can-json-parse-be-performance-improvement","result":{"data":{"markdownRemark":{"fields":{"slug":"/2019/08/can-json-parse-be-performance-improvement","tagSlugs":["/tag/engines/","/tag/javascript/","/tag/performance/","/tag/internals/"],"readTime":{"text":"15 min read","minutes":14.983333333333333}},"frontmatter":{"description":"JSON.parse is a slow way to create copy of object. But can it actually improve performance of our code?","tags":["Engines","Javascript","Performance","Internals"],"date":"2019-08-07","title":"Can JSON.parse() be performance improvement?"},"html":"<blockquote>\n<p>This post requires a basic knowledge about Shapes and Inline Cache. If you didn’t read <a href=\"/2019/08/v-8-function-optimization\">V8 function optimization</a>, it might be difficult to follow this one.</p>\n</blockquote>\n<h2 id=\"problem\"><a href=\"#problem\" aria-label=\"problem permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Problem</h2>\n<p>Creating a copy of an object is common practice in JS. You’ve probably done that while creating <strong>reducers</strong> in <strong>Redux</strong> or anywhere else. Currently, most used syntax to do this is spread</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"javascript\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">objA</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> name</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Jack</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> surname</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Sparrow</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">objB</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> </span><span class=\"mtk6\">...</span><span class=\"mtk7\">objA</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span></code></pre>\n<p>usage in practice:</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"javascript\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">function</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">dataReducer</span><span class=\"mtk6\">(</span><span class=\"mtk7\">state</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> name</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;&#39;,</span><span class=\"mtk1\"> surname</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">},</span><span class=\"mtk1\"> </span><span class=\"mtk7\">action</span><span class=\"mtk6\">)</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">switch</span><span class=\"mtk1\"> (</span><span class=\"mtk7\">action</span><span class=\"mtk6\">.</span><span class=\"mtk7\">type</span><span class=\"mtk1\">) </span><span class=\"mtk6\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">case</span><span class=\"mtk1\"> </span><span class=\"mtk7\">ACTION_TYPES</span><span class=\"mtk6\">.</span><span class=\"mtk7\">SET_NAME</span><span class=\"mtk6\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk6\">...</span><span class=\"mtk7\">state</span><span class=\"mtk6\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        name</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">action</span><span class=\"mtk6\">.</span><span class=\"mtk7\">name</span><span class=\"mtk6\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">case</span><span class=\"mtk1\"> </span><span class=\"mtk7\">ACTION_TYPES</span><span class=\"mtk6\">.</span><span class=\"mtk7\">SET_SURNAME</span><span class=\"mtk6\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk6\">...</span><span class=\"mtk7\">state</span><span class=\"mtk6\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        surname</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">action</span><span class=\"mtk6\">.</span><span class=\"mtk7\">surname</span><span class=\"mtk6\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">default</span><span class=\"mtk6\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">state</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">}</span></span></span></code></pre>\n<p>but it can be done in many ways (not to count various libraries)</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"javascript\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">objC</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtkb\">Object</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">assign</span><span class=\"mtk1\">(</span><span class=\"mtk6\">{},</span><span class=\"mtk1\"> </span><span class=\"mtk7\">objA</span><span class=\"mtk1\">)</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">objD</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">JSON</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">parse</span><span class=\"mtk1\">(</span><span class=\"mtk5\">JSON</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">stringify</span><span class=\"mtk1\">(</span><span class=\"mtk7\">objA</span><span class=\"mtk1\">))</span><span class=\"mtk6\">;</span></span></span></code></pre>\n<p>If you test how long it would take to copy 10^9 object using those methods you get results like (every time we’re copying <code>objA</code>):</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">test with spread: 14 ms.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">test with Object.assign: 36 ms.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">test with JSON.parse: 702 ms.</span></span></code></pre>\n<p>Clearly <code>JSON.parse</code> is the slowest of them, and by some margin. Why should you even consider using it instead of spread?</p>\n<h2 id=\"not-so-obvious-behavior-of-v8-engine\"><a href=\"#not-so-obvious-behavior-of-v8-engine\" aria-label=\"not so obvious behavior of v8 engine permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Not so obvious behavior of V8 engine</h2>\n<p>Everything comes to how V8 is optimizing functions. Every time function is executed V8 is comparing object passed to it with <code>IC</code> (Inline Cache) and if <code>Shape</code> of that object is stored inside one of the “caches” then V8 could follow “fast path”.</p>\n<p>So if you have a function like that</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"javascript\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">function</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk6\">(</span><span class=\"mtk7\">obj</span><span class=\"mtk6\">)</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">let</span><span class=\"mtk1\"> </span><span class=\"mtk7\">result</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;&#39;;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk7\">let</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">0</span><span class=\"mtk6\">;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">N</span><span class=\"mtk6\">;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">+=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">1</span><span class=\"mtk1\">) </span><span class=\"mtk6\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">result</span><span class=\"mtk1\"> </span><span class=\"mtk6\">+=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">obj</span><span class=\"mtk6\">.</span><span class=\"mtk7\">a</span><span class=\"mtk1\"> </span><span class=\"mtk6\">+</span><span class=\"mtk1\"> </span><span class=\"mtk7\">obj</span><span class=\"mtk6\">.</span><span class=\"mtk7\">b</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">result</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">}</span></span></span></code></pre>\n<p>you can run it with a multiple object of the same shape and have a great performance</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"javascript\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">jack</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> name</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Jack</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> surname</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Sparrow</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">frodo</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> name</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Frodo</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> surname</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Baggins</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">charles</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> name</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Charles</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> surname</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Xavier</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk7\">jack</span><span class=\"mtk1\">)</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk7\">frodo</span><span class=\"mtk1\">)</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk7\">charles</span><span class=\"mtk1\">)</span><span class=\"mtk6\">;</span></span></span></code></pre>\n<p>Reason for that is because V8 is going to mark that function as <strong>Monomorphic</strong> and optimize its code. As you know only time it happens is when the function is called with one and only one shape.</p>\n<p>Let’s check what kind of shapes are produced when using each of 3 copy methods:</p>\n<blockquote>\n<p>Run code below using <code>d8 --allow-natives-syntax index.js</code> to get access to V8 internal methods like <code>%HaveSameMap()</code></p>\n</blockquote>\n<pre class=\"grvsc-container quiet-light\" data-language=\"javascript\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">objA</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> name</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Jack</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> surname</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Sparrow</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">objB</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> </span><span class=\"mtk6\">...</span><span class=\"mtk7\">objA</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7 mtkb\">console</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">log</span><span class=\"mtk1\">(</span><span class=\"mtk6\">%</span><span class=\"mtk9 mtkb\">HaveSameMap</span><span class=\"mtk1\">(</span><span class=\"mtk7\">objA</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk7\">objB</span><span class=\"mtk1\">))</span><span class=\"mtk6\">;</span><span class=\"mtk1\"> </span><span class=\"mtk3 mtki\">// false</span></span></span></code></pre>\n<pre class=\"grvsc-container quiet-light\" data-language=\"javascript\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">objA</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> name</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Jack</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> surname</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Sparrow</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">objC</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtkb\">Object</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">assign</span><span class=\"mtk1\">(</span><span class=\"mtk6\">{},</span><span class=\"mtk1\"> </span><span class=\"mtk7\">objA</span><span class=\"mtk1\">)</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7 mtkb\">console</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">log</span><span class=\"mtk1\">(</span><span class=\"mtk6\">%</span><span class=\"mtk9 mtkb\">HaveSameMap</span><span class=\"mtk1\">(</span><span class=\"mtk7\">objA</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk7\">objC</span><span class=\"mtk1\">))</span><span class=\"mtk6\">;</span><span class=\"mtk1\"> </span><span class=\"mtk3 mtki\">// false</span></span></span></code></pre>\n<pre class=\"grvsc-container quiet-light\" data-language=\"javascript\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">objA</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> name</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Jack</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> surname</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Sparrow</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">objD</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">JSON</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">parse</span><span class=\"mtk1\">(</span><span class=\"mtk5\">JSON</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">stringify</span><span class=\"mtk1\">(</span><span class=\"mtk7\">objA</span><span class=\"mtk1\">))</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7 mtkb\">console</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">log</span><span class=\"mtk1\">(</span><span class=\"mtk6\">%</span><span class=\"mtk9 mtkb\">HaveSameMap</span><span class=\"mtk1\">(</span><span class=\"mtk7\">objA</span><span class=\"mtk6\">,</span><span class=\"mtk1\"> </span><span class=\"mtk7\">objD</span><span class=\"mtk1\">))</span><span class=\"mtk6\">;</span><span class=\"mtk1\"> </span><span class=\"mtk3 mtki\">// true</span></span></span></code></pre>\n<p>As you can see only <code>JSON.parse(JSON.stringify(objA))</code> create an object that has the same shape as <code>objA</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 502px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 96.81274900398405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAATABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIEBQP/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAv/aAAwDAQACEAMQAAABzLudfuKDuNKZFwB//8QAGxAAAwEAAwEAAAAAAAAAAAAAAQIDERIhIjL/2gAIAQEAAQUCV2ApqTb0Z/VqcgZ4URVGdvGZP//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EAB4QAAICAgIDAAAAAAAAAAAAAAABESECEjGRMkGB/9oACAEBAAY/AoUdGLrb3RLEaRweeHYoqpPhLxtn/8QAHBABAAIDAAMAAAAAAAAAAAAAAQARITFBUWGh/9oACAEBAAE/IRXxIjpZhVzLdCK/Q3OtW2O4dCD4tDIo4LvESdd7mUjIts//2gAMAwEAAgADAAAAEDgvPP/EABcRAQADAAAAAAAAAAAAAAAAAAEAECH/2gAIAQMBAT8QVJt//8QAFxEBAAMAAAAAAAAAAAAAAAAAAQAQIf/aAAgBAgEBPxACZf8A/8QAHRABAAICAwEBAAAAAAAAAAAAAQARITFBUWGRsf/aAAgBAQABPxDHoFoWbfUgmiqEAawmHctaVdAfkxRprWYXqBcCKth4VFHJFivNRG4SOEy37EoUw3bBpmJwWMz9n//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Object\"\n        title=\"Object\"\n        src=\"/static/a2120ab743f32e25f870dd85ef3becd9/c7844/meme-dumbledore.jpg\"\n        srcset=\"/static/a2120ab743f32e25f870dd85ef3becd9/5a194/meme-dumbledore.jpg 240w,\n/static/a2120ab743f32e25f870dd85ef3becd9/8a430/meme-dumbledore.jpg 480w,\n/static/a2120ab743f32e25f870dd85ef3becd9/c7844/meme-dumbledore.jpg 502w\"\n        sizes=\"(max-width: 502px) 100vw, 502px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2 id=\"cost-of-non-monomorhpic-functions\"><a href=\"#cost-of-non-monomorhpic-functions\" aria-label=\"cost of non monomorhpic functions permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cost of non-monomorhpic functions</h2>\n<p>Here is our function</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"javascript\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">function</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk6\">(</span><span class=\"mtk7\">obj</span><span class=\"mtk6\">)</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">let</span><span class=\"mtk1\"> </span><span class=\"mtk7\">result</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;&#39;;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">  </span><span class=\"mtk3 mtki\">// Any costly operation</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk7\">let</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">0</span><span class=\"mtk6\">;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">N</span><span class=\"mtk6\">;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">+=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">1</span><span class=\"mtk1\">) </span><span class=\"mtk6\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">result</span><span class=\"mtk1\"> </span><span class=\"mtk6\">+=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">obj</span><span class=\"mtk6\">.</span><span class=\"mtk7\">name</span><span class=\"mtk1\"> </span><span class=\"mtk6\">+</span><span class=\"mtk1\"> </span><span class=\"mtk7\">obj</span><span class=\"mtk6\">.</span><span class=\"mtk7\">surname</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">result</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">}</span></span></span></code></pre>\n<p>What is important here is that function does sth expensive and thread blocking. This example is stupid but imagine there is some complex mathematical operation going on. That’s how we call our function in two different ways</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"javascript\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">jack</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> name</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Jack</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> surname</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Sparrow</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">frodo</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> name</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Frodo</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> surname</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Baggins</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">charles</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> name</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Charles</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> surname</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Xavier</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">legolas</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> name</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Legolas</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> surname</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Thranduilion</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">indiana</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">{</span><span class=\"mtk1\"> name</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Indiana</span><span class=\"mtk6\">&#39;,</span><span class=\"mtk1\"> surname</span><span class=\"mtk6\">:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;</span><span class=\"mtk4\">Jones</span><span class=\"mtk6\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk7\">let</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">0</span><span class=\"mtk6\">;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">N</span><span class=\"mtk6\">;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">+=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">1</span><span class=\"mtk1\">) </span><span class=\"mtk6\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk5\">JSON</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">parse</span><span class=\"mtk1\">(</span><span class=\"mtk5\">JSON</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">stringify</span><span class=\"mtk1\">(</span><span class=\"mtk7\">jack</span><span class=\"mtk1\">)))</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk5\">JSON</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">parse</span><span class=\"mtk1\">(</span><span class=\"mtk5\">JSON</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">stringify</span><span class=\"mtk1\">(</span><span class=\"mtk7\">frodo</span><span class=\"mtk1\">)))</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk5\">JSON</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">parse</span><span class=\"mtk1\">(</span><span class=\"mtk5\">JSON</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">stringify</span><span class=\"mtk1\">(</span><span class=\"mtk7\">charles</span><span class=\"mtk1\">)))</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk5\">JSON</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">parse</span><span class=\"mtk1\">(</span><span class=\"mtk5\">JSON</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">stringify</span><span class=\"mtk1\">(</span><span class=\"mtk7\">legolas</span><span class=\"mtk1\">)))</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk5\">JSON</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">parse</span><span class=\"mtk1\">(</span><span class=\"mtk5\">JSON</span><span class=\"mtk6\">.</span><span class=\"mtk9 mtkb\">stringify</span><span class=\"mtk1\">(</span><span class=\"mtk7\">indiana</span><span class=\"mtk1\">)))</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk7\">let</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">0</span><span class=\"mtk6\">;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">N</span><span class=\"mtk6\">;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">i</span><span class=\"mtk1\"> </span><span class=\"mtk6\">+=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">1</span><span class=\"mtk1\">) </span><span class=\"mtk6\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk6\">{</span><span class=\"mtk1\"> </span><span class=\"mtk6\">...</span><span class=\"mtk7\">jack</span><span class=\"mtk1\"> </span><span class=\"mtk6\">}</span><span class=\"mtk1\">)</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk6\">{</span><span class=\"mtk1\"> </span><span class=\"mtk6\">...</span><span class=\"mtk7\">frodo</span><span class=\"mtk1\"> </span><span class=\"mtk6\">}</span><span class=\"mtk1\">)</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk6\">{</span><span class=\"mtk1\"> </span><span class=\"mtk6\">...</span><span class=\"mtk7\">charles</span><span class=\"mtk1\"> </span><span class=\"mtk6\">}</span><span class=\"mtk1\">)</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk6\">{</span><span class=\"mtk1\"> </span><span class=\"mtk6\">...</span><span class=\"mtk7\">legolas</span><span class=\"mtk1\"> </span><span class=\"mtk6\">}</span><span class=\"mtk1\">)</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtkb\">test</span><span class=\"mtk1\">(</span><span class=\"mtk6\">{</span><span class=\"mtk1\"> </span><span class=\"mtk6\">...</span><span class=\"mtk7\">indiana</span><span class=\"mtk1\"> </span><span class=\"mtk6\">}</span><span class=\"mtk1\">)</span><span class=\"mtk6\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">}</span></span></span></code></pre>\n<p>This is quite common scenario. We don’t want to affect existing objects, so we decided to create a copy of it.</p>\n<p>If you set <code>N</code> to <strong>10000</strong> and run this loop, the result might surprise you:</p>\n<pre class=\"grvsc-container quiet-light\" data-language=\"\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">test with PARSE: 2522 ms.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">test with spread: 10046 ms.</span></span></code></pre>\n<p>What? Spread is 4 times slower than <code>JSON.parse</code>? If that’s weird remember what I’ve said before</p>\n<blockquote>\n<p>V8 is going to mark that function as <strong>Monomorphic</strong> and optimize its code</p>\n</blockquote>\n<p>Because the test is not a simple function (code is simple but expensive to run), initial cost of calling <code>JSON.stringify</code> and <code>JSON.parse</code> is way lower than running that function without optimization.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 229px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.117903930131%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABVElEQVQoz2WR6VLCMBzE+9TCBw8+CK8gT+MFKEKLUKAqFLnKJQiUHjmasqaAIpCZZDLJ7G92968Y7w2k0zfgjCJa6/U6OqFpRVT0KgIh/t63f4BlWSCEYjiwMPueSy2BaZpggYCilsqIx2MIONsJ5Q4FSpqKSkUHoewE2Ot14fkEo+EA88USzmqJXr8PLkIoBfUVlxfnoMTfOwxD5LKPyOSeDoDhDtj+bMF2nM2dUgrXddHpdMF5AKVaN5BKJSFEsAfKbZpNmK0WguA08mw2BWVMRmUS5sH3PQxkDTyKnC+oiMXO/jncRr6/u8VDJguf7LsNwy2w2fiAKyN/TcayzyE8x4ZhGGBcAst6DYnEFUTADxy+GXXUpPsoxrHD8XgkxVzC+phMp/DcFTrtthyK7LBU1pFKXoNRcuDwJf+MoqptpnkMjMS/Q1ksbbgrG7WqDp8J/AAS6gx5DMFC7QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Object\"\n        title=\"Object\"\n        src=\"/static/1c85aa7b6330ebcd1906c9da481cb947/fe1bd/ic.png\"\n        srcset=\"/static/1c85aa7b6330ebcd1906c9da481cb947/fe1bd/ic.png 229w\"\n        sizes=\"(max-width: 229px) 100vw, 229px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>In the second test run that function becomes <strong>Megamorphic</strong> and V8 stops optimizing it. You can check <a href=\"https://gist.github.com/burnpiro/03ebfca377bc037cda840757cddc528d\" target=\"_blank\">this gist</a> to try it on your machine.</p>\n<h2 id=\"conclusion\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>It’s important to understand how JS optimisation works when designing complex computation methods in JavaScript. Sometimes even a simple thing can cause performance to drop and you can spend days trying to figure out what’s happening.</p>\n<p>I’m not saying to replace all spread operators with <code>JSON.parse</code>, that would definitely decrease performance of your app. My point it that sometimes reducing performance of one thing can drastically improve performance of another. </p>\n<p>Case I’ve just describes is really special one, and might affect you only when a function does sth expensive, but knowing that can help you approach the problem differently.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .quiet-light { background-color: #F5F5F5; }\n  .quiet-light .mtki { font-style: italic; }\n  .quiet-light .mtkb { font-weight: bold; }\n  .quiet-light .mtk7 { color: #7A3E9D; }\n  .quiet-light .mtk1 { color: #333333; }\n  .quiet-light .mtk6 { color: #777777; }\n  .quiet-light .mtk4 { color: #448C27; }\n  .quiet-light .mtk9 { color: #AA3731; }\n  .quiet-light .mtk10 { color: #4B69C6; }\n  .quiet-light .mtk5 { color: #9C5D27; }\n  .quiet-light .mtk3 { color: #AAAAAA; }\n  .quiet-light .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));\n  }\n</style>"}},"pageContext":{"slug":"/2019/08/can-json-parse-be-performance-improvement"}}}