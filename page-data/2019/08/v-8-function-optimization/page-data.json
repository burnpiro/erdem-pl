{"componentChunkName":"component---src-templates-post-template-js","path":"/2019/08/v-8-function-optimization","webpackCompilationHash":"66893a366a98cf7c4395","result":{"data":{"markdownRemark":{"fields":{"slug":"/2019/08/v-8-function-optimization","tagSlugs":["/tag/engines/","/tag/javascript/","/tag/performance/","/tag/internals/"],"readTime":{"text":"34 min read","minutes":33.9}},"frontmatter":{"description":"JS engines are complicated piece of software. I want to quickly explain one of the optimization techniques V8 is using to speed up your code execution.","tags":["Engines","Javascript","Performance","Internals"],"date":"2019-08-06","title":"V8 function optimization"},"html":"<h2 id=\"setup-optional\"><a href=\"#setup-optional\" aria-label=\"setup optional permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup (optional)</h2>\n<blockquote>\n<p>If you don’t want to run it on your computer, please skip to <a href=\"#what-are-we-trying-to-optimize\">this section</a></p>\n</blockquote>\n<p>First, we need to install V8 to be able to run it without whole package (node or web browser). I’ve created gist describing the process for Linux users.</p>\n<p><a href=\"https://gist.github.com/burnpiro/d85d836200df93af892877c2cf37f12c\" target=\"_blank\">https://gist.github.com/burnpiro/d85d836200df93af892877c2cf37f12c</a></p>\n<p>If you’re a Mac user, it should apply to you as well. If you have any problems with installation process, please refer to <a href=\"https://v8.dev/docs/build\">Official Docs</a></p>\n<p>After installing you should be able to run code like</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// index.js</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'it works'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>by calling</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">d8 index.js</code></pre></div>\n<h2 id=\"what-are-we-trying-to-optimize\"><a href=\"#what-are-we-trying-to-optimize\" aria-label=\"what are we trying to optimize permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What are we trying to optimize?</h2>\n<p>Our test function looks like that:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">obj<span class=\"token punctuation\">:</span> any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> string <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token constant\">N</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    result <span class=\"token operator\">+=</span> obj<span class=\"token punctuation\">.</span>a <span class=\"token operator\">+</span> obj<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Let’s assume this function is called thousands of times during our script execution so it’s important to run quickly. Before I explain how that is optimized in V8 we need to know what are Shapes and how Inline Cache (IC) works.</p>\n<h2 id=\"shapes-maps-in-v8\"><a href=\"#shapes-maps-in-v8\" aria-label=\"shapes maps in v8 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Shapes (Maps in V8)</h2>\n<blockquote>\n<p>Academic name of the Shape is “Hidden Class” which might be confusing especially in JS so everyone calls it differently, but name introduced by FF team is probably best.</p>\n</blockquote>\n<p><code class=\"language-text\">Shape</code> contain a lot of staff, but when people use that name they mostly referring to it as a table of <code class=\"language-text\">descriptors</code> for object properties. Shape stores other information as well, like size of the object and pointers to constructors and prototypes. I’m going to show you that in the example soon.</p>\n<p>Let’s start with a simple object:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  x<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  y<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>It’s representation in V8 looks like</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/259952ab89a53e4be50f41810e15d7c3/8e7c5/Shapes.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 581px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 55.24956970740102%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACjklEQVQoz5VSS08TYRSd4qhRjIZEtib+An+Amkh8BBdqXLn0J5goGxYmLIrUNkTEClEx+OBteRSYTttpZzrTDgwtBXkUBjoDBQatLZUZWkDb4nW+UdmoC77NuTn3kXPPdzHsgC9BeXCEqz6vGcQ5mO7vy7NvW+ELF4Cpvl7AJpVxPDBD4+wsg0+sRvAhoX+/OcP4S1KMH0+QBL4ZYnGNC5QsuAhj4Fh352PJQ0Lc7cpnRnmAuVkQiWE4qEDsQ73tKEJX83NbT70N2i11u30NTwrikLMw6egpYBNrkdqQyFlHFoJWPa4jwgNn9hXSvjsbAfrpJ8rzSAtxjdkge3l/da/btjf9ERS/D/T1YXs8DEtuErClnASh+SBwMRbkrTj4ptyX/jR9ZRkS5mMQ6+8FkBYhHxZsv1OmZY/72uZI6JkmjNSqo7xlZzxsifZ0W7AFZf6BtqMWv//4BiupRBOqBvhlxbLXc243lVIgl4XsujJDNTacRcNuX71S+l9PlIRyHfbAeOlkuhpxqUz6MMLqVy2lWi63gnIZVR3TqZK7t24aHsZdwxfTQfYh0/r6fpfNWiWRRFWkq7MKS6wkKrPZrJLbzm0mk5/voeJioXgIodPhKNNUld/a0tTMxsagCcOO36ioOGmop7w2WBRhjfbDeoABFK/SPsAcDscRmqZPcxxX7nQ6j6FiPTbU19TUmCiKKhMEoZwgiFOIq7xw/gRCX8tLK/umFYSOtl3Z7SruRCNFcWiw+JcF0WjUQLPZ/E+L2ix1hh38+3fWcFcHuF8054kmO8wNDoB+NoDxPI+JomiKx+OmSCRiNMmybKDdbsdisZhJkiQTQsQlWcY4bMlFmPUfBpl05WWSAJ3X1bbDT9RapbMCPXcrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Object\"\n        title=\"\"\n        src=\"/static/259952ab89a53e4be50f41810e15d7c3/8e7c5/Shapes.png\"\n        srcset=\"/static/259952ab89a53e4be50f41810e15d7c3/0783d/Shapes.png 240w,\n/static/259952ab89a53e4be50f41810e15d7c3/782f4/Shapes.png 480w,\n/static/259952ab89a53e4be50f41810e15d7c3/8e7c5/Shapes.png 581w\"\n        sizes=\"(max-width: 581px) 100vw, 581px\"\n      />\n  </span>\n  </a></p>\n<p>If you look on it, there is an obvious distinction between object values and their description. Every property on that object is stored in memory according to <code class=\"language-text\">offset</code> defined in shape. In our case property <code class=\"language-text\">x</code> is stored with <code class=\"language-text\">offset: 12</code> which tells v8 to look for <code class=\"language-text\">obj.x</code> value by offsetting pointer by 12.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/024a2dd52718fd7d45927b3b1ddd0e6b/2d9b7/memory-example.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 604px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 15.066225165562914%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAAkUlEQVQI12NgYGCQBmJFKC0DxKwM+IECEIsBMQdOFaU5VcL////n+v/jP8/Ty2/5Lhy4zn/58G3+y4cg+MKBG/xPr7zjmzdpiUh34wQJoFpukNjFgzf57597zn/lyB3+S4dugfWADbx+6t6GO+cf/7997tHHO+cefcaBPwHVfL545PrXW2cfAvmPP9+F8D8j8wGA0HGkywCGtAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Object\"\n        title=\"\"\n        src=\"/static/024a2dd52718fd7d45927b3b1ddd0e6b/2d9b7/memory-example.png\"\n        srcset=\"/static/024a2dd52718fd7d45927b3b1ddd0e6b/0783d/memory-example.png 240w,\n/static/024a2dd52718fd7d45927b3b1ddd0e6b/782f4/memory-example.png 480w,\n/static/024a2dd52718fd7d45927b3b1ddd0e6b/2d9b7/memory-example.png 604w\"\n        sizes=\"(max-width: 604px) 100vw, 604px\"\n      />\n  </span>\n  </a></p>\n<p>Ok, so now you know what a Shape is but why is it so useful?</p>\n<h3 id=\"shapes-usefulness\"><a href=\"#shapes-usefulness\" aria-label=\"shapes usefulness permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Shape’s usefulness</h3>\n<p>When you create an object, you don’t really want to store all information about it again if you have a similar object in your system. That’s why V8 is reusing its shapes.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dcf8b8ccf851959e54fbd4a4c8a48bf1/8e7c5/multiple-object-shape.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 581px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 86.23063683304647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAAD1ElEQVQ4y5VUXUybVRj+aL/NjZkU58VujAkkG2XRzF1Mr3Yz1IjRCxMz8cIbf+ISXZYs8cJsqETN+NlAzcBk6zRbthFoocCgf/SfstJS+t/SUfrDVz7afu3XrpTSNta+nvOtNYahiefmOXne97x5znmf9xCGoOqQk16O69wakFtlFU/SBWqXop1A64132g8Q/3eJLIOkm3aqvJQbHCE7eGjXum5F1YZjLUebD+3Oj6oUHIaVcl5q3kAujY6QczdvkHG9lnSNS0guGIlE2svl0p+AVjqd/g5zaMtDsKdCxqhv+E+VqOC7UFsMw1zDXOWPCn+vghGkjFOokL2VNhmHFu/dvTI7PNRHzSn7lsdG+7iklYBfmEqnetJsepCiqDcxl9vebnjxyJHGknmBl9VreDmDjpeQzzZQWjV3rbBKcQ3Ca5A0GYFZmAcIBWFDp4G9FTNUw3vHX8Jb/u6YRnRjH8bp679clQwOwMzw9YJdPFrOPDSVfVOTZcIcNjRHCqvCzQp13EnbWlOwsb9+eODC+RakUAjh4LEiwqxSLvi0s5NT6BwX9wQeTIPx9u+gvSWCkFwGHuk4EMgyVdnizM6s+cGOPWaraD2q0/WCj416ccaoA8fIvUzJugilxYc/1GMx9dxX7MJ8ASkLI6QKNivlmpBQhId2GgP0CgTjj8C36fGM6O40o3yui6vTk105jwsSjmXIOuzlxwbtWcyfFLY2eial+zW/iZ5zTkgEjnGxwC4ZE9zt7REQdHTzTLlUruIOswx7sWYZ7lqHXz7xfL5YDOBYNp/XY+5E6zHceb70av+B+z9+f7j3/BdNXZ983IT2TTcvX2oi1qn1s3XLJJKJK/hQnKWfwdj9TdcL+a0thiuYybifJfmN5zo/OMhdWav+OmsxV1yTE7Thzu1kamE+6ZmSJgn/ir+FSTLnMunsZ5FAVPjPjnZ0dDTF4/GPEonERWSn97GyM6+9KsCxZfFob3ROCSGFHPJLFoDVAKDpeWKb5lv7+IaQ+tSjnPd0ION72xIxnazVfMrYX37YyXHIzP2y4SGQ/vzTtuzXodKabKbknpCUuCR33PE5VYyCWD1WtYYt4Np0rGFe2NZ2EI8gTdMkUslNCOomWZuUgZLdhhTKIKJUQAGpxMgVlLunj4aYoD/GUhBOrIErZr+EeZ3JwNut0DclrY/e61sWc/+Ozfrt9pKlu2y3dSODd//d0Vw2J8KPX9wpbgWcgRbMbWzEeHtNEkRC//451H4VAnX4fhWqwLJswevzvoI5r9f7VEH0+E8w4OcBTZEQp0mgYySwKRIpJv8CS8J2AqR1kuYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Object\"\n        title=\"\"\n        src=\"/static/dcf8b8ccf851959e54fbd4a4c8a48bf1/8e7c5/multiple-object-shape.png\"\n        srcset=\"/static/dcf8b8ccf851959e54fbd4a4c8a48bf1/0783d/multiple-object-shape.png 240w,\n/static/dcf8b8ccf851959e54fbd4a4c8a48bf1/782f4/multiple-object-shape.png 480w,\n/static/dcf8b8ccf851959e54fbd4a4c8a48bf1/8e7c5/multiple-object-shape.png 581w\"\n        sizes=\"(max-width: 581px) 100vw, 581px\"\n      />\n  </span>\n  </a></p>\n<p>code responsible for this situation might look like</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> obj1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  x<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  y<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> obj2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  x<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n  y<span class=\"token punctuation\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> obj3 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  x<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n  y<span class=\"token punctuation\">:</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"not-all-objects-with-the-same-structure-have-the-same-shape\"><a href=\"#not-all-objects-with-the-same-structure-have-the-same-shape\" aria-label=\"not all objects with the same structure have the same shape permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Not all objects with the same “structure” have the same Shape</h3>\n<p>If you compare these two objects</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> obj1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  x<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  y<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> obj2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nobj2<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\nobj2<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>they might look the same, but they have a different shape. Shape of the first one we’ve already discussed. Shape of the second one is here</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c7ee17c162fc4e6a44d5e4bc2e7c18e0/8e7c5/shape-transition.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 581px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 65.57659208261617%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADHUlEQVQ4y5VSS0wTYRBeWhBSJIaTiRjwddBEo+AFL0YORg+aeNGEk5JooibGRBJNCBwMMTE8TMBHKY8Djz5RgVqgbLt0WUof9EEhlFIpbaFUC7R0YVsaWmTcf5N6UDg4yZ/5Z/6ZL/N/32DYX8bn8bC96Sk+utMUKWRMBvColLA9aYJNNkb5NUKThf2PhSmSh/wGOfrcPzxocw30jQa1uJ0FfIbyO5MmXlt1VVZT5YtcS3eXAFaWBA6ZRNBeUy04CJP/pLyct98D7CQykQ/qiBeMxbwx3fdlXtvR7glRpIe9e7CpFRt/fI7ix4HhtcpbMk+cLsqcl8gyUFOU0BRHKfLRgrL/6SqhebyOqy+ngU0ySeMiroa5b0oIG/QAbhd48RHYd7yed3UcR5t6ShyhSLBJxXsJxKGe6k7XjIha6gY/fYCB5qb4iEiY9KqHktNfPicx67K50rxoqLL4TDW25cmXvTrJsXSTT9lfyvh9DCS2YdO7GJtRyK+x6Vz0ZlXIPm5bJ4EFAs/wINCseAtDKsACySUgZ3SgtWvAF/cCbh+6jhrqm2u5KSM03cUe52ok0smGWecKC/NQflE9dCespySRiXFhRE+J4hazyKaQizBXYLYqwoR/xVMx8IY87aj46OGCrFMni7L3o+NIXt6hx/fuHrw2AV/gxm5qF5Ct/Vx7xU33ppaTf8c4cTNEaD6ye/j+h2ZEGCWJW+m+74OqkgCheYK3ie7LGuor5lXKCqO4pwLzL/lvMwyzFYvHIBQKcYDCujoOcF1HiLdYbpz9XyFpt0LcONGRBvRr8UYILEFofAyCpA5gwQ0r5ChgY2NjOU6ns8Dtdh83GAwcP72tIrQ2GaqG+jOJtVUPxGLA/Ah6idaWs2w+B9WYpeLX+u5OsMql28saPJV02FNulTL1DwUulwtTDKv/xDTDzCI6WGFm84tLcq5eOM+pTHS0NWrbW0HR2JCUN9TD1GcFWORSwBwOBxYMBjPY72YgMGRSsZjzZVdKs+lo1EjT0b1wOGx6+OBBftmlixwdflz9FuZmgTZOJFmlIWGzgHOgD34DiDDrjjYiKsoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Object\"\n        title=\"\"\n        src=\"/static/c7ee17c162fc4e6a44d5e4bc2e7c18e0/8e7c5/shape-transition.png\"\n        srcset=\"/static/c7ee17c162fc4e6a44d5e4bc2e7c18e0/0783d/shape-transition.png 240w,\n/static/c7ee17c162fc4e6a44d5e4bc2e7c18e0/782f4/shape-transition.png 480w,\n/static/c7ee17c162fc4e6a44d5e4bc2e7c18e0/8e7c5/shape-transition.png 581w\"\n        sizes=\"(max-width: 581px) 100vw, 581px\"\n      />\n  </span>\n  </a></p>\n<p>During code execution V8 is creating 3 different shapes and transitions between them to describe end result.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> obj2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Shape M0</span>\n<span class=\"token comment\">// add \"x\": Transition to M1, offset 12</span>\n\nobj2<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Shape M1</span>\n<span class=\"token comment\">// \"x\": at offset 12</span>\n<span class=\"token comment\">// add \"y\": Transition to M2, offset 16</span>\n\nobj2<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Shape M2</span>\n<span class=\"token comment\">// \"x\": at offset 12</span>\n<span class=\"token comment\">// \"y\": at offset 16</span></code></pre></div>\n<p>the same goes when you’re creating classes</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">size<span class=\"token punctuation\">,</span> name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Shape M0</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> size<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Shape M1</span>\n    <span class=\"token comment\">// \"size\": at some offset</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Shape M2</span>\n    <span class=\"token comment\">// \"size\": at some offset</span>\n    <span class=\"token comment\">// \"name\": at some other offset</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To be 100% honest V8 doesn’t store whole shapes when it does transitions between them.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/00f6b9dd30376984b5b47ddba6d848f1/a038c/honest-shapes.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 366px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 104.0983606557377%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAAEpklEQVQ4y5VUW0xbdRg/hRLBZeKiRkUc+mBmluzFlyWyRZM96JsvvuiD8X0PxvCgvsg2JRsYhoxbCzKEISunp6XQQnt6L6VcWkpbCoWOS4FyLaWjh7FCTzmf3/9A2WJinP/ky/96fue7/H4flXTYduN2q5AYtGUSDltm02w8TI+7gbNbmykcsBbNWWe6yZJqvlFOdVVVUn9V3ka7c2qdd25Tit+qKHn5z/hBwAfubgU4H3TAuLIb2BY5xF1OOPJ6ekVAAAlvt1LZ9amFZyQwG5I88YxJnj+nknar+cmIa2zbanZvmFh/anTYuTc8FNy1mn8UQVaWJCdg1AsPuPWD5Nr54pffyH/pHdkrBTnl7xXnZu/k338nekbWoV5N2YbNols2GhSsvIk2yJpoXUMdPdOnoRMuJz2t6aH/iS15fuOUNVIFZ84QwByyXx+0D8DjHYDZGYhYTODX9MBEjwo4zDksLcJj9yhQ62rmoySrv7I9oL3G1lR/KTjtlzf7NJ+uq5TnTyM4CTek7VX61QwE1KqDmNPBP/WO85hL/tA/wR/6vPyq1cxT3NDgge1+K5hbmmG48wH01d07wrAg4xlrJyBFb735+uVLl87i8qytrZXtb2yAntrfeTTwKLogrOuDqNkEEJqCNasZKJiahAOvByYZWrBghRNORxoW5mB/xNVHAN8tLj43368Tc+p60KG2t7WCsVnOs80yYGruAvnBBLJjQT8A6+gIFTcbq/dD0wluJiSsez1pPrIIyQnvbNKo/4KAlBQVnc2G7ul+2D1OKwDBUgiURo/TPbU16WCPKj2lUafn9f1p8WGS45YwT7C3t0cmmI9E6sn5latXX8uTSguyOdx02AwQ3wLMG8Bc+NjmHx0bFuUpFodqqLyTv7K8TMdiscDc3Nw4x3HBUChUJlJGJpMSsCxt/Crl18smtjrCGn5ZNrIVS0aDaIusvmLVYqrwMXQFFdX2Sk8iykd7Gy33q/dLcrMgD2vuUv+b2P/Gw4OpyWfk39l+MYS40VAWVinLZxn6V1dry70wQ/8UHdDeTlpMn4v5JVrd2xXfauvrPsQqf2L5o+VjVEmpl1aUItVKB9vbSoc62kvxvpQ6mhgHn0oJrs4OLD8NhJMcMp73jKkJyOHmRk5WKUhcDSwvwp57DJtJO+hlTaBrrAc8B5gOwhqhzaF7BDI+BFV08RZ5U2ZpQJci1dt12ERdBh32U8CI2cTs+7wQcw2ld0aHhS2XU0C5CRiFkAr4hBWrRaCiKvqzRHjWk4nHYWdhIcVvxwD3/lWl4uIz6QkiYEDNMEYkv0Eu4zFUASsu7CMYNzYioIcCElsQP0hwHEv49ySVEnm4tbNjI+cXL1wozMvLK8x66FZ0MSaUKBKbJwoxyJtgCEOf1fYC9sVjpZAxNTn5zdrqatXqysrNtWi0KhgIfJutuFQqPfdBScmruCxk5TK948/7opbVtTWi9LB7w2hXJxAFISfhP/kF3GNqa9AuavlRv1aN4cGiYYAP67SAIaN3fYD3sO10HAOekJYkPvf5mZxfv36darl541QpsUE7A5EFyAR8/NGkn8wgBAOArQtIk9mwW+Fv2E+bYYQGSEwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Object\"\n        title=\"\"\n        src=\"/static/00f6b9dd30376984b5b47ddba6d848f1/a038c/honest-shapes.png\"\n        srcset=\"/static/00f6b9dd30376984b5b47ddba6d848f1/0783d/honest-shapes.png 240w,\n/static/00f6b9dd30376984b5b47ddba6d848f1/a038c/honest-shapes.png 366w\"\n        sizes=\"(max-width: 366px) 100vw, 366px\"\n      />\n  </span>\n  </a></p>\n<p>It doesn’t copy information about <code class=\"language-text\">x</code> property into <code class=\"language-text\">Shape M2</code>. That allows it to be shaped in a tree like structure when having different objects.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> obj1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nobj1<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> obj2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nobj2<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\nobj2<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> obj3 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nobj3<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\nobj3<span class=\"token punctuation\">.</span>z <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\nobj3<span class=\"token punctuation\">.</span>k <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> obj4 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nobj4<span class=\"token punctuation\">.</span>i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\nobj4<span class=\"token punctuation\">.</span>j <span class=\"token operator\">=</span> <span class=\"token string\">'test'</span><span class=\"token punctuation\">;</span>\nobj4<span class=\"token punctuation\">.</span>k <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f308570cd2897cd9ddfd63e125ec184f/2f6b3/shape-tree.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 677px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 72.52584933530281%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAADFElEQVQ4y41TTUwTQRTeCkJLSPxJDBj/ggdv/pxIpEKixiAQDBcDiAc9eBGiBxNjYmKChAPqCUSEohEaoiiWthYslLbbLaXbpX+ULaWUEguFLrTd0gKVEnTcWWhjkQRf8uW99817LzPfzCDItkW0Gg70wETkhLQa4FUMgiiBA+9A/yfIF/L5PMalM0iJ9yzJJAitGEDooUEWAXkfkrAIhrID13XaQ0tq5QtS1NM8NyhvWVIqbkK+urICDtrHgBvvIaQS5G8DACTlSNRsRHazHYXpyP9YvAk4J47OyKSY/HXjsLFLaFrG0Mfb65ztUt7dG6WpMJj/3nfBKRZhyrdvlISwQxnGUHl8Xkoxn88WmQSt2SFcT62QNgBmpkEQQ+vZI9+u2r+tX1reubPssXUtzedDBB5YdzpA1D4OVnRaFCm7cplbmJeXcTU3l1tZXg6FRxxTU/disdhqJLIyIejoPA258tJSXnH+pYySgnwe3C0DqCcSpOlqphaEw2GSmHZn7Hr8QbmcK5PJjjA4vBmNcvaSq6TmwcGch4+2tNW0tzUwWr2iFAMVMO9qakwa4BR2sDmzXjbW/fGl9p2gwSUWPQPj1szfuO7AD5n0KSZorR8VdtSGdVgdYu75AigNClb0w72wMUDaOCblEGI0Gjk4jnN8GjX77hh92imNGpBSMaDUqg0wimfFMPWJRVS1DjmvagisEfgveHsAbMSAzzlZCBsXPJ59lPhrYoeTzFDoLaKeY1GapmD58sLC+8T7nfc+gdzm2hrAPncXIL5A8DpF09f0U65MWGBzOJL0EQ0pt4Ksk8gsReWbrGO3ZrzzZ+LrvnAk22yzVbg9nqL7jU1pSc3jk5Os9/d9S+L9BL7rZVx8Xv8v6ff7UyBIkmRzx44dLqqV7POgUVU1cykk2taqn5b0moHNcor59+mz8n4F1i6wGDo/6CMjw6N7/qBlfIQdGNaiNWGLGVBGAvj1uhgYNRy336lKjRAGW8BsAkEGPy2muT0H1tbVJWKXy2UIhULAbrc3xzmL1Vo06/EAt9u9KpZIiv4A0i7H3CnMjbgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Object\"\n        title=\"\"\n        src=\"/static/f308570cd2897cd9ddfd63e125ec184f/2f6b3/shape-tree.png\"\n        srcset=\"/static/f308570cd2897cd9ddfd63e125ec184f/0783d/shape-tree.png 240w,\n/static/f308570cd2897cd9ddfd63e125ec184f/782f4/shape-tree.png 480w,\n/static/f308570cd2897cd9ddfd63e125ec184f/2f6b3/shape-tree.png 677w\"\n        sizes=\"(max-width: 677px) 100vw, 677px\"\n      />\n  </span>\n  </a></p>\n<p>Notice that even if we using the same attribute name as 3rd property, in <code class=\"language-text\">obj3</code> and <code class=\"language-text\">obj4</code>, these are two different shapes. Reason for that is because shape is related to transition. If you could have a global shape that represents <code class=\"language-text\">k</code> property, it requires defined <code class=\"language-text\">offset</code> property. That might work with the same object structures in memory (offset is set base on how much space rest of the object takes before property). So if you have an object like <code class=\"language-text\">obj4</code> then property <code class=\"language-text\">k</code> might have a different offset than property <code class=\"language-text\">k</code> on <code class=\"language-text\">obj3</code> (transition to Shape M7 is different).</p>\n<h2 id=\"inline-cache-ic\"><a href=\"#inline-cache-ic\" aria-label=\"inline cache ic permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Inline Cache (IC)</h2>\n<p>Maybe start with some code this time?</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token constant\">N</span> <span class=\"token operator\">=</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> obj1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nobj1<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'Jake'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getMeName</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">o</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> o<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token constant\">N</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">getMeName</span><span class=\"token punctuation\">(</span>obj1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>and then run this code like</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">d8 --trace-ic index.js</code></pre></div>\n<blockquote>\n<p>Off-topic: you might wonder why we’re running function that many times. It’s because V8 won’t try to optimise function unless that function is marked as <code class=\"language-text\">hot</code>. And you get <code class=\"language-text\">hot</code> status when running function many times.</p>\n</blockquote>\n<p>Now you can open <code class=\"language-text\">path/to/v8/tools/ic-explorer.html</code> in your browser. That page allows you to explore what is happening with inline cache.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1babf57079d1b038ded7d155f1a003ec/1bae2/trace-ic.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 350px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 132.57142857142858%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsSAAALEgHS3X78AAADn0lEQVRIx5VV2VLiUBTk/3/BKkdHX8byySp8GRdKUVAWQXYQEpYACQk7BFk8c/pAUkFQa27VBXKT9O3u2+fgo/8cHx8f3973NTWNFFWlWrVKxUKB+oMhKZUy3d3d00MwSMGHB/l+SbySZZny0mq1EmAH3PvbZ0+nNJlM6P39nWzbpuVyKdeWZVG32+XZk+9eryfP/MTY57+8pOenJ7lYLhdUKOSFpTOwAYAwVVaCWS6XWUWFdF3fZXhyekq3NzcuYKlYoF5/4ALO53NhPhqNqFgsUiqVokQyQW9vb7LZDiAkmZ2OvDAYDKjRqPP3UCTiGtLxu8PPgBFAZrOZTIbake3DR71WpZPfv6nV1qlcKtD9fZBZvFKtXpMDa7fbVOVDa7VasnGr1aYpe7/XQ3xoWpMCgYC7mM1kBNw77KlN7yw/kUjIBOvPcl1AezqhOrOJx2KUyxdpwi+XSyVhV2KvFKUiVmgcscFwwOxsNz57JcPsX4eHEg9db9MDZy8ai9OQ5UHicDhkwIb4GQqHqMSbedl58yiAoF/gUGMsFnP2qMlA483Daxbj8Vii02w2qd/v83ML95S9LAWwzQCxeIzzGBZmyWRSfIKP4XBYGCGf2WxW8ocs4pBMZvxZugAqikLn5+ebrZYUiUSoXFG2DgWykcdQKETpdEosgFVQpqrVbcApH4qmNUg3DDdvyKfB15jwFuuG0RFQJ/CQDOmLxfIzwwqdnf0hjf1p8by6+ivNAPlTFFXAVFaBjQA4Hk+2/Nv1kB98fHx0b6JWdd3YesEJMgDBGMw+59Bl2NFRCTWq1WriT5MroV6vcybzsgaPkUF0oZ96owDC2IODA1nomh26DdxSJpuTmKBm4RfKDXGJRJ4F/Ku+6HMyhuw5RW+apsgCkNNt0ChwD+vrxkBfe4gO7ff7JQrxWISSrynKs9x0OkMq583JHaIDMEgHCUx4u5ND+HRxcbHZakUxrmmVPfUOVA4AkUOUXzQakcYcjb/QeOOtCzizp2TwSVf4dA3TEvmW1ZXIoNTAHHlEbAD63Z+Xz4nJ0dGhvAD/rq+vKMIliBo3OoasQQUOpb/p5t4D2Y1Nx5TaXSteyimiUrzDGxkv0F5Ak1lkc1mqNzRKp165B5apwHVaLBUpl8vLoSCXTly8+dvbsdFNjo+P1hUxGUn3zjDQup0tRB7KDxaE+UDSmTRVeRPTtPY3WGQNjdS5iUCjVr174xrAyKSTV++/njP+AVaUAli+qlywAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Object\"\n        title=\"\"\n        src=\"/static/1babf57079d1b038ded7d155f1a003ec/1bae2/trace-ic.png\"\n        srcset=\"/static/1babf57079d1b038ded7d155f1a003ec/0783d/trace-ic.png 240w,\n/static/1babf57079d1b038ded7d155f1a003ec/1bae2/trace-ic.png 350w\"\n        sizes=\"(max-width: 350px) 100vw, 350px\"\n      />\n  </span>\n  </a></p>\n<p>Important part of it is <code class=\"language-text\">state</code> which can be one of the following states:</p>\n<ul>\n<li>0 uninitialized</li>\n<li>. premonomorphic</li>\n<li>1 monomorphic</li>\n<li>^ recompute handler</li>\n<li>P polymorphic</li>\n<li>N megamorphic</li>\n<li>G generic</li>\n</ul>\n<p>In our case <code class=\"language-text\">state</code> is set to be monomorphic which means that function is optimized to receive only objects with one defined shape.</p>\n<p>Now let’s define what IC really is…</p>\n<p>Unfortunately, we have to do it in the hard way. By looking into some bytecode (There’s a <a href=\"https://medium.com/dailyjs/understanding-v8s-bytecode-317d46c94775\">blog post</a> about understanding bytecode by <a href=\"https://twitter.com/fhinkel\">Franziska Hinkelmann</a> if you’re interested). To do that just run</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">d8 --print-bytecode index.js</code></pre></div>\n<p>Output of that is quite long but we’re interested in last part. Look for <code class=\"language-text\">generated bytecode for function getMeName</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">...\n[generated bytecode for function: getMeName]\nParameter count 2\nRegister count 0\nFrame size 0\n   69 E&gt; 0x2d34c959f9d6 @    0 : a5                StackCheck\n   86 S&gt; 0x2d34c959f9d7 @    1 : 28 02 00 00       LdaNamedProperty a0, [0], [0]\n   91 S&gt; 0x2d34c959f9db @    5 : a9                Return\nConstant pool (size = 1)\n0x2d34c959f989: [FixedArray] in OldSpace\n - map: 0x0741c8840789 &lt;Map&gt;\n - length: 1\n           0: 0x0741c8843eb9 &lt;String[#4]: name&gt;\nHandler Table (size = 0)</code></pre></div>\n<p>Look on <code class=\"language-text\">LdaNamedProperty</code>. This method is responsible for extracting named property from <code class=\"language-text\">a0</code>(argument 0). Property name (in our case <code class=\"language-text\">name</code>) is determined by <code class=\"language-text\">[0]</code> constant from <code class=\"language-text\">Constant pool</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> - map: 0x0741c8840789 &lt;Map&gt;\n - length: 1\n           0: 0x0741c8843eb9 &lt;String[#4]: name&gt;</code></pre></div>\n<p>After getting property value from argument, function stores it in the accumulator (function returns accumulator at the end).</p>\n<p>That process generates sth we call <code class=\"language-text\">Inline Cache</code> (<code class=\"language-text\">IC</code>). Every time function runs with a different object shape it creates a new IC entry.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dc7336f187d4a7389e1ae63e15d1e592/0d08a/ic-create.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 567px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 83.06878306878306%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAADmklEQVQ4y41UfUxTVxS/bRUobW0JuC2aaCN0AQ0x27LoH8s0JouJJhj/2kIgm5oskUg0LG4kXWWzyf6ZJBozMaKCWkA+YqmoJdBCsZbSEiilff2gX6N7IIJFXsX1U87ufYiRZKAnOfmde8955/3OOfdehD5ATKrbXILW1pbPGYs5PW3oA0PjzaWR9tZUym6DUE93M/Enxka5KH2/Mg8MilztH+W5eTl5ubsLZeKuqVrJweN7JDiGQwIBgMVQb88X5pbm9EhHGwR7updeWMwp8HlhxjjAJgSvGyfsOlMAuu8+MlUhEd77GGvmOTgmOnp6/xZss8w+KyzMJqi+dHEf1iTWtObypdTw3ZZ41GKG2ccGFZvQ5WTjEa3VFzva2susd26doDraymc6H+19w4z1F8tkQoKeLs2XEw8fgP1eB9gwS/d9DaTGRuGpoU9N/ElSMpFXZpNm3jgA2r8uw2S3FhiT0fJuqbLt21iGlEYti5iMuhlDn2FhaLAfs9NhHQrreuTEn7bb2Hj0Qt97cM45Pj/lcADj90HUOvQj2b9Se4G3SyolZvb3JSWc9Qa3Us1bI8IwrWGafv50dtZ9vVOzlfQvP7+AMOOTvp58DGjQDJz9e78S4W+4R745JGi8ULeR2BAB7tdnnKiqdm45qae9lavraOffunZNfKKsbPN45z3e/7HYwEG8bB7ayNr4J9sz0SrWB76NrFkBHwsbvO3Tw+9s78Yn4SxOSKoqFiN0PAPbeBBBXsEmWE2CpmmkVqs5b7KRaWVvEORzSUuOiYH709XgnbP1E5SyZcpyvpm2yhsC9t9UkyO/N9HDitvh4V8aJkfL5TM31uszJyfnE+HKoqqO6qvTM3BDPwc3+yNQr3sO1/XLerV3Di4+moUfFNMD753auZ/P76r/s3FP212tcvpZBHwhOj5OTSQpTyDp8gaT7olQwuv/O+XyBmLDY56daya06sbYnlBm/ylq0L8QdEw+A1iC1+kUxGL/QjS6AK8WX0IiHoOl12lgmAUI+r1FayaccsyzGLJPC/sbbEIP5SuJxWKheDzhiEZfUv5AwBUOh6nFxUUqkUy6GCZqdzpdO9Z9ZXzWf1atlUolX/6rPMtoNGZUVlaKVSoVv6mpKbOmpiZLoVBkVVdXr334nU98LFJPAsg24OK8vQnLQk7BZqybVh6QDxa3281iRUUFi1KpNEMikYgEAkGuSCTCpkRYVFREbgwqLS1F/wH9YeujVOxnawAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Object\"\n        title=\"\"\n        src=\"/static/dc7336f187d4a7389e1ae63e15d1e592/0d08a/ic-create.png\"\n        srcset=\"/static/dc7336f187d4a7389e1ae63e15d1e592/0783d/ic-create.png 240w,\n/static/dc7336f187d4a7389e1ae63e15d1e592/782f4/ic-create.png 480w,\n/static/dc7336f187d4a7389e1ae63e15d1e592/0d08a/ic-create.png 567w\"\n        sizes=\"(max-width: 567px) 100vw, 567px\"\n      />\n  </span>\n  </a></p>\n<p>We’ve called <code class=\"language-text\">getMeName</code> with an object that has given shape M0. First run of the function works as described before so V8 has to look up for named property on <code class=\"language-text\">a0</code> and store it into <code class=\"language-text\">acc</code>. After running bytecode it creates IC which contain two things:</p>\n<ul>\n<li>Shape</li>\n<li>Way to get to property</li>\n</ul>\n<p>Now if we call the same function again with an object that has the same shape:</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b5c56cb4407f5e9f85ae18a3e7c545d4/0d08a/ic-use.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 567px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 83.06878306878306%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAADiElEQVQ4y41Tb0xTVxS/75Via6l0yua+LCGLTVaTTcOyZVmWfdiXfTH7uoTMRBc+kbE1LovE2nSTTybT6JZtOLUqFhBkZfxbwb5XqG1Wai1QaF/7+odCKRQrsLaU9a+c3fsUM01AT/LLOfecX373nnvPRegFtmt3JQoODdIkvnersy7tdJSXxiwwek2/6b7dVSp5JiF6Z7iD1AtTEzQq9zfVAKvZ13DkgxqZuFpx/Ksj1ca5s3tPdR9TVIhFUkK03rwuCMYsTJ2js6N8v6cb5lnzZso5XoIQD8s2qyAIvJ9GpQH1AWDq9+O1HKMGQ6wrf/mKztjwBi2iqgjR9PuvguDssKmu9+KFQt9PF8sjl34r3bvVkc84HZC8O2YQBDmvwENxk+Vt3mj8wtl2vWG6s/PoP4Pm97daflelRIssIxCDQwPv8UMDwA/2w3TvH8D1/wmlqQlIjFl6Sb1IWia24bD3rdmsYPrlZ5gfMUFyjJ3EadHXajUNAMjd3UURnsfYo1z7286sO8ct+GTsutNhxn48xtzRkHrZMynw0Bpr/nTFO7O2ODMD6XAIkva7jcLpDh+Wbp2UCO9kT+tbwUoq1bWYSDxIJJP+ZYC9JKdUKgVBuZhGH6lDiLFkKcynn4MINoD+WO1FJ849fCy6MNhP97Xd2O0Zd8iGe27L8FiIcJqmKEoiCB86jl7GPvl8dfuiWCwmFyz5X1OoAuXwRuQlOeznMIIYIYxF+sAeED0jEAwGUTwep9xuN/UkRVMiqSD4IcrQ312O3Tx1Y957piPu/KF9waUzLLiI/x5D2xZznbw2P3FUs3x1pw7o1/bXPn2Uk/ooe2k0C1eYJOhHV+EyswJX2MdoNT+EC38l4Zh2ybqt2jsHD5EWxFFP4nUPE3jLbvN9u/RgFcLReH7aFyz6ApEix88W/cFokQ/PlTg+knNNBQ5uK9h6/moF8bYh5zeOkYmVgDuEH38THpVLkMv9C5lMCjay61DI52DzURnS6RTMhnnVC+cq5I5VsXqXPOALfZbL5aL5fGEmk1n3hSMRLhaL+bLZrK9QLHLpdMbj9XJv7jgGrT/qn1m3tLRINac1EpvNVtnU1FRtMBik7e3tu3Q6nUSr1Uqam5upbcW89pDgffYImrRy1HM/hYzUqxh7nsQvb36/X/CNjcJvRLW1tZUKhUIuk8n2yeVyHCqqVCqVmGxYX1+P/gPRp/eiB4ssUQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Object\"\n        title=\"\"\n        src=\"/static/b5c56cb4407f5e9f85ae18a3e7c545d4/0d08a/ic-use.png\"\n        srcset=\"/static/b5c56cb4407f5e9f85ae18a3e7c545d4/0783d/ic-use.png 240w,\n/static/b5c56cb4407f5e9f85ae18a3e7c545d4/782f4/ic-use.png 480w,\n/static/b5c56cb4407f5e9f85ae18a3e7c545d4/0d08a/ic-use.png 567w\"\n        sizes=\"(max-width: 567px) 100vw, 567px\"\n      />\n  </span>\n  </a></p>\n<p>V8 compares current shape with shape stored in IC and skipping whole process of calling <code class=\"language-text\">LdaNamedProperty</code>, because there is a “shortcut” for this “kind” of shape, stored in IC. That way we have nice optimisation of the function call. But what if we call that function with a different object (different shape)?</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/77cc23586d0294c630c08cebd59f42b7/4d07d/ic-add.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 607px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 97.52883031301481%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAD0UlEQVQ4y61UbUxbZRS+UGGt1aYz2FIDf6bFxKBZHLosmiXT/XI/8JebSxQ1JluyORYzxvZLf7HvDebiJpsdAdfiBly+eoFCb0s/BErpKK2ubJSOdbffH4D9wN62x/te1zpchph4kpNz7rnv+7znvM85L4b9BwGXsxDZuUFiH/xmB3sPTutaWzJerQZCRn207WSDGIP+Wl6691A5aOrE+z/YXCoRSURvvvaqUMR/QXym41BJ7ZXdLzIYzyCgxuPHWGv4qe2gQ9kPjNLhMWMmbbNCfGoy2n7ubA7wKzGQx0S7NvOFzPoCRosZZbP5srFamAN8o6LiOWS7Gs9/jTddgLYTDTTjZ+zdXRDQaSOk7Jp4dUnO+ZceDCqbtdeuyqYUN2RB9chxAPjrH2O3b9nCR76jr/fzxTEj3FcNZeYHCfBqSQgb9TH1j1clKEMspunksJtMY1vnCSVMKG6AHe+CO3inkwEqyh34eoX0WfYOif4an1ajmu3vxZ0DSjyoGyXcI6rvjnxWw2UXhocGUAaoVCzonDuZjEYgFgpl702aalDs/Z07Nwj4/KK3Kit56NuvHx1fuT0Fls5btK0HT2V/tcEDcqR5VbmxSITN0hcK1THg8AdNg312dheKVVdXczmcQv7L5eUIkENel03o21rB1o2ngwYdDXcdiOWWPFiUHMZ+j8dZEjwU9SmjNrfbfXvKbN6BYlVVVTwel1v04Xs72ENVzT+ME5e/B/npU+neSxdpr0YNvlHN9ae1W0F9fX2BUCjk5tjNk/aIIP+oRp+atkBQr6NDBl0qMzMNzJ0+Ccjj8Z4I5ZxNZWWYX6dl/QmFvHLyZ8V219DA2wyB7zB2m6ldvmnVTofDwVqz2YzJ5XKWoOLi4g2PZ7ltTys2nYXCf1aUc84oXJx/mza0mG2FvUe7sf9LuBtFr7BZ7j8dEdQ2zX188Jztk/pm70eHL97bu++E6YujjH/ksntP3RX37vUAFpRJt7INfbjJ9+63HRFo6KTg0tAinFeGGY3ABSICZ/vC8M2tAKwrRb5AlCfn5rDDZJlbBP2MJ2WY8aT1VipttHmRZnVWT3xNoJYmRb5VBjs0p34ZMKsdM/aFRGwRvA8XaJ/HnfZ7H6YZS4f8HhSLrgk4TlixdvlNlkWyxyAzEJOU+743C48kxUxTcmUF8t8pOrsmoGXkTj5Dl9VzwGmhWvxUEE8k4mQikRgOBALDFEWpl5aWVMlkklxeXu5b30sNT71r1FIlj/fimnLXvPD3uLkihT5XiINeJRSTSCR8gUDwPDNdJaWlpTypVIqGAPsT3+4xQcDdLN8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Object\"\n        title=\"\"\n        src=\"/static/77cc23586d0294c630c08cebd59f42b7/4d07d/ic-add.png\"\n        srcset=\"/static/77cc23586d0294c630c08cebd59f42b7/0783d/ic-add.png 240w,\n/static/77cc23586d0294c630c08cebd59f42b7/782f4/ic-add.png 480w,\n/static/77cc23586d0294c630c08cebd59f42b7/4d07d/ic-add.png 607w\"\n        sizes=\"(max-width: 607px) 100vw, 607px\"\n      />\n  </span>\n  </a></p>\n<p>V8 created another IC for shape M1. After that we have “shortcut” for two types of shapes. But how many IC can V8 create for one function? A lot… only problem is, every time it does that there is a deoptimization going one.</p>\n<h3 id=\"function-states\"><a href=\"#function-states\" aria-label=\"function states permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Function states</h3>\n<p>There are different states your function can be in, but we’re mostly interested in 3 of them:</p>\n<ul>\n<li>Monomorphic - 1 IC</li>\n<li>Polymorphic - 2-4 IC</li>\n<li>Megamorphic - >5 IC</li>\n</ul>\n<p>While V8 decides if function should be optimized, it check current function state. Only two of them can be optimized: Monomorphic and Polymorphic. Reaching 5 ICs V8 basically means <strong><em>“I have no idea what I’m going, so call it a day”</em></strong>. At this point <strong>TurboFan</strong> is not going to store anything into IC, instead it fall back to global cache. Usually it doesn’t matter if your function is Megamorphic, but if that function runs very often you might think about optimizing it by reducing a number of different shapes it accepts.</p>\n<h2 id=\"back-to-our-function\"><a href=\"#back-to-our-function\" aria-label=\"back to our function permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Back to our function</h2>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token constant\">N</span> <span class=\"token operator\">=</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> a<span class=\"token punctuation\">:</span> <span class=\"token string\">'Jack'</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">:</span> <span class=\"token string\">'Sparrow'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> b <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> tmp<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">:</span> <span class=\"token string\">'Charles'</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">:</span> <span class=\"token string\">'Xavier'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> c <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> tmp<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp2<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">:</span> <span class=\"token string\">'Frodo'</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">:</span> <span class=\"token string\">'Baggins'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> d <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> tmp<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp2<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp3<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">:</span> <span class=\"token string\">'Legolas'</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">:</span> <span class=\"token string\">'Thranduilion'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> e <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> tmp<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp2<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp3<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp4<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">:</span> <span class=\"token string\">'Indiana'</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">:</span> <span class=\"token string\">'Jones'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> f <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> tmp<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp2<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp3<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp4<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp5<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">:</span> <span class=\"token string\">'Gandalf'</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">:</span> <span class=\"token string\">'The Grey'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> f2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> tmp<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp2<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp3<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp4<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp5<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">:</span> <span class=\"token string\">'Jack'</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">:</span> <span class=\"token string\">'Sparrow'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> f3 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> tmp<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp2<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp3<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp4<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp5<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">:</span> <span class=\"token string\">'Charles'</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">:</span> <span class=\"token string\">'Xavier'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> f4 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> tmp<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp2<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp3<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp4<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp5<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">:</span> <span class=\"token string\">'Frodo'</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">:</span> <span class=\"token string\">'Baggins'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> f5 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> tmp<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp2<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp3<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp4<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp5<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">:</span> <span class=\"token string\">'Legolas'</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">:</span> <span class=\"token string\">'Thranduilion'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> f6 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> tmp<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp2<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp3<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp4<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tmp5<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">:</span> <span class=\"token string\">'Indiana'</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">:</span> <span class=\"token string\">'Jones'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">obj</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token constant\">N</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    result <span class=\"token operator\">+=</span> obj<span class=\"token punctuation\">.</span>a <span class=\"token operator\">+</span> obj<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">test2</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">obj</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token constant\">N</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    result <span class=\"token operator\">+=</span> obj<span class=\"token punctuation\">.</span>a <span class=\"token operator\">+</span> obj<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> startT1 <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token constant\">N</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">test</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">test</span><span class=\"token punctuation\">(</span>f2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">test</span><span class=\"token punctuation\">(</span>f3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">test</span><span class=\"token punctuation\">(</span>f4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">test</span><span class=\"token punctuation\">(</span>f5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">test</span><span class=\"token punctuation\">(</span>f6<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test with one shape:\"</span><span class=\"token punctuation\">,</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> startT1<span class=\"token punctuation\">,</span> <span class=\"token string\">\"ms.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> startT2 <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token constant\">N</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">test2</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">test2</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">test2</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">test2</span><span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">test2</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">test2</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test with multiple shape:\"</span><span class=\"token punctuation\">,</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> startT2<span class=\"token punctuation\">,</span> <span class=\"token string\">\"ms.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>After executing this code it prints:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">test with one shape: 3015 ms.\ntest with multiple shape: 12329 ms.</code></pre></div>\n<p>What just happen? First of all we’ve set number of operations to 6*10^8 for every test (6 x 10000 x 10000). First function <code class=\"language-text\">test</code> is called with the same shape all over again (different objects, same shape). Second function <code class=\"language-text\">test2</code> is called with 6 different shapes and because of that V8 is not optimising it.</p>\n<p>If you open <code class=\"language-text\">v8/tools/ic-explorer.html</code> and run above code with <code class=\"language-text\">d8 --trace-ic index.js</code>. You could be able to load <code class=\"language-text\">v8.log</code> into <code class=\"language-text\">ic-explorer</code>. For those who don’t want to do it, here is a screenshot.</p>\n<p><code class=\"language-text\">test(obj)</code>:</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/324eb86220cec172bb7ad04ae55cb2ac/064a4/monomorphic-example.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 225px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 17.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAAqUlEQVQI121O2w6CMBTjc/kteTXRZ5n+hCAM0BAvGOU2lQmEDeq2xMQH+9KTtjmt5XlbrAmB5vR4woMxhIEP1yW43u7wfQ95USCJQtA4QV2VoJSCcw4axRiGARpC8TRNsGaOA9u28Ysg2GG5mGNFNviH7HJGWTFz932PIs+RHvaonxwWU4uyLIN6j3EcTeit2l9NY8JSStOsva/ftS2E0vUq7Rut6yCExAf2xOBLa9vBJgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Object\"\n        title=\"\"\n        src=\"/static/324eb86220cec172bb7ad04ae55cb2ac/064a4/monomorphic-example.png\"\n        srcset=\"/static/324eb86220cec172bb7ad04ae55cb2ac/064a4/monomorphic-example.png 225w\"\n        sizes=\"(max-width: 225px) 100vw, 225px\"\n      />\n  </span>\n  </a></p>\n<p><code class=\"language-text\">test2(obj)</code>:</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ddccaaa9086e3ec9ea45d5a0cc740341/de152/megamorphic-example.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 231px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 48.484848484848484%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAAB30lEQVQoz22SaXLaQBCFuWj8h1/BVyC+AMUx4kvgpeIkCgkW2pFAa7QgzCLZIgQBQi+jFnG5ErpqSvVmVG/e19MNnufx5fMDHthaLFMo0hC9Xg8Ty4U+UnF3f48g8PHp7gam7UFj55o+hiTLkBUNVZUlTt8SjevrjxAEAXEcww9CeK4LfvADXP8725thvlggTVawLAvPLxlm0wjx7AlpmsKybTLa5TkSpqtqvG+1oKkqCVUWIYgSQpbo9vYGfhTj3yqPBbTRiKU5QpYlvGQZPM+FaVq1YbvdhmEYJALfh2nZhCgzpFXyTPvH45FWVYf9DlNGU544d/s9NuuM/XtK+OHqCoaukxgbOkRJhmVOMBgM8DSfv/bmr0G+3cBxXJQn1F+bDZLVAp4f1Iaty0vIkkRiMjYI2WSGHPeV9ep/w/0uh+v9RHE4EOpmu0UYBpiYZm3Y6XRg2zW/5zrswCJkVVNfMd4a7vItgjCiHjqOw5AP9ECL5bI2bDabEEWBhD7SMHjkoesjfOM4RNP4rKHNkIuioN5n6zUFqMjIsNvt0ki8TVghSKwN5xJWyEEYkq4S7tmjpGnC2uDVhu8uLiAMh6exkWj+VEVBv99nCadnHuU39avSPP9Il0ZRyAZdofM/QjjeaGQFgb8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Object\"\n        title=\"\"\n        src=\"/static/ddccaaa9086e3ec9ea45d5a0cc740341/de152/megamorphic-example.png\"\n        srcset=\"/static/ddccaaa9086e3ec9ea45d5a0cc740341/de152/megamorphic-example.png 231w\"\n        sizes=\"(max-width: 231px) 100vw, 231px\"\n      />\n  </span>\n  </a></p>\n<p>Result of that test is obvious and <code class=\"language-text\">test()</code> runs 7.8 times faster than <code class=\"language-text\">test2()</code>.</p>\n<p>You might ask why creating <code class=\"language-text\">test2()</code> if it looks the same? It’s because after running <code class=\"language-text\">test()</code> with one shape it’s already optimised for it. I didn’t want to affect performance of the second run, but still want to keep it in one file.</p>\n<h2 id=\"extra\"><a href=\"#extra\" aria-label=\"extra permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Extra</h2>\n<p>I’ve mentioned that shape contains more than just information about added properties. Here is an example of created shape for <code class=\"language-text\">let b</code>:</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c1c6d744d27740eafca5339c43cc1d86/bb106/full-maps.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 468px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 225.64102564102564%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAtCAYAAACu/EtoAAAACXBIWXMAAAsSAAALEgHS3X78AAAFz0lEQVRIx5VXWY8TZxD0zyU/gTyTRx4hCUGEREqkIO4IogAROQgse3vX933bc3nGHnvGc32V6rF35cCKHT7Jsj3r6anuqq7uzc1mM/iLBUb9PlrVKpzRGHBmsHl9uVgiiiI0Gg20220EYQjf97FarWBZFlzXPf++XC7hODZyX127hnapiE61BluCHZ8iuPU9uoYBfTKBnC+uXMGXV6+mN2qaxhsdXL9+HYVCAdPpFAKqVCrj5s0byMnTff4wimNYfMKUTz07/sqHzZsXQYAElx+lFHL2aIQBn1Q+OESvWIbaO0T03V30uz3Mu31Esznw5Dmwu58GVXyw3HgWYPslJ6czNUEoZ0lE3pwBGCTa/GjG2kRMCUsPahNkO9g2uhShOSRCklHO51E7OcUif4rk9z8wJEkmUbqmhfjNDlCtpwGRfDr5nDGeYGnbCMlWwlopfk8OjrHiZ5DVJAihylWgP9wEVJ8OaOo69PEYg16PTJVgExXaHZiUhUlGdd1A2OE1IlXr3C4J2B/AbLVh8D2i/lAoIb73EFPTTPUIqe/L11AsBTKlzBu9YEUe5mizbs7cTdMK4oif59Cos1DSZ6BMCC0G6ZGMTrkCi+kmO3uIbtxCr9tFoOlQZFndewT15t06IGXzaYSsobRXRAIcUb27ONMBfM+DbRHhllQuOzlzMKSgi6jkT9Assn5kOLrzI3okaca6+tSkevoc6v1+RtkQobdYo4rCAEuyC0FF1JJeahBkGHzPxvJwCK3ZJMI8KodH8EoVJH//C41SMjodzCYa4v2jVEqZEIrWHLZf6K9ShAnTjBnQZf0EYcxXcpgHGq3sAae6lgq7Xi5jyoCgmB17CpNdIxYWkm2wLNlSHgxgtFrQGNBn7UDHiX74GSb1qUTYIWv5/EXqQtmEbZlMbwmPvdxl8KkEES+kmOcLFxMGFqcWZBlbr5/6YZ3iNjvdVB7R17fRJ2JPHJzCxv3HUG/fr++IM7SeuLU8V1ptIWRsThCFsHlNhJ8dIf2wuyVsnxKJf/oFHbaeQ4I8liB59gI4OMoobLIYcI4krJOiswRkGMMxEkHFOgZkNybb4uKZEEqnaBR3o1ZDkQgXzTYS1lFjKQyK2+KQik+LAD0xmw4ZTFxmaTtQNIaYVp+8ep0aBaSenCXJ212gVs+essubx5RMnY7tSHr0xCXJMIlQZ41DPkzSz9zLQw55EfbcoEvnCwg56CfsoHNhP34G9e4zZOORDBH2hPW0ZA5D5lMIl4ToIuzP8sPeWtjV4zxGrBPYYuHN2+kYXdIrlVjbgyefJ2xfWotnzq5wxbH5PSaaiATYlJSMWEldfbAtXIQ6dew+F50SvbB5WoB3eIz40dO09Sy2okfDSF79CVA6yTYpMrTOPm8FzRksvk8USuYKmYxJTFJrpD4oP4wFrcxlcSJxdV73OSXV1grykR+OiabJ+hWJ0KGRCpohl6gaW/KETu4e5RHw7y06+Jiop5Ra8m7vwrGQ+qH0rE2rT6R+FQr4t5ewZQIyaCLG+tcbRNy+NDp7NLXXgWRwbazu/ymTFJdkyEZab7fo1HbaHeKHs3TQc+8RpqW3z9L8YCf8aNAPCkUM6g3M6X/J7gGib+9gwOuRCF3WuPtr2ajNfphamcjnQlIkDT59xd3QMHQ4W4N+QWQWMwg/QHNet4sCSg27JEN2w26likQ22G9up4N+IX0sK/KDp+cILxe2bLAiXJ4V313alWxcIpuYyOesY1pD8cusU29MLxRhVynq1UkRMaecuI/J4b6g4Sb/vCX71Yz2RR3OKREpdkDBRnSfZH+PK16wad0ESaFGgx1k3WBNbqoG2nTq8XACz+aCybLp+ojX6qmLz8wmA80ypsxgxlCDpXMhktWPb6q4RKVygmGvQ4SUyGgHyiptAmYgZTZ3WPwZmq0mLEOj9S94zcWc3qhTi8HMk5mafdCP6DZNiltmS/qPz627GLGWPseBkjZ7+CvUzm4m2fwHbKx4IVmIl0YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Object\"\n        title=\"\"\n        src=\"/static/c1c6d744d27740eafca5339c43cc1d86/bb106/full-maps.png\"\n        srcset=\"/static/c1c6d744d27740eafca5339c43cc1d86/0783d/full-maps.png 240w,\n/static/c1c6d744d27740eafca5339c43cc1d86/bb106/full-maps.png 468w\"\n        sizes=\"(max-width: 468px) 100vw, 468px\"\n      />\n  </span>\n  </a></p>\n<p>If you want, you can generate that for your code by running</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">d8 --trace-maps index.js</code></pre></div>\n<p>and uploading <code class=\"language-text\">v8.log</code> into <code class=\"language-text\">v8/tools/map-processor.html</code>. When it generates chart, click on <code class=\"language-text\">Transitions</code> and explore a list of them at the bottom of the page.</p>"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2019/08/v-8-function-optimization"}}}