{"componentChunkName":"component---src-templates-post-template-js","path":"/2020/02/understanding-region-of-interest-part-2-ro-i-align","result":{"data":{"markdownRemark":{"fields":{"slug":"/2020/02/understanding-region-of-interest-part-2-ro-i-align","tagSlugs":["/tag/rcnn/","/tag/machine-learning/","/tag/ai/","/tag/neural-networks/"],"readTime":{"text":"31 min read","minutes":30.383333333333333}},"frontmatter":{"description":"A visual explanation of how RoI Align works and why is it better than standard RoI Pooling?","tags":["RCNN","Machine Learning","AI","Neural Networks"],"date":"2020-02-09","title":"Understanding Region of Interest - Part 2 (RoI Align)"},"html":"<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 37.10575139146568%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAB7CAAAewgFu0HU+AAABtklEQVQY0wGrAVT+ANnY2L6hmdGypNG4rMuxo7iThs2yqP39/er8+83r6eL49+L6+dHm5cjo5r/S0crGxtbW1cvKysHBwefm5gDDu7mHYliqmYqMcmekk32xlHfHppPPz8/I2tng2tvy4eL5+Pju6Ojj6Oi8y8u+srPEwMC8tLS7sLDc2tsAx9PYlJqiio+abHSKhYCEtoxpzqiP9fX13O3t0NbW3c3O6+fn3Nvb2OXk0uLhz8LD09HR2NLSyb/A6efnAMPKzZudo4uQmXhqb4ZsYLWObM6oj/7+/vH//9ne3tvR0+jj48fGxsrIyMbV1eDS0uPi4t3d3dra2vPz8wC2u79wbHOsn5GXXkiablW7n4LDpI7T09PS4+LDyMfUx8nm4eHa2NjVzs7Dz87gzs/g3t7b2trh39/y8vIAw7y7hF9RiGpXfVFAelxQmHVcypqA8/Lx0uPi4Ofm69nb8uzs7+zs2uLiyNnY3dHS1tbW4+Pj6ejo8fDwAOK6o71zTZxdRJZkUGNLR4NZR6iGe//+/dHi4dnn5uns7Nvh4eXn59bl5MXW1czJyc7OzuPi4uTj4/Dv71a7PuI17RimAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"VGG16 Output\" title=\"VGG16 Output\" src=\"/static/2c35532f7b36e72f542981c094ed4d91/b7c40/fast-rcnn.png\" srcset=\"/static/2c35532f7b36e72f542981c094ed4d91/e4891/fast-rcnn.png 240w,\n/static/2c35532f7b36e72f542981c094ed4d91/0ce91/fast-rcnn.png 480w,\n/static/2c35532f7b36e72f542981c094ed4d91/b7c40/fast-rcnn.png 960w,\n/static/2c35532f7b36e72f542981c094ed4d91/5a2b3/fast-rcnn.png 1440w,\n/static/2c35532f7b36e72f542981c094ed4d91/a697f/fast-rcnn.png 1617w\" sizes=\"(max-width: 960px) 100vw, 960px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>Original Fast R-CNN architecture. Source: <a href=\"https://arxiv.org/pdf/1504.08083.pdf\" target=\"_blank\">https://arxiv.org/pdf/1504.08083.pdf</a></figcaption>\n</figure>\n<blockquote>\n<p>This is the second part of RoI Series. It doesn’t include an introduction about what RoI is, so if you didn’t read <strong><a href=\"https://erdem.pl/2020/02/understanding-region-of-interest-ro-i-pooling\">the First Part</a></strong> it might be hard to follow this one.</p>\n</blockquote>\n<h2 id=\"why-do-we-want-to-modify-roi-pooling\"><a href=\"#why-do-we-want-to-modify-roi-pooling\" aria-label=\"why do we want to modify roi pooling permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why do we want to modify RoI Pooling?</h2>\n<p>As you remember from the first part of the series, RoI Pooling has one major problem. It loses a lot of data in the process.</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 918px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 99.34640522875817%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAC4jAAAuIwF4pT92AAADKElEQVQ4y42UX0hTcRTHr1o60cwWVkSS+dxTr+W7EEQPhWZRGvUQ0UMPRVK9RBhL5rIoTEQpbTqNihgVZS9ts5atWc39USQ1d+/u3D//bu66fTu/21xOV/qDD+fece6Hc869Oxz352RwqWfpPovIJTLXyPt7ACTjMuTE0tLSXbm5uWfKysoKEzkZy/NWnpycHDlmE3sI9tBWQrkMdr8jze/KRP5OojilWpvNdsjhcLQ5nc4Gio0UUxgaGrqz8jeW53K5NCMjI806na6KNJvlyrKptrGxsXtUPqanpzE/P78u5ubmMDs7yx6DwWBoSXTBWs7gRkdHVeFwGDzPhwnpfwgJ2LXH4wkzeV9fXwO5NjEhzVsW1kejUQiCEKXEeDpIEne73fEJioxfExNxXhCkhYUFmEymO0stpxNiFR4PeK+ICUGAb9CG0PNnCL7vhci7pXnqzGSUhQVrCgUWSeIZHoZ/4Af4QRd8b3oRfN2LgNkC73enFKcZms0fkxUqFIr0QroG73ZTVTx+Wgdg71Bj5v4lhHpuY7rrFoLaW4g+vSk5mzqgb2hLVpifn88lhSRKEdKsEBywwmex4nPnVUy1HoG/pwaBrpPwaqsR0x+T7p+rw8Oa2xr2Xe7dVlyYRSe9kGAzC/W+g0//Ct8eXQZajiLWfRrxzlOIPqkBXlZJnRdVaD3fqCbhLsWGjSco5v27QjePSZcLMy/1eNz9AMffNqHikxaVpnZUGtpRYXsiHb6qw4vqG6zlLXu3FxdmZmZuWGOGHvgFN57r9DhwoQn7r2lxoLYdZVfase+6VjpztgOG2rrkDIuKitLPMAlJedED7+gY/F/t9LYd8Fvt8BFBq0OKiz76bD6kvmX669UvLi6CvvwogVVQtYIoQvBPJuF9kxCDfimKOD6ZzZolYV5eXgY3Pj5eH4vFIIpiemEa2Ei8oleigy/9/erE5uEKCgrkllWRSIS1GCEW1wuJI2wHWCwWFauQ7UelUilvm0a2NQKBgLxx1sPU1BRCoZC8bUh4l4S72fItKSnhOKvVyvZhM+1FNaFZL3a7XU3PPTQajQdJuJEJy8vLud9v5hEImfYHlAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"RoI Pooling loss\" title=\"RoI Pooling loss\" src=\"/static/8645b43d389462b34393f75aef05c103/4c275/box-all-losses.png\" srcset=\"/static/8645b43d389462b34393f75aef05c103/e4891/box-all-losses.png 240w,\n/static/8645b43d389462b34393f75aef05c103/0ce91/box-all-losses.png 480w,\n/static/8645b43d389462b34393f75aef05c103/4c275/box-all-losses.png 918w\" sizes=\"(max-width: 918px) 100vw, 918px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>RoI Pooling losses in quantization (dark and light blue), data gain (green)</figcaption>\n</figure>\n<p>Every time it does that, part of the information about the object is missing. That lowers the precision of the whole model and a lot of really smart people thought about it.</p>\n<h2 id=\"setup\"><a href=\"#setup\" aria-label=\"setup permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h2>\n<p>Before we start I need to quickly explain our model.</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 48.04785894206549%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACEklEQVQoz12S32vTUBTH+//4T4gvCgrqo4IKPgxfxQcVBz4ovgzspmUylYJOdHPSslHoNtnGkIFudV3LcGlxHXVNatskTfM7N0m/3ntjsuqBG+49Oedzzzn3mxoOhwiCALGxM1vMmD/+F/tHF/UiDMN/clNxwvJqAXPzs3zPgmzbRqfTga7rSfCosXMME6UWSt+/8n2KfYqf8zh/8RQWcjPcqaoqerIK3bBhWU4CIIRgSCHE95MLfh0fYX7hJbZL6xHw4aN7uDV2FlOZayhV87AtAoUCbceH2rcwGJg8UJZlSJKEdrsNoVaD47rY/raF97lX+FLI4GhvOQJeOEMre30HUzNXsLKehecGMEwXpuVTKIHnebyabrcLl0JYm4ZhoF4XMD2dxvibLLaWJtCorkbA8cunMfnkJl7MXUW++AwhHWmnp9O5yGiJIvp9jVcnCAKfqaLIODxs4GdDQO7tBO5mWLvvcFDfjIC3x84h/fw6sos3sLu/AdcJ8LurQxtYEMU2bX/AqyuXd1GjrSqKgspeBfu1Moofn+JDLoudg09otYUI+Dh9Cbm1B+iqDQQ+6Ksa6GsOHMehkvF5EJtbs9mkD2TxKkVRQk9tYW0ji8qPJWi6dCKb2cX78IjFHYZBK9M0nuj7JJGQaZqJ9tieWU85xk61AJeYf2FhBCTESxzsAZjuYn39r71Rc12LyuckN7Y/MMTZVAnWt+kAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Mask R-CNN\" title=\"Mask R-CNN\" src=\"/static/29aba251733d6c0528f72869aad393c4/b7c40/mask-rcnn.png\" srcset=\"/static/29aba251733d6c0528f72869aad393c4/e4891/mask-rcnn.png 240w,\n/static/29aba251733d6c0528f72869aad393c4/0ce91/mask-rcnn.png 480w,\n/static/29aba251733d6c0528f72869aad393c4/b7c40/mask-rcnn.png 960w,\n/static/29aba251733d6c0528f72869aad393c4/5a2b3/mask-rcnn.png 1440w,\n/static/29aba251733d6c0528f72869aad393c4/dfb45/mask-rcnn.png 1588w\" sizes=\"(max-width: 960px) 100vw, 960px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>Original Mask R-CNN architecture. Source: <a href=\"https://arxiv.org/pdf/1703.06870.pdf\" target=\"_blank\">https://arxiv.org/pdf/1703.06870.pdf</a></figcaption>\n</figure>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 37.22682743029389%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAB/0lEQVQozw3Ky1MSAQDA4b1X1w7ccpymJhtFy0CDJlFBXWMCS1ixFZXXIiz4mNRII1/5QCiSRSWNHKrJonQmvDRd6tCUHTo39a/86jt/QrGYonK4y6u9DIV8gvKbDT4Un1NMrpCbniapdvNOy6CuP6V19Yjq8Arnbw0jip24/R6MbUautBswWM1MJOcRtOU4mfUZQt6O/8HNs9wsm+ksCy4bmSkf0n2F9/kCoUQf3QN2TvlS6EKLZGU7zZ0N1LVcQG+oo8mqx2mtQyiMWrG0GOmTDLTLPh4H7EjmRhxVJ1Btl7kqOpi642J23EkuYsYVTzARD6GFzUTCIh2yhNMt4w24CPrcCN8qW6xpOcLaNj1PtsmnEkwqEhH5Oqt3JRJjMpkHoxyXSxy+3uFtqcDBvJ/Sksr4vQQRJUQ8NsJkNMx4LIrw9cs+P79/5vjHLz5WPrFbLmORzQQjLWgzDmbSMbIvNQ6OjtjbL/P3z29MtbVEggEWHoboaatHEQ30em7S1dqEEFOMjHgaWJ5WyGSXmEvN0yzWU+2UaewdxNZrYXJRxT4coMMhMre1wZlrXfjcdm6PeahyDqHzxjEN+BlsMiJ0+vsxufqI3biEx1vDSExErz+LrsePIKUwDblYSKvkX+ywuabiTj7itGOUtNLNRYsVwRblZFeU4fpz9Nfo+AfHnDyQhGkZ4wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Mask R-CNN Output\" title=\"Mask R-CNN Output\" src=\"/static/3f5fc157d275353710903db3e9176f85/b7c40/mask-rcnn-output.png\" srcset=\"/static/3f5fc157d275353710903db3e9176f85/e4891/mask-rcnn-output.png 240w,\n/static/3f5fc157d275353710903db3e9176f85/0ce91/mask-rcnn-output.png 480w,\n/static/3f5fc157d275353710903db3e9176f85/b7c40/mask-rcnn-output.png 960w,\n/static/3f5fc157d275353710903db3e9176f85/0a810/mask-rcnn-output.png 1327w\" sizes=\"(max-width: 960px) 100vw, 960px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>Mask R-CNN output. Source: <a href=\"https://arxiv.org/pdf/1703.06870.pdf\" target=\"_blank\">https://arxiv.org/pdf/1703.06870.pdf</a></figcaption>\n</figure>\n<p>We’re going to use <strong>Mask R-CNN</strong> network for testing. The only reason we’re using it is that this kind of network benefits more from a precise pooling layer, so it’s easier to show a <strong>difference between RoI Align and RoI Pooling</strong>. It doesn’t really matter which network we’re using until it does RoI Pooling. Because of that our setup remains the same and looks like that:</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 36.26749611197512%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAACCUlEQVQoz2OQlOfl4xPlMBGWZzWU1eWyE1Nms5XRZDeU1eI1llbn4mHAAk6fPs2AE5i6CrnaBYj91zAV+MsjwPZLyZj7l5Q21z8pfc7fIppMpiA1796/6/z48WPemzdvtK5evcoKEtu/b5/SiZMnvdevXx+wb98+nwMHDri3tbYKMPiGqzslFKv/d4sR/2/gKPDfN1rqv7+f6H9TW4H/7CIM+iDNnz59ev4fCH79+vX/y5cvG0BiDx48KPn69ev/x0+e/H316tX/e/fu/d25a5chg52tg29ClO//xlqXfxmVmn+z8hX/xuUY/y8tiPze3pPo++/ff52PHz9cfPLkyf+XL1/+B2q+/PTpU0Ugv/nzly//nz99+uvtgwf/X9y8+W3x3LkWDCGhsf5NRVn/WzMD/iXEev0rzzP7m5Zh/r+syPPbtLlZYd+//rcBGnjp7t27IFf8Bxp0EWiw8aOHDzvfvX///9mjRz9f3br179mVK1/mTJtmxVBbUe00sa3pf1dT3f+C7Nz/CTEh/1PyTf8nFin99wrnhXj586fH/6EA6M0DIDGgwWUg/us3b/5/+fTp/zOgD/YfOGDEUJKX7zRlwpSfc2fP/9bW1PotOzXja3RUyPeYbNMvPonCxkA9DB8+vJ8PDMf2d+/euQC9KwgNQ63Hjx/HAl0a/uTp08i79++Hr127VggAoXUtvSeLXIUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Mask R-CNN\" title=\"Mask R-CNN\" src=\"/static/84ee45d07a675553ef8c8b36381d197a/b7c40/one-cat-mapping.png\" srcset=\"/static/84ee45d07a675553ef8c8b36381d197a/e4891/one-cat-mapping.png 240w,\n/static/84ee45d07a675553ef8c8b36381d197a/0ce91/one-cat-mapping.png 480w,\n/static/84ee45d07a675553ef8c8b36381d197a/b7c40/one-cat-mapping.png 960w,\n/static/84ee45d07a675553ef8c8b36381d197a/5a2b3/one-cat-mapping.png 1440w,\n/static/84ee45d07a675553ef8c8b36381d197a/eff2e/one-cat-mapping.png 1920w,\n/static/84ee45d07a675553ef8c8b36381d197a/f99da/one-cat-mapping.png 3215w\" sizes=\"(max-width: 960px) 100vw, 960px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>Model feature mapping process</figcaption>\n</figure>\n<p>Our model takes an image input of size <strong>512x512x3</strong> (width x height x RGB) and VGG16 is mapping it into a <strong>16x16x512</strong> feature map. A scale factor is <strong>32</strong>.</p>\n<p>Next, we’re using one of the proposed RoIs (<strong>145x200</strong> box) and try to map it onto the feature map. Because not all of our object dimensions can be divided by 32, we’re placing RoI not align with our grid.</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 878px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 99.31662870159454%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAADC0lEQVQ4y4VU204aURSlIKlCROsTTZrY1ktDqo2ibXzwP/rSH+m39L1vbWIkPBhftCCo8VKDeImhiMyVuXHRBDNkd+2DM4HWy0lWzp4156xZ++w9JxB4ZAwNDb0IhUKfEonEQOCJMTg46MdRYAQY7kGM1wDTwBcgDkTu+OF/MPIMo9fFDNRno9HoZCQSmb7DFM/gJmKx2CvEk728B7yfCofDHyEjBIWuLMu5Wq2W1XXdh6ZpWdM0Rayqas7jDMMQ4BjcL2AP8Tdozc7NzYWEQ2wk27b7YFkWNZtNchynj6vX69RoNETM+9rtNkmSdAiZd8lksnvOcOjChasoioAXw7UfezPcuDqgYA+eb23LJrzLQubt4uKiL8hkH7CYIEiqpolYBXjW4UqHOwW8qutu4/qa129BZmLBE6xWq8SivUAapLEYP0NI1nWq8nx6SsrJCVUvLqhaKrlWpcIf6gp6KT8oCKcsJEPA2N4m6fcR6aurZK2skJ7NUi2TcZubm77gh0Qi/Kigyq7Oz+nP/gFJqRRZP36Snc+Ts7VF5sYGmRBsZzJkrq8Lwa+BQPBBQVkCZxhkHx6StbNDUi5HMtJUcIb8IQnpS4bhOtirp9M5LsooGjwaiQz4guzKB3M4Q7NUolq5TNLGJsnFYrcYvPbqikVdB++UdDoPwZew9xnzwr1V5qqqqKZVKJC5u0sKHKoQ19CHosroAMW23QbW1tbW2OH480DgdTAYHL1fkDluahTD4oPHWdW4EKiycXxM2tERacWi2zo4IDOVEmfo/8tXsH9fypyezq5QmOrZmRDV8AEGO1byebe+v09KoSAE34+NhZ/uQ0Dm9gEkTpOLAkhcGPxJNhobrdXtw6Wlpxvbi+U71+IouMK8R5Jch89TloVgcn7eF+xgYx8g0oFgB03bx+F8Bc8xuFu+JLCG/+U3y8vL3duGbxC+WfgW8cDczc3Nf3yr1aJrpMnv+SbqdDqE62wPMjPj41xojHK5XKxUKn24vLwswkURBevjkI0Ax+AKmMt4/s4px+NxIfgXDCotjyPhruwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"RoI Placement\" title=\"RoI Placement\" src=\"/static/9727b0363fddbe313141b1dbcdffd1ff/97b2d/roi-calculations.png\" srcset=\"/static/9727b0363fddbe313141b1dbcdffd1ff/e4891/roi-calculations.png 240w,\n/static/9727b0363fddbe313141b1dbcdffd1ff/0ce91/roi-calculations.png 480w,\n/static/9727b0363fddbe313141b1dbcdffd1ff/97b2d/roi-calculations.png 878w\" sizes=\"(max-width: 878px) 100vw, 878px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>RoI placement</figcaption>\n</figure>\n<ul>\n<li><strong>(9.25,6)</strong> - top left corner</li>\n<li><strong>6.25</strong> - width</li>\n<li><strong>4.53</strong> - height</li>\n</ul>\n<p>Once again we’re choosing our pooling layer to have a size of <strong>3x3</strong> so the end result shape is <strong>3x3x512</strong> (That’s just an arbitrary example to make it easier to display on image. Your pooling layer will probably have a different size).</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 41.463414634146346%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAC4jAAAuIwF4pT92AAABcklEQVQoz22RvW7CMBDHk35MXTtWlbp0Zuk7VOJFurQPQadOfQpmhk6oEyMIUPgQAgaqOAECsX1OjJBYcj07oQ1VT/rLd5fkl/P/HC4ExtstijBEEQQo1muU7TZCs2lrHgQZZwzFZoNfjFUcijAMz8xZq9WcRqPh1Ot1p1qtuqbnKK1RTSa4G49xN5/jbjbL8+HQ5no6zTQ911T7m40FMsYs8N8AAgK9LMyUlIskQZGmPzlXKiOhGgyQ+b4FIqLjuu4VpXekW9IN6Z50bSeE0QhhtUIJgJIsKEsIkQnOMTHAIDgCL8zp+/6TlHIIAB7l73bCxPNQtVoo4zgHSnkiCySwnbDwUGt9ae1S6hWLoN5H7uFigdDpoIyi0wnLQJqwDDwcDkfg2xGYpulnDtzv7ZUtkLyT5FdZAiAj2SsHBZB+cm7O5XL5wDl/ofo5iqLH36UQUHW7qGg5QB8aqULgeRn0+5j0esjiuFJ4d2YW8zdM7xuXYbc2AHpZMgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"RoI Setup\" title=\"RoI Setup\" src=\"/static/2f7592bb906a8e72affefdd02a427f46/b7c40/roi-align-setup.png\" srcset=\"/static/2f7592bb906a8e72affefdd02a427f46/e4891/roi-align-setup.png 240w,\n/static/2f7592bb906a8e72affefdd02a427f46/0ce91/roi-align-setup.png 480w,\n/static/2f7592bb906a8e72affefdd02a427f46/b7c40/roi-align-setup.png 960w,\n/static/2f7592bb906a8e72affefdd02a427f46/cad41/roi-align-setup.png 1312w\" sizes=\"(max-width: 960px) 100vw, 960px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>Pooling layer</figcaption>\n</figure>\n<p>Up till this point, everything looks exactly the same as in <a href=\"https://erdem.pl/2020/02/understanding-region-of-interest-ro-i-pooling\">Part One</a>.</p>\n<h2 id=\"introducing-roi-align\"><a href=\"#introducing-roi-align\" aria-label=\"introducing roi align permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introducing RoI Align</h2>\n<p>The main difference between RoI Pooling and RoI Align is quantization. <strong>RoI Align is not using quantization</strong> for data pooling. You know that Fast R-CNN is applying quantization twice. First time in the mapping process and the second time during the pooling process.</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 39.11785972523499%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAC4jAAAuIwF4pT92AAACCklEQVQoz2NgYGBgBmJWIGYDYgkoDeKz/v//nwEG/v/5z7AtaxvDg8sPwPx1jaUMV2ub4PIPe3shjNu3b4ffu3fv2J07d7bduX179/0H97cD8eEjhw6VgA36/59x5fZNDB0KdgxIgAWZ4ybqwzCxr5uxvzSWkeHZs2e1QE3/X79+/f/Tly//P7z5+P//j7//L9+8vRBmIMKZ75k4ZDUEpRhEpRgCErgYkHwAB48fPy77+PHj/4ePn3x/dvnCn/dren783D/v/7WtK2eAzXj5A+yab1Oeyf+tfLlj98r1R6p/N+69M7H+5K/a5tmGjvLsvNJaAi39c1Xyy0tkGZ4/e1b+48eP/8+evfj1+vC+f5/nRP7+v6Po/605zdO5ZS1ldm/bXr/lwK7+Hem9YbcYsn90JPj853wr8X+3Otv/08AQYwhk4DzLsFhr9bTm//vK3VYyPH36tOwL0KtPnj79/uzJ498vr1388enBnf93zpyeBPbBjdvcy0/t5N4zZ5X+6UkbHm9cs/hj//nJr/fPn/bjzKSp+8G+YFggnBqot6POiKGM4cmTJ3WgMHzz5s3/T58////49RuI+//W3btzkYMGKMQMxMpArArEKkCsBsSye3xmMqKE4f3791UePHgQDIxpnwf37/s+vHfXB4iDLp4/pwc1iGHT0d2MDHjAf6DPt7cmMd6M4GMEAFNcLty1kQiOAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Quantization when mapping\" title=\"Quantization when mapping\" src=\"/static/e9c8da71e22237ae31c7e486f538e5ba/b7c40/box-cropped.png\" srcset=\"/static/e9c8da71e22237ae31c7e486f538e5ba/e4891/box-cropped.png 240w,\n/static/e9c8da71e22237ae31c7e486f538e5ba/0ce91/box-cropped.png 480w,\n/static/e9c8da71e22237ae31c7e486f538e5ba/b7c40/box-cropped.png 960w,\n/static/e9c8da71e22237ae31c7e486f538e5ba/369ab/box-cropped.png 1383w\" sizes=\"(max-width: 960px) 100vw, 960px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>Quantization when mapping and pooling</figcaption>\n</figure>\n<p>We can skip that by dividing original RoI into 9 equal size boxes and applying bilinear interpolation inside every one of them. Let’s define boxes then:</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 734px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 74.52316076294278%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAC4jAAAuIwF4pT92AAADJUlEQVQ4y1VU23ITRxDd/3/IDyRFVULBuwOJAYNkbEtVBuyAZLCRLZUs7WV2Lruzs1dJrj05oxAKHramq1vdfbrPaQXr9RpZlsG/UkkIfmEcweT0RSFkZpCuVkjGY+THxwjfv4d2DokQiJOEv8v5u6i3RYEkSUzgi203G+QMbFyL1jg4YfDgGhSJpq9DyWbu2TPsDg6Qj0ZomgZOSlh+HQuZOO53bQtXVSbYI6QzvJ3h7uAX3J39gdngEe5HT3E9+BXz4W8oT05hR2O0FxfIT07QnJ2hfPsWxXCIlg3y4bDfvnkDOZmYQMoU7fYByewKi5PfoTqDaTTAqpggVit8lH9BZSGsztDWFTRRNVWFwlrknK6lzRX0uy9fYM/PTZCmAnW3RTSbQowPUbWATFPUVQ2ranxOj3EjzmF0jrIqIRhz3KFhMaU1StrC2r67vkb+7p0JwnAN6yrcf77E/PgpYiuxXN8iNRGW4RwX4d8IxRIiEdxzhjAMYQyJYmGSgIx2qFRfTSZQ47EJfHADwCzukJ79iaSLsZY30PUa9+oGwi1Qlg6WI2423b5Y6wlw//k62qau+4fbW5SXlyRlueTCR4j++Qg7PIUqKiTrBDZziEMi0BapSBFF0Xd5aY4qvGzimKvQWEnZl58+QY5GJlAcYfv4MczVFSpqrSAKTS02TQ3FtyxLFIXdI/NyUUqhIhEenW/gCVIkZfv1K4oPH0wg2Lk5PIRkB0c5ZEyS7O4LeRQFJeUTpZQ/+XwDX9zRFnnet2Q58yz7USxhJ0RoeQmKSYn3EYGP+URfzBPgxf//6J4UX9xLJ9S6r6ZT6B9JyeZztBy52u2Qs8Gm6/YMNnW9l4ZlsT0BjLX+Uohs76NtyrJ/mM2+keIvhQkRO2SDAQR3EnLZ/nrWfBURCI4WEY355tMslNAXE6W/5ZUxvaNs5OkpSfHK326hFws0T56g4tj2xQt0fHO+DZuUr1+jePkSrfdx3w1Prjw6QvHqFVra+dFRv3v+HHY6NYGXgNeV5nh+NEdEhp1b7lITVcVdFoxlbNwy7n01kRbMy4my8b4k6TeswX8c8y/qzlAeKSTyFQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Define one box\" title=\"Define one box\" src=\"/static/30fac7257db220c26312628932ca4a7d/e804f/roi-align-box-size.png\" srcset=\"/static/30fac7257db220c26312628932ca4a7d/e4891/roi-align-box-size.png 240w,\n/static/30fac7257db220c26312628932ca4a7d/0ce91/roi-align-box-size.png 480w,\n/static/30fac7257db220c26312628932ca4a7d/e804f/roi-align-box-size.png 734w\" sizes=\"(max-width: 734px) 100vw, 734px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>RoI Box size</figcaption>\n</figure>\n<p>Each box size is determined by the size of the mapped RoI and the size of the pooling layer. We’re using a <strong>3x3</strong> pooling layer so we have to divide mapped RoI (<strong>6.25x4.53</strong>) by 3. That gives us a box with a height of <strong>1.51</strong> and a width of <strong>2.08</strong> (I’m rounding values here to make it easier). Now we can put our boxes into mapped RoI:</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 47.98245614035088%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAC4jAAAuIwF4pT92AAACPElEQVQoz22SS2sTYRSG01JURPwP7X9QF4KbdiVdZqWCLko3XfpLXLryR4hovRTUYBptimlz68w3k7lkLt9tLkkakynyeiapINQDL2dm4Dzf+71zKlIp6HwMleZIyp5PoJmNZP8DtGkhOZ9BJRlkkhWgchznSYXKMIy1lZWVypWSgQ/e/ATRrkN3DhGdfoZoHkB9eQN+fADerUGcfgNvfS1+xwyu5y+AxP4PjUqwHkICJIIjjyN43k/IyEUqJeLQQhh0kYYhdDQsZl4Lnm0+vhy9TbpBuka6Trq1sbGxWuG2Ab9TA88TuraCLXqIVEBXVAiUC08zCE3whBfTuIfAtR/R8Gq1Wr23u7u7ube3d39nZ2drfX39Dn2/WVGsD6fzEWHm0ZALkzcxVAyx9uGpPgaqRQc4GGqbgCfwbetZaW8+n78oM724uMgu++Yyw3evEZknyLJzjNMJhtyGUhp5MoFQnMBDZHqMJBkX88jAgPWflnNpmr4sQdPpdFb2IAgeLjNs1MA678kNw1Ca6IV1DOIOfGHCilvk+Ag+N+DwfjEKjuFZbOEwy7JXJagoFj8fcRxvL4EDA0GvAT05RzYawS0zSyWt0AhRGiGgKHSWQ+Z5MSvB7GzhUAjxnFw2CLxPanied3cB5JShX38L4VpQAxMDo47IakPaJgLWgs9+QLIzxKxX/LKbcCxzsTbbWw+ubAwZJetKQrYbkN3v0P0jCNpF2Vm+l1116bl9CNGqFUhjRFz83cO1EvCvyvoDAes6Wgb7HtgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"RoI divided\" title=\"RoI divided\" src=\"/static/ee8e78b572d14b0ebd98ff08e2c5852b/b7c40/roi-align-divided.png\" srcset=\"/static/ee8e78b572d14b0ebd98ff08e2c5852b/e4891/roi-align-divided.png 240w,\n/static/ee8e78b572d14b0ebd98ff08e2c5852b/0ce91/roi-align-divided.png 480w,\n/static/ee8e78b572d14b0ebd98ff08e2c5852b/b7c40/roi-align-divided.png 960w,\n/static/ee8e78b572d14b0ebd98ff08e2c5852b/64481/roi-align-divided.png 1140w\" sizes=\"(max-width: 960px) 100vw, 960px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>RoI divided into boxes</figcaption>\n</figure>\n<p>If you look at the first box (top left), you can notice that it covers six different grid cells. To extract value for the pooling layer we have to sample some data from it. To sample data we have to create <strong>four sampling points</strong> inside that box.</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 74.85148514851485%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAC4jAAAuIwF4pT92AAADCklEQVQ4y0VUa3PbNhDU//8t/dKZTqdua8dx6jRNFFmWlVi23hIJEG8QJEUqzsx2aTnxBww4C+Dudm+Pg6IoEGNEvztnYbkKVSDEcMK8g7UWSiuE4H9ixhoopV7vOQfvPQZ9sK7rEMsS7eGIQ90gxYRje0QKxOoWzaFD9eEjns7+QpkJtO03NOn1Xtnfazq03RGD5wpTQpHtIP87g7j9B/nnS5i7a+yGl8jHf0PdvoX8cAY3PIccXkBOuMZvIG/ewk6vIW6uoD6ewS6mGPQ0D4xsshV2N5e4FxX2QmCvPO43Giv1FcELUtKo6gBnFAo3h3FbeKtQlZYSGLjtF5j5CINen6btoPdrmPtPCPV3Pg4oqw7eVSjilnJE6pfQNC2DJ+iSCaJBDNUJKxsEsYVd3Z0ol1WNYjPHYvQGk9xjSfrLQmO8yvEgpyjsDkLtYUMBUWTYmhkyvYRUGawnZgTEZgL5OMQghIDjE6uSO2Rfz6EPBXK3hK0zCLfBOowh4wrSr39iuzhFFh4gw+aExT1ENoJdj1khKVfzBdQFGzIbkl4DzepKdtBSx8wsaBsDo90zZpSDsBsoI2G1P2E2wmwXKB6ooasSOgZ0f/wGvRyjbnrtHLWhLr5kFWsm8fyOxA7Pu2ZFLmpqWKKhzUKs4PMVNZy8NIXC6vUjivtrxAMzOonUBOqjSW0GyyYYalU2NLSjZnFxCho0Uu15bmHyGQwLGig2JTGLZMn76TlMoygys1U5pN1i5cbI/QK5XcGkPXKebfwdMv8ISevYlEOEXsMbFPMfTfn2BNe3ffaJnvyOkrQ6TkeiLXS5Q0olp6JC154wlwStYk/YoUXJqSn5PmymL7ZJNQQpi+l7BGqojEWklbQN2PklTLD89sSq5z0PWxSUwLh4wuhRvV9APnzuJ8XhwMw23yG/+gWKQfPRBcwXjtToEtvJ70x0xZG8ovH/Rc59f/cnMo6k4OiZKUf19h3E+1/JkJT7P0Tb0u2kXgWHZDW8EmiigysEKm9Ruh6TxPwrZn9gL/ecQcNq/wfjEViid1m1GAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Sampling points\" title=\"Sampling points\" src=\"/static/3342f95267a184d134d7c20a96e48ad2/b7c40/roi-align-standard-distribution.png\" srcset=\"/static/3342f95267a184d134d7c20a96e48ad2/e4891/roi-align-standard-distribution.png 240w,\n/static/3342f95267a184d134d7c20a96e48ad2/0ce91/roi-align-standard-distribution.png 480w,\n/static/3342f95267a184d134d7c20a96e48ad2/b7c40/roi-align-standard-distribution.png 960w,\n/static/3342f95267a184d134d7c20a96e48ad2/2bb2b/roi-align-standard-distribution.png 1010w\" sizes=\"(max-width: 960px) 100vw, 960px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>Sampling points distribution</figcaption>\n</figure>\n<p>You can calculate where each of those points should be by <strong>dividing height and width of the box by 3</strong>.</p>\n<p>In our case we’re calculating first point (top left) coordinates like this:</p>\n<ul>\n<li>X = X_box + (width/3) * 1 = 9.94</li>\n<li>Y = Y_box + (height/3) * 1 = 6.50</li>\n</ul>\n<p>To calculate the second point (bottom left) we have to change only the Y:</p>\n<ul>\n<li>X = X_box + (width/3) * 1 = 9.94</li>\n<li>Y = Y_box + (height/3) * 2 = 7.01</li>\n</ul>\n<p>Now when we have all the points we can apply bilinear interpolation to sample data for this box. Bilinear interpolation is usually used in image processing to sample colors and its equation looks like this:</p>\n<figure class=\"image\">\n  <img src=\"/f44e8b1ffd03a42ff6653978338af561/equation.svg\" alt=\"Bilinear Interpolation equation\">\n  <figcaption>Bilinear Interpolation equation</figcaption>\n</figure>\n<p>Instead of trying to understand this equation please take a look on a graphical interpretation of how it works:</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 71.42857142857143%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAC4jAAAuIwF4pT92AAACwElEQVQ4y1VT2W4bRxDk//9MHnPADpIYlmVSZiRDFCleyyWXO/e1ByUbQco1QyFAHho93TPbW11dPdFaI6WE7KWUOJ/PxZRS8M6haZpyF7xHKwQE8zknpYAxBm3blu8c38YYMfF8OI4jsrfWlkvjPELsELse2ji4ENENI0zLIicWUxo+dfAxlbfWB6R+wMA6pWDXdaXg5XIpSAZPdLJG7wQ63SKKE5JTiB//wOu7n+GPOwyM3fmAMedVgyCOGBIRZtghBMLXBYWsd2h+/wlqPoO8u4F+nKL++hvk4w3U4jP005Tn27fcJ+jFLe0zxMMHyPu/rgj7vr8ifPkG3VSob/loPkAuLVsfcXA7GP7Up54+Fl+ZLTwpMZ5xx7fWoV18wqQQzsfZd/mi3kA93MHULNCwoA44yjUHZOGMRUferLJo7Q6aXCbGnsUc+VfLKSZ5wnkoeUKv//zLj86o7t6h1Sec6jVaIl6rGRq7Qev29Lvin9UUrWdMpK1nV/oZYnlzRZjloWh9dYC6+RNiP4fyBi5qTtiikk/QTkJpiZAcpyxwcmtKiMOIDtoqmiRFt5jkdguHw4DXXQX3/hccFjNq8wItSYeLOKptkVQgX0Znn1C1K8RwjSNjKRXaxzcO80CKwDllcdigeSbKRHHHGjqesDVztrXDma2qVJe2K39fYtNRl6EubYvlxyvCgeiyf3n9DkttNZRIJGrLVkLwaNyGIjb8sYUnBdkf9eq/c4iedAjIJ7acVyYPJk9puLxAnfZol18Qhm9lE2Ia0fgDQhY/tyf13KrQkUPSw/uQhmKG2yLzlDM3ecKWAu/HC2WzxXn6KxS9Oaxoa+w3FPVhCVWtYI8byP0KdUUx7xawlJlmXvIsv374v7BHrp7TCnIxhXr+G/rNxGoGtbmHXDPePkAwJ9dfIFdz6PU9FPPiaYbQ7PED2s4MpwckuzUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"First dot interpolation\" title=\"First dot interpolation\" src=\"/static/2ca4fe8bcefbad8d321fcae5b8992d79/b7c40/roi-align-first-dot.png\" srcset=\"/static/2ca4fe8bcefbad8d321fcae5b8992d79/e4891/roi-align-first-dot.png 240w,\n/static/2ca4fe8bcefbad8d321fcae5b8992d79/0ce91/roi-align-first-dot.png 480w,\n/static/2ca4fe8bcefbad8d321fcae5b8992d79/b7c40/roi-align-first-dot.png 960w,\n/static/2ca4fe8bcefbad8d321fcae5b8992d79/7cbef/roi-align-first-dot.png 1134w\" sizes=\"(max-width: 960px) 100vw, 960px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>Bilinear Interpolation for the first point</figcaption>\n</figure>\n<p>When you take the first point from our box, you’re connecting it with closest neighboring cells (exactly to the middle), unless it’s already taken. In this case, our point has coordinates <strong>(9.44, 6.50)</strong>. Closest middle of the cell in top-left direction is <strong>(9.50, 6.50)</strong> (it would be (9.50, 5.50) if our point was only 0.01 higher on the grid). Then we have to select a bottom-left point and the closest one is <strong>(9.50, 7.50)</strong>. Following the same rule, we’re selecting <strong>(10.50, 6.50)</strong> and <strong>(10.50, 7.50)</strong> as top-right and bottom-right points. Above the RoI, you could see the whole calculation to get the value for the first point (0.14).</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 80.37848605577689%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAC4jAAAuIwF4pT92AAADO0lEQVQ4y1VUa1fbRhT0//8j/d7HSdNS4oSQEMAhxhhq2dZzpdW+tHrYloGeMx0J2qYf9mg1e1f3zp25mlhrsd/vUVUV2rYdV+Xc/7CmaeC5HzDHs67rRqz6DhviBnxSluX4IqVEHEcQQiCKImitoZQa92mawNd+jBnehcgQMdaY72NSfthiUtc1jscelffo9j2z7OF9i8PhkR8Zsh7Qcd9ezXB88xY+Fdj1T+jaPavs0PePvNtgx7uH4+NLhQ0rLPMM5voEdnmO8tsUXXABPZ9C353CLD5AXvwGPzuFvD6FWkyhbqcob6bw958hb97DzE7g1nNMhjIPzGLzGNvzn2AzBRUnuLxY4e5G4PLrFZJoC2cK5CKCNyXC5AZ5sYIrc+TxBt5ppPfXSJlgMorSH2FEDLm8QLt7RllUuFvWCFYNMhvDN35sw9CO2ncofQ5b63HfDi1qKEyRQQdfXyl3O8h4jXT+DqZ1yIoYwVZgFWSYk8Y2jZBLXnAFZCkQqwdkejPutS1QaFYf3yEn/YmnGMfnv1ANgbdvoQ+SwWsEaYDcxVgkV9iQXm5DpDpgdQnWaobELlE4qqtWkM2g+iWKPz+xQlLuNiHK6e8ogxkFOsAoQ5UPsKqCrEKqaGE1vbkbzhxUNVQriVUvmPGoihRqNaMoXYt+FcD/+jM23854uYU1Bnmeo6k7RPIBxio4Sx8WEg3P4yKA1BkHwKMoCtTtDmLzALFghdYNk8IsESnefYDfN2NffMuqKoPUPUBTBONKYoZPBVGtST3luX6Jqy10HkAFV5iof0RJQ4Q3b9iPHJlas38hchNhrWkHu0KiAgi7GcUYehibJYQO2ccQwiVIkhmy5cdXUZ6e4SlKcv2ONujpqwpaaexoh9xuOZo16qqhF92ICRWOig/0rTa0Uw9JhsX9l/9sUxAoH76gPjyRMi8O3rQ1hOfM1o5UOZqHnmceJVmoWhGrX7AhmRKkfE1RXo1taczwjx+Y5QJi/p6L47Y4x2b+C8TyjP09R7Y4Q7H8jC3tldyeIL/9OMYNWPLpR0juJ8MvqO9Jk9QbRRpSwIkEHc3qOD0Nx2tY1YjJ8WzEGFf9G0eMBe34R/obp6icfeKiGXIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Second dot interpolation\" title=\"Second dot interpolation\" src=\"/static/738e022f9e765dcded86cbb28c0d37a5/b7c40/roi-align-second-dot.png\" srcset=\"/static/738e022f9e765dcded86cbb28c0d37a5/e4891/roi-align-second-dot.png 240w,\n/static/738e022f9e765dcded86cbb28c0d37a5/0ce91/roi-align-second-dot.png 480w,\n/static/738e022f9e765dcded86cbb28c0d37a5/b7c40/roi-align-second-dot.png 960w,\n/static/738e022f9e765dcded86cbb28c0d37a5/a505c/roi-align-second-dot.png 1004w\" sizes=\"(max-width: 960px) 100vw, 960px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>Bilinear Interpolation for the second point</figcaption>\n</figure>\n<p>This time we’re interpolating from:</p>\n<ul>\n<li>top-left: (10.50, 6.50)</li>\n<li>bottom-left: (10.50, 7.50)</li>\n<li>top-right: (11.50, 6.50)</li>\n<li>bottom-right: (11.50, 7.50)</li>\n</ul>\n<p>You should start seeing a pattern here :). Here are the other points:</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 79.8611111111111%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAC4jAAAuIwF4pT92AAADR0lEQVQ4y1VUy3LbRhDk//9HKhdfUkkclV2SGcWxZJkULYmiKEIEQbz2vYsXCZV8aDcgO1U5bGHQO7uY6e7BxBiDruvgnENdVeMa4rZt4b1HXdeoiAXG7c+8H9gQD2ettWiINU2DiVJqPCylRJqmSLMMyT5BKQR8CGOc5RkcL5SiHPf3Y16KoiyhrcEuScY4VAGTwEN93/OlwqE74lA1qF3AM+Pheaw7dO0B7adLfHt7gipJcex6dKFB4yv03Kusx6HpcDz2mAyV1SxV5ink1Qn08iPK6zNUDxcQ11OI21Po23PIz+8QhvfZGdTdFPKGa/E3/OoCJZ9m9g42usXEe4f++QW+THEz/RVlViJLNrhd3cNqj225gNQprNMoZIYQLOLiDqWOyZ1CUSQIdcB+PUe+/BcTYzS6wxEqjSHuLpCRp2i74gUVvG1R2Jj8OcYUrKZQtoZwKbSX8K6miA25bmGzGGpzjYnWFIUXynSL6MufWOdLLNYfsc1XKFnRTi8hbAqhcxgvWG2BvVkjN9sx1k5wX6JI7iAev7yK8vzyDV5kiK5/h2xzFOYJsbyH8Ake1RUytxkrTfUGMuwRqTn2lh90O6RqA1FniONLiM1nikIPtdET5OkJVLSgQD2MMqOSRnkeGlq2I5+DC4xyUD5jZfIVo8rGBHhyqYeWHRXueWF4/xZPX8/JRwNLsxdFQX5a7MQDDAVxtIagNwfOkvIR0uTkMKCk/+rmgGyzRHHPCgeXHw49dBKhWJ4jHGqalSZtWJXXSN0DdHjlyjdmrCz3Q+tU3qsxz1QWOl9DR3NOyuBDli32W8TXf5GPApmKRs4KkyDSM2T2kVxFyO0TMv2ESM6RmBX3Y5RDnk+R7K6Q05P/iRKo6H4+RdM+I7A9oznj9YEXbzmjnF1fj20PWK5i0sD2/UAPNSDfYruGWM9+TErbodiRl9UlquMLW2YSx0jbgDzsYILjBeEVowCizqGCIlYRO9KT/JjY04ds2TmLY/8MW9Jz73+BuDlHPjsd1zB629lvyL+eoVhMkXEkSwoXz/9AOj9BOf8w5pU3/2A/fQN592kYPf/6c2DrDSeipqJeC3SVg1OCmCVmRqwdMP0T+3/ekNO1Db4D+lCcsNh7vaMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Third dot interpolation\" title=\"Third dot interpolation\" src=\"/static/bdfccd5f0e581b14843c24a1a247a3ae/b7c40/roi-align-third-dot.png\" srcset=\"/static/bdfccd5f0e581b14843c24a1a247a3ae/e4891/roi-align-third-dot.png 240w,\n/static/bdfccd5f0e581b14843c24a1a247a3ae/0ce91/roi-align-third-dot.png 480w,\n/static/bdfccd5f0e581b14843c24a1a247a3ae/b7c40/roi-align-third-dot.png 960w,\n/static/bdfccd5f0e581b14843c24a1a247a3ae/b2e88/roi-align-third-dot.png 1008w\" sizes=\"(max-width: 960px) 100vw, 960px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>Bilinear Interpolation for the third point</figcaption>\n</figure>\n<ul>\n<li>top-left: (9.50, 6.50)</li>\n<li>bottom-left: (9.50, 7.50)</li>\n<li>top-right: (10.50, 6.50)</li>\n<li>bottom-right: (10.50, 7.50)</li>\n</ul>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 78.67063492063492%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAC4jAAAuIwF4pT92AAADQklEQVQ4yy1U2W4bRxDk//9IAuQpBgLYOeyYEiU7OixSFCVSFLn33MdelGgjqNQu8yDMqLq3p7u6ihNjDJqmgVIK1trxT1QVmrqG1gpD3BHzIcCPmIb9H6uY13UdpBAwxANzJs45xBhRliUEi0pjkTPRRX7sPSpildLw1sEypyyYx4KSBTP+3/QHCG1QSn7LopOho77vYVm4H7otcsQ8w0FJhDRBz9d7dhrPz3D8+SfEmyu0jPV8NGQpXrUcz7YscPDsUEqJum0h0h3U1Qfo1SXE/Rn8+iuq+RTV6hP04wzV3We4p68Qi3PI5RmK5R8Q87MRG2Lm4QLq5k9MhrmPP/6FK16wX0zhwhE2q7BZJ1Chxz65hSwTBHJVWo3IaUTQ2LkN7weURjHWwLCp3VBwILk7vELsntjdFYyLkNst/PUd1MMaQmwQjIbTDl3TkUsux3Mhdkc8jpjTlos9QC0vMBm22w7EsmB6/wllKLHbfkM2v0S2ucP6eYpsP0cudijUDqVKkMoNNuKa9xQ5sVy+sPsMybffMfHc5BtHtgU/ePgbpjfc6pab3EHGAi/FP6j0BtJl7Io0+ByF3eLF3PJeENtDuGTMzRYcWXDLzeMTxK+/cNQ76q2jpgZtdlBCo/IJeXVQ0qAlZhS16sxY1Cg3YoqSiXUHsZyxQ5J5THP49++QLr+wYIvgPMUt0cQWmXomZw4171Ko8VSUUarWqJkrh2Ihwvka6c3HE4eDOKvtCsXqM3SnIDiaqSlgmyLxC4i45zb30HWOiuOVnopwc9KQwzQlKsZMKyklFjRm2PIbZLIhMIVtOZ4rYIKgUyrk4RGa/ChXQodqxITjQ24J4yVslGPMNhr54uPJeq/H7zDZFuntdBzZ0X5SSEQfT/IIljQEaFqw5mhKCW76CdHRnhx5oMhSTunNX3QKrVW3PYrnJdT6GuH1B18OaF+PfJkerzO4JkK7AXtjrIatA4pIWnwzYsp61IfvkKuLk2yGDl2VoZy9g3y4HC0lB4stZpTCBybOaLcLWnI2xitaL52/H+Py/vyUy1j15bdTwcPhwE0GRM1fmXJPTe4RJQnPd+MZFe/U6XBaxr1IEcUpXqvT6asEDa35H2FCnCQ5rvK7AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Fourth dot interpolation\" title=\"Fourth dot interpolation\" src=\"/static/30a1be50f06203fb347ecc08b30f4c06/b7c40/roi-align-fourth-dot.png\" srcset=\"/static/30a1be50f06203fb347ecc08b30f4c06/e4891/roi-align-fourth-dot.png 240w,\n/static/30a1be50f06203fb347ecc08b30f4c06/0ce91/roi-align-fourth-dot.png 480w,\n/static/30a1be50f06203fb347ecc08b30f4c06/b7c40/roi-align-fourth-dot.png 960w,\n/static/30a1be50f06203fb347ecc08b30f4c06/b2e88/roi-align-fourth-dot.png 1008w\" sizes=\"(max-width: 960px) 100vw, 960px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>Bilinear Interpolation for the fourth point</figcaption>\n</figure>\n<ul>\n<li>top-left: (10.50, 6.50)</li>\n<li>bottom-left: (10.50, 7.50)</li>\n<li>top-right: (11.50, 6.50)</li>\n<li>bottom-right: (11.50, 7.50)</li>\n</ul>\n<p>Now we have all the points calculated and can apply <strong>Max Pooling</strong> on them (it could be Avg Pooling if you want):</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 50.67204301075269%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAC4jAAAuIwF4pT92AAACTElEQVQoz22Sy27TUBCGjbLgEdi0EhtWbHkJhAQ7WCGxYcGjFFiwaReookLqI6BWogVUJFC5pKRt6qZt7Njx9fhc7DixE58o/IzdSmw6mznXX98/M0ZZFMjzHONyhrwoUUzrPEU+KVC4Q+Rphsm0au7ySalBobLRS4MCC7TybtcoTdMoKVeuaxi1mOQJeK8N0T+CtLpgFwfgZwdIv2yBH++DWx2Ii0Pwi0P9VwwR9c1G8NoYE4mIffid7xBBhMjx4PunSEIXUnAksYsg6EGEIb0L5zpLYP/YXiHQm7D7t8neMrReprw0c5wlI59MIFiEgKhilUAyBo9bYDKCVBKxDBFIB0IJJKmcz6scg/buCtLpvd721otP6+tPP6ytPfu6uflcD4dPjIJqmHoOgv5PsCykTwEcfoJA2GCKyIUFV5iIhYdIeXo2S+D83nlVu1t9/+5Ou9N5c3p+/nZ3b+/xpWWloPY+IzAPoNQYiqcIkyE451BiRDlp9pLOpRzpeTGB/evj6/qv4skjXMW0LDcuBcdk+YqQ5zFkFmEoT4lmAE7EobLhqzPwlOizUM+1hNPeaQRFwu5XVdUIZlm2+r8pjOp09gcyH1GtJIm4EBmHTFOyHVMNaU9ORJbqaprXhE2XA8e6JYR4IKV8yBi72wjmNWHkITj6VncRMvTheSdgwYDWAeLAoq6bNAEeeOhrnTEM9rdXrpuYxWJhGGU5xYioOBEK+wTSNsFo7rjdhRiYTU7sIwiaT24d6wU1itm9hnAWD1pE2CLCFhHeqM/+AR1icdINqPjuAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"First Box Pooling\" title=\"First Box Pooling\" src=\"/static/3a43f0b9d96c7bba35d4b8e3b5c9e07e/b7c40/roi-align-first-box.png\" srcset=\"/static/3a43f0b9d96c7bba35d4b8e3b5c9e07e/e4891/roi-align-first-box.png 240w,\n/static/3a43f0b9d96c7bba35d4b8e3b5c9e07e/0ce91/roi-align-first-box.png 480w,\n/static/3a43f0b9d96c7bba35d4b8e3b5c9e07e/b7c40/roi-align-first-box.png 960w,\n/static/3a43f0b9d96c7bba35d4b8e3b5c9e07e/5a2b3/roi-align-first-box.png 1440w,\n/static/3a43f0b9d96c7bba35d4b8e3b5c9e07e/717b2/roi-align-first-box.png 1488w\" sizes=\"(max-width: 960px) 100vw, 960px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>First Box Pooling</figcaption>\n</figure>\n<p>I’m not going to show you all interpolations because it would take to long and you probably know how to do them already. I’m going to show you how the whole process works for pooling data from this RoI using RoIAlign:</p>\n<figure class=\"image\">\n  <img src=\"/e4f0fc7303311b463badff2fc95ccf30/roi-align.gif\" alt=\"RoIAlign Process\">\n  <figcaption>RoIAlign pooling process (open image in new tab to check all calculations)</figcaption>\n</figure>\n<p>And ofc. this process goes for every layer there is so end result contains 512 layers (the same as feature map input)</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 445px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 104.26966292134831%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAADjklEQVQ4y7VUS09TQRi9bUFZdEFCYKEbkyaCRoWFiWJ0YUJ8dOGixsT4D9wZd/4EYCElBFsTAgkLNgRYsSA0tPJ+tbzfbyjl/X72XmY8Z7i3lKhLJzmZr3NnzpzvfN9U064PB2BLii1Yw27i36OpqUkrKChQJA6Hw2Wz2T4Cz4GnwFvgE/Aanz0m3gPvgDdJl18f7e3tak5NTc3A4VwgB+S37XZ7JuI7iHPT0tKyseUW8Bj4AGRr/2lcVxkOhz9PTU2FJycnA5FIJAT8mpiY4BwaGBgIYp1za3V1dR73u91uJ6b8lJSUv6c7MjLiFULI1dVVubW1JZeWluTa2prc3t6WKysrMhqNyoODAzk6Orra3NycwzPp6elPMN0zKR4BGckKC3d3d+X09PQZ1BhjY2NGf3+/mvkbSo3BwcHz5eVlifVYWVnZfZ7LzMy8i+kh8Mr09YYi7OjoKKayhYWFOAjk+Pg41ci+vj4J9QJrAkQSaetUj/VYUVFRnknKwjwDXgAvVUsNDQ0Vb2xsSPgYp4q5uTm5uLioAC/5W4BImLFOK4aHh6OlpaVMVcvKyqIN+cBNpZCEh4eHEinGZ2dnJVWCXHk5Pz+vFM/MzAhcIBjDGp0ZgTRWVVX1gBxOp5N+uhIp81amTBVIUymjQqolKddwiUAsaAe+6ywcxMQaGhqUUlTdrYoDfwpjsRhvjjM10y9FyArv7+/Lzc1NSTsQC4IxVMYvLi6ovtUqsMvlsrFtvpspn1MRlaDy3KgUUhGUKHIq7+7uVp6yC6gSa20k83g8l6yBQODrzs4OFenwSKXEyvIwSY6Pj+X6+rpk4XgxFYNIoNUMiYFzSiFCrb6+/vLptLS0/OAB3MweVKQsAq04OzuTe3t7qvFJfnR0pGKsGXwQ2NdmEfb09Fy9mFAo5GP1aHhvb69gxa3KdnZ2KhLawPTZAbDGMLsiQYi9mlZRUZF4k6j4Tz43fNDhEVtFpUcvqZae0QYTBq0CaYIQxbwkqqmpSZDCUx9J6SlsEPTp9PRU0EfDMCTTJPHJyYnyEMQJQmSmaXV1dYqosrLSlvSn66enIDVgQRze6DioIz0db1tH2+hI/xxZsAtCPKPruoZY0/x+vxYMBv8ghdJyFoCqmBoOqAKxMNZsVjliKcQFV0Wpra1Vs8/ns0jtXV1d33CgHE1fgt704qV48aK8jFGUEnz7gT+LLxZhY2Oj9hsd3JRi9YcoNgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"RoIAlign Full Size\" title=\"RoIAlign Full Size\" src=\"/static/62876dcafd909f58db894bafc86a2e4b/970e5/roi-align-full.png\" srcset=\"/static/62876dcafd909f58db894bafc86a2e4b/e4891/roi-align-full.png 240w,\n/static/62876dcafd909f58db894bafc86a2e4b/970e5/roi-align-full.png 445w\" sizes=\"(max-width: 445px) 100vw, 445px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>RoIAlign full size</figcaption>\n</figure>\n<p>Notice that even if we’re not placing our sampling points inside all cells from the feature map, we’re extracting data from them by bilinear interpolation.</p>\n<p>In this case, cells 11x6, 11x7, 11x8, 11x9, 11x10, 13x6, 13x7, 13x8, 13x9, 13x10, 15x6, 15x7, 15x8, 15x9, 15x10 will never have any points in it. If you look on second point calculation (first box), it still uses cells 11x6 and 11x7 for bilinear interpolation even if the point is in cell 10x6.</p>\n<p>If you compare data lost/data gain from RoIAlign and RoIPooling you should see that RoIAlign uses the whole area to pool data from:</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 44.3089430894309%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAC4jAAAuIwF4pT92AAAB4UlEQVQoz3WRzWsTQRiHt/UTDwpe/Q/8bzx58C6IBy8KKr1VEZQoPSgVlZaktU1TUEGjOVSLAU2ysws26QbzRSC7s7NJTPawm+wyW3/OrLEfWl94eWeGZx7ed0ZRDsaZv/YKAOU/cUrkyX9Oi8ViUtO0JCEkqapqiqhqkqilBV3TMmvp9JWJdFrWQqFwQ3AZwS9IVi2VUhohi7qur+RyuYRAjim+7yMMQwRB8LtyDi8MIINo2upEeERWxthneR7fEbxkR+NxzDaazY5AjiumaXLbtuOkcv29xpmqjf1WG+TT5rP9QsG+dV0Xgg2o5Jstbue/hEP9G+q1elkg0xICs22wbhdWtQozcw/e+i2O7B28S1x6ISHUirHQsqz3nueBOYzbzTboqzkgfS3Chxls3H+4LZDTu0Kn3wPbKqO1eBnu0gW+s3oRyzfPyw7PYu3R0T9CXwhp1+FupYr8UgIPXt6O5t/MYubqbEUg5/Y6dLpwGg2Qjaf4mr3LjfwcVlLX5ycjT+3vUD5Pr+dA1w08z5JoeXMbr9c/GnsjMyaheGz6YwCzP+T+DmDUW48PEwpevjn6YqqR249+Bj46nbYR//IBoUxKZfJgNEKlvPVEQFOHdRjfoTYsSqPBYIiqCIGc+AW8odHiYdScQgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"RoIAlign comparison\" title=\"RoIAlign comparison\" src=\"/static/80924c25532827aafc07e380b1f31b56/b7c40/roi-comparison.png\" srcset=\"/static/80924c25532827aafc07e380b1f31b56/e4891/roi-comparison.png 240w,\n/static/80924c25532827aafc07e380b1f31b56/0ce91/roi-comparison.png 480w,\n/static/80924c25532827aafc07e380b1f31b56/b7c40/roi-comparison.png 960w,\n/static/80924c25532827aafc07e380b1f31b56/5a2b3/roi-comparison.png 1440w,\n/static/80924c25532827aafc07e380b1f31b56/eff2e/roi-comparison.png 1920w,\n/static/80924c25532827aafc07e380b1f31b56/6a172/roi-comparison.png 1968w\" sizes=\"(max-width: 960px) 100vw, 960px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>Comparing RoIAlign(left) and RoIPooling(right) data sources.</figcaption>\n</figure>\n<ul>\n<li>green means additional data used for pooling.</li>\n<li>blue (both shades) means data lost when pooling.</li>\n</ul>\n<h2 id=\"roiwarp---meet-me-in-the-middle\"><a href=\"#roiwarp---meet-me-in-the-middle\" aria-label=\"roiwarp   meet me in the middle permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RoIWarp - meet me in the middle</h2>\n<p>There is a third method of pooling data that was introduced in <em><a href=\"https://arxiv.org/pdf/1512.04412.pdf\">Instance-aware semantic segmentation via multi-task network cascades</a></em> and it’s called <strong>RoIWarp</strong>. The idea of RoIWarp is more or less the same as RoIAlign, the only difference is that <strong>RoIWarp is quantizing RoI mapping onto a feature map</strong>.</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 786px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.2849872773537%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADL0lEQVQ4y52Sy28bVRTGbxweIqpUVuwQYlXW7JBoKpU/gAV7FohWXXRZtamgUhcRoEq0RZSHIiJSb2gruY9EhdDEiZ3YQGySuI5NYnv8fsyM545n5s6948n4zpzeTEREkdjwSaMz+ubcn75z5qL11Cr6p/ahGMnUF8YB7Mi5U2+80DaNmX42u67NP/pFSyTSTcv8/KCPgjyekxcjRfNJZJfEI6vqN2NHkM9+io7LieR1Lb1xE/1L+u/ZEiyvgHsvBlDchf7m0yX0H+qx3cOX2xcejrXiTy6UN+cf/GbMvbfU/frklj03uUZmT20t35iWEj9+V0zMfrW7t/j9zmb0k5hy9d2cc2cy3r01mR7MnsyQ6OlYa+r1EBavzBxF7Q6lJDAA12OABwwGFIMW1JkxpMTxXZs4NsFMHSqjIhDbDvsINQMQagw3LoeQslIYF5CxqV9fO6ZY9b+G1AVKGbcxCUwLB3jYgCHdB9dxw0qoAR1aCKjlBjahAaOOdwCs29lLzy/gGopIg8yO5jSgpe/xbq8QtHA+KBnpoKtLQWdQDtq4HNSFV9CXgt6gFrT1knjKnu2rkMMLh8Cajs8q2/mZ1NyVd2RX2gDwwaSYY0sDze5AlxVBxT2wGAZsqNDVa9Bkm9DHqvB00K2+x8GFKktPhUA1k0mC0ofC2v0zKm0nD+ITk3LP8YEyGxS7BiNXXCLLESOPgDkUmmYefDfsA5d54chVI3sxBGqx2AL8vAh7d299KNHtNWXQAJ11eFMtQ10rQJ1moa6I60Kb0OqXoKJsg0RTUG0Lz26JxNUR8UQg8vhKCOxnM8uwloLSzU8/qrCnq65vQbtf8XS7x2VL4hX9D24wlYtRuWq2uUJqvKDFuck03tEkrlqtfQ8opOToNLqKXkFtVf0Bb+VwPvrFB7qnbsHfGgFwfyQ2So4s4GLDARfHu+APDy3fO6wVJ3nt5XvoTbSyuDCRAzj2ceP9iRJORXtm9c8GLq73TCndNHbSFSuVxE5rVSaVhEyqCZmVV8QfzTQG+VxV286KutEw8tKK/O15dBG9hP6XLqMJ9CV69e15dOKtmEg1jY4L78WDT88A+vfHL8yGgSIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"RoIWarp\" title=\"RoIWarp\" src=\"/static/0baf3ae7bbf1cc2a8f1b7b18fe42a4e7/b40ed/roi-warp.png\" srcset=\"/static/0baf3ae7bbf1cc2a8f1b7b18fe42a4e7/e4891/roi-warp.png 240w,\n/static/0baf3ae7bbf1cc2a8f1b7b18fe42a4e7/0ce91/roi-warp.png 480w,\n/static/0baf3ae7bbf1cc2a8f1b7b18fe42a4e7/b40ed/roi-warp.png 786w\" sizes=\"(max-width: 786px) 100vw, 786px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>RoI Warp</figcaption>\n</figure>\n<p>And if you look on data lost/data gain:</p>\n<figure class=\"image\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 807px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 110.65675340768277%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAC4jAAAuIwF4pT92AAAD7UlEQVQ4y41UXWibVRiOeFF0gpUxmducDAR3sRt34YUwwRsvA4ONXeyHMWkbt1XHEHE3DrdYU9jUXQ7GtOuozfKzC2sLnTFBmzYWt9ophcy2afMl33/+mrRJ+33J4/ue7AuVkekHD+973nO+5zzve95zXK7m90wb8LeFsJ3w7H+sddY//evs7Hyzo6Ojy+12P/8/lgvSTsJewsuEVx6r2YydhN1t5ji2jfA64TVBGYvF3JFI5HwikeiemJjwxONxD1saCzs1NdVD6CZ4JicnPc4aZ578boqf83q9bxPdc650Oj1hWRby+TxyuZywjHK53PI5XiqVUCwWW7GVlRVhNU0Df6FQ6DIR7nGlUqlIoVCAoigbmUymns1mBWhh3RmzVVW1LstyK+bMS5K0Xq1WMTo6+gkRvuCiYHRtbQ2madq0qOGAdhdW1/WGpmoNmm8YhtFQNVXESbXwFVWx6vU6xsbGLojzIIVRTocU2kQO2h1sOZXNY5qHLGchZSQxJsXCT0tpq1arYWRk5FMifNG1tLQU5XowIf/sgJQJS2kKAlMzkdPyMBQDhmqiaBaFr8uGVduwiPCHJqGjkH4UCh2wArZpaRkFdQXXJj/HQf9+nAi+i2PBd3D07gEcDR7A4e/fslLGDOKR35qEdMrR1dVVVmRzWkzEoJqJNBWZ1JVq+HWwF/6L2xHu34fwl3txt/8NhMgOe/dY98ZuYPzGUJNweXk5yi1CNbM5PUFCoAMQ6apZUlwoY2OgHxg4CTv0ERqBs9QnvWjcOYta4LTVHxmG/5Lvwr9SbnsoUhqSWYJ56zLM7w5DC3RB959CPvg+9OFTyNw5aV2J+RH44uqTh+IQMphQHAoT5kooDfahOngM5fAZVIIe1MIfoBLwoBDstr76JYiQ72vuw5dEDSuVStsaqtQqSnEV2ref4e/r7yE5dATJwUOYHzqER2T/vH3Q8o4P4EfftY+JcKtQyDUkEttpEwa3TbNl0ijmq7hJ9Tp+cQt6fLvR1bcTXb4d6OnbhROXtlo/jd/E/fD4efFQcA2flrLYJCtjXp7H3NJDzC0SUg/xSJoT/l8Lf1jWRhXxqcQ58QK168PNN4XuK3RVJxhQslQSWYOp54QvZxW6KeugV6eXCHe4aLHoQ2oT26kfg18YtkzMlttI07VmXVWFamw0r6MiW3bdxoP7D84Q4avchxF+luindVbpgDdg+/hK8sPBG7bm+RDZ0lyN7/Ls7GyPUEiHkuDXgkn5GWPLYNWOz3E+OK61E+POYMvK+ZuZmfmQCPe7ksnkN6QyQcQ/LywsxBYXFwWonWLOmC2tiVG9WzFnnhAh//fp6Wk3Ee76B4+d2hYyXuMQAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"RoIWarp data\" title=\"RoIWarp data\" src=\"/static/eb0087f56f93e2191dd180d2dd1769dd/a0800/roi-warp-data.png\" srcset=\"/static/eb0087f56f93e2191dd180d2dd1769dd/e4891/roi-warp-data.png 240w,\n/static/eb0087f56f93e2191dd180d2dd1769dd/0ce91/roi-warp-data.png 480w,\n/static/eb0087f56f93e2191dd180d2dd1769dd/a0800/roi-warp-data.png 807w\" sizes=\"(max-width: 807px) 100vw, 807px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>RoI Warp data lost/data gain</figcaption>\n</figure>\n<p>We’re only losing a small amount of it due to bilinear interpolation.</p>\n<h2 id=\"how-roialign-and-roiwarp-affects-the-precision\"><a href=\"#how-roialign-and-roiwarp-affects-the-precision\" aria-label=\"how roialign and roiwarp affects the precision permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How RoIAlign and RoIWarp affects the precision</h2>\n<p>If we look at Mask R-CNN paper there are some important numbers to discuss. First one is a change in <strong>average precision</strong> when applying different RoI layers on ResNet-50-C4 with stride 16:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>align?</th>\n<th>bilinear?</th>\n<th>agg.</th>\n<th>AP<sub> </sub></th>\n<th>AP<sub>50</sub></th>\n<th>AP<sub>75</sub></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>RoIPool</td>\n<td></td>\n<td></td>\n<td>max</td>\n<td>26.9</td>\n<td>48.8</td>\n<td>26.4</td>\n</tr>\n<tr>\n<td>RoIWarp</td>\n<td></td>\n<td>✓</td>\n<td>max</td>\n<td>27.2</td>\n<td>49.2</td>\n<td>27.1</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>✓</td>\n<td>ave</td>\n<td>27.1</td>\n<td>48.9</td>\n<td>27.1</td>\n</tr>\n<tr>\n<td>RoIAlign</td>\n<td>✓</td>\n<td>✓</td>\n<td>max</td>\n<td>30.2</td>\n<td>51.0</td>\n<td>31.8</td>\n</tr>\n<tr>\n<td></td>\n<td>✓</td>\n<td>✓</td>\n<td>ave</td>\n<td>30.3</td>\n<td>51.2</td>\n<td>31.5</td>\n</tr>\n</tbody>\n</table>\n<p>There is only a small improvement when RoIWarp is applied but applying RoIAlign gives us a significant boost in precision. That boost increases with stride:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>AP<sup> </sup><sub> </sub></th>\n<th>AP<sup> </sup><sub>50</sub></th>\n<th>AP<sup> </sup><sub>75</sub></th>\n<th>AP<sup>bb</sup><sub> </sub></th>\n<th>AP<sup>bb</sup><sub>50</sub></th>\n<th>AP<sup>bb</sup><sub>75</sub></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>RoIPool</td>\n<td>23.6</td>\n<td>46.5</td>\n<td>21.6</td>\n<td>28.2</td>\n<td>52.7</td>\n<td>26.9</td>\n</tr>\n<tr>\n<td>RoIAlign</td>\n<td>30.9</td>\n<td>51.8</td>\n<td>32.1</td>\n<td>34.0</td>\n<td>55.3</td>\n<td>36.4</td>\n</tr>\n<tr>\n<td></td>\n<td>+7.3</td>\n<td>+5.3</td>\n<td>+10.5</td>\n<td>+5.8</td>\n<td>+2.6</td>\n<td>+9.5</td>\n</tr>\n</tbody>\n</table>\n<p>Where <strong>AP<sup>bb</sup><sub> </sub></strong> is an average precision for detecting bounding boxes. The test is done on ResNet-50-C5 with stride 32.</p>\n<h2 id=\"summary\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h2>\n<p>Understanding RoI Pooling is important when we want to improve our R-CNN-like model accuracy. There is a significant difference between the standard approach proposed in the 2014 paper about Fast R-CNN and a new one proposed in the 2018 paper about Mask R-CNN. It doesn’t mean those methods apply only to specific networks, we can easily use RoIAlign in Fast R-CNN and RoIPooling in Mask R-CNN but you have to remember that RoIAlign gives us better precision on average.</p>\n<p>I really hope that my explanation is easy to understand because I’ve seen a lot of post writing about RoI Pooling without getting into calculations. In my opinion, a more visual approach is always better, especially if you don’t want to spend a whole day reading the original paper over and over to finally understand what it does.</p>\n<h3 id=\"references\"><a href=\"#references\" aria-label=\"references permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>References:</h3>\n<ul>\n<li>R. Girshick. Fast R-CNN. In ICCV, 2014 <a href=\"https://arxiv.org/pdf/1504.08083.pdf\">https://arxiv.org/pdf/1504.08083.pdf</a></li>\n<li>J. Dai, K. He, and J. Sun. Instance-aware semantic segmentation via multi-task network cascades. In CVPR, 2016 <a href=\"https://arxiv.org/pdf/1512.04412.pdf\">https://arxiv.org/pdf/1512.04412.pdf</a></li>\n<li>K. He, G. Gkioxari, P. Dollar and R. Girshick. Mask R-CNN In ICCV, 2018 <a href=\"https://arxiv.org/pdf/1703.06870.pdf\">https://arxiv.org/pdf/1703.06870.pdf</a></li>\n</ul>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n</style>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 37.10575139146568%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAB7CAAAewgFu0HU+AAABtklEQVQY0wGrAVT+ANnY2L6hmdGypNG4rMuxo7iThs2yqP39/er8+83r6eL49+L6+dHm5cjo5r/S0crGxtbW1cvKysHBwefm5gDDu7mHYliqmYqMcmekk32xlHfHppPPz8/I2tng2tvy4eL5+Pju6Ojj6Oi8y8u+srPEwMC8tLS7sLDc2tsAx9PYlJqiio+abHSKhYCEtoxpzqiP9fX13O3t0NbW3c3O6+fn3Nvb2OXk0uLhz8LD09HR2NLSyb/A6efnAMPKzZudo4uQmXhqb4ZsYLWObM6oj/7+/vH//9ne3tvR0+jj48fGxsrIyMbV1eDS0uPi4t3d3dra2vPz8wC2u79wbHOsn5GXXkiablW7n4LDpI7T09PS4+LDyMfUx8nm4eHa2NjVzs7Dz87gzs/g3t7b2trh39/y8vIAw7y7hF9RiGpXfVFAelxQmHVcypqA8/Lx0uPi4Ofm69nb8uzs7+zs2uLiyNnY3dHS1tbW4+Pj6ejo8fDwAOK6o71zTZxdRJZkUGNLR4NZR6iGe//+/dHi4dnn5uns7Nvh4eXn59bl5MXW1czJyc7OzuPi4uTj4/Dv71a7PuI17RimAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"VGG16 Output","title":"VGG16 Output","src":"/static/2c35532f7b36e72f542981c094ed4d91/b7c40/fast-rcnn.png","srcSet":["/static/2c35532f7b36e72f542981c094ed4d91/e4891/fast-rcnn.png 240w","/static/2c35532f7b36e72f542981c094ed4d91/0ce91/fast-rcnn.png 480w","/static/2c35532f7b36e72f542981c094ed4d91/b7c40/fast-rcnn.png 960w","/static/2c35532f7b36e72f542981c094ed4d91/5a2b3/fast-rcnn.png 1440w","/static/2c35532f7b36e72f542981c094ed4d91/a697f/fast-rcnn.png 1617w"],"sizes":["(max-width:","960px)","100vw,","960px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"Original Fast R-CNN architecture. Source: "},{"type":"element","tagName":"a","properties":{"href":"https://arxiv.org/pdf/1504.08083.pdf","target":"_blank"},"children":[{"type":"text","value":"https://arxiv.org/pdf/1504.08083.pdf"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This is the second part of RoI Series. It doesn’t include an introduction about what RoI is, so if you didn’t read "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://erdem.pl/2020/02/understanding-region-of-interest-ro-i-pooling"},"children":[{"type":"text","value":"the First Part"}]}]},{"type":"text","value":" it might be hard to follow this one."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"why-do-we-want-to-modify-roi-pooling"},"children":[{"type":"element","tagName":"a","properties":{"href":"#why-do-we-want-to-modify-roi-pooling","ariaLabel":"why do we want to modify roi pooling permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Why do we want to modify RoI Pooling?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As you remember from the first part of the series, RoI Pooling has one major problem. It loses a lot of data in the process."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 918px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 99.34640522875817%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAC4jAAAuIwF4pT92AAADKElEQVQ4y42UX0hTcRTHr1o60cwWVkSS+dxTr+W7EEQPhWZRGvUQ0UMPRVK9RBhL5rIoTEQpbTqNihgVZS9ts5atWc39USQ1d+/u3D//bu66fTu/21xOV/qDD+fece6Hc869Oxz352RwqWfpPovIJTLXyPt7ACTjMuTE0tLSXbm5uWfKysoKEzkZy/NWnpycHDlmE3sI9tBWQrkMdr8jze/KRP5OojilWpvNdsjhcLQ5nc4Gio0UUxgaGrqz8jeW53K5NCMjI806na6KNJvlyrKptrGxsXtUPqanpzE/P78u5ubmMDs7yx6DwWBoSXTBWs7gRkdHVeFwGDzPhwnpfwgJ2LXH4wkzeV9fXwO5NjEhzVsW1kejUQiCEKXEeDpIEne73fEJioxfExNxXhCkhYUFmEymO0stpxNiFR4PeK+ICUGAb9CG0PNnCL7vhci7pXnqzGSUhQVrCgUWSeIZHoZ/4Af4QRd8b3oRfN2LgNkC73enFKcZms0fkxUqFIr0QroG73ZTVTx+Wgdg71Bj5v4lhHpuY7rrFoLaW4g+vSk5mzqgb2hLVpifn88lhSRKEdKsEBywwmex4nPnVUy1HoG/pwaBrpPwaqsR0x+T7p+rw8Oa2xr2Xe7dVlyYRSe9kGAzC/W+g0//Ct8eXQZajiLWfRrxzlOIPqkBXlZJnRdVaD3fqCbhLsWGjSco5v27QjePSZcLMy/1eNz9AMffNqHikxaVpnZUGtpRYXsiHb6qw4vqG6zlLXu3FxdmZmZuWGOGHvgFN57r9DhwoQn7r2lxoLYdZVfase+6VjpztgOG2rrkDIuKitLPMAlJedED7+gY/F/t9LYd8Fvt8BFBq0OKiz76bD6kvmX669UvLi6CvvwogVVQtYIoQvBPJuF9kxCDfimKOD6ZzZolYV5eXgY3Pj5eH4vFIIpiemEa2Ei8oleigy/9/erE5uEKCgrkllWRSIS1GCEW1wuJI2wHWCwWFauQ7UelUilvm0a2NQKBgLxx1sPU1BRCoZC8bUh4l4S72fItKSnhOKvVyvZhM+1FNaFZL3a7XU3PPTQajQdJuJEJy8vLud9v5hEImfYHlAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"RoI Pooling loss","title":"RoI Pooling loss","src":"/static/8645b43d389462b34393f75aef05c103/4c275/box-all-losses.png","srcSet":["/static/8645b43d389462b34393f75aef05c103/e4891/box-all-losses.png 240w","/static/8645b43d389462b34393f75aef05c103/0ce91/box-all-losses.png 480w","/static/8645b43d389462b34393f75aef05c103/4c275/box-all-losses.png 918w"],"sizes":["(max-width:","918px)","100vw,","918px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"RoI Pooling losses in quantization (dark and light blue), data gain (green)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Every time it does that, part of the information about the object is missing. That lowers the precision of the whole model and a lot of really smart people thought about it."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"setup"},"children":[{"type":"element","tagName":"a","properties":{"href":"#setup","ariaLabel":"setup permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Setup"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Before we start I need to quickly explain our model."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 48.04785894206549%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACEklEQVQoz12S32vTUBTH+//4T4gvCgrqo4IKPgxfxQcVBz4ovgzspmUylYJOdHPSslHoNtnGkIFudV3LcGlxHXVNatskTfM7N0m/3ntjsuqBG+49Oedzzzn3mxoOhwiCALGxM1vMmD/+F/tHF/UiDMN/clNxwvJqAXPzs3zPgmzbRqfTga7rSfCosXMME6UWSt+/8n2KfYqf8zh/8RQWcjPcqaoqerIK3bBhWU4CIIRgSCHE95MLfh0fYX7hJbZL6xHw4aN7uDV2FlOZayhV87AtAoUCbceH2rcwGJg8UJZlSJKEdrsNoVaD47rY/raF97lX+FLI4GhvOQJeOEMre30HUzNXsLKehecGMEwXpuVTKIHnebyabrcLl0JYm4ZhoF4XMD2dxvibLLaWJtCorkbA8cunMfnkJl7MXUW++AwhHWmnp9O5yGiJIvp9jVcnCAKfqaLIODxs4GdDQO7tBO5mWLvvcFDfjIC3x84h/fw6sos3sLu/AdcJ8LurQxtYEMU2bX/AqyuXd1GjrSqKgspeBfu1Moofn+JDLoudg09otYUI+Dh9Cbm1B+iqDQQ+6Ksa6GsOHMehkvF5EJtbs9mkD2TxKkVRQk9tYW0ji8qPJWi6dCKb2cX78IjFHYZBK9M0nuj7JJGQaZqJ9tieWU85xk61AJeYf2FhBCTESxzsAZjuYn39r71Rc12LyuckN7Y/MMTZVAnWt+kAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Mask R-CNN","title":"Mask R-CNN","src":"/static/29aba251733d6c0528f72869aad393c4/b7c40/mask-rcnn.png","srcSet":["/static/29aba251733d6c0528f72869aad393c4/e4891/mask-rcnn.png 240w","/static/29aba251733d6c0528f72869aad393c4/0ce91/mask-rcnn.png 480w","/static/29aba251733d6c0528f72869aad393c4/b7c40/mask-rcnn.png 960w","/static/29aba251733d6c0528f72869aad393c4/5a2b3/mask-rcnn.png 1440w","/static/29aba251733d6c0528f72869aad393c4/dfb45/mask-rcnn.png 1588w"],"sizes":["(max-width:","960px)","100vw,","960px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"Original Mask R-CNN architecture. Source: "},{"type":"element","tagName":"a","properties":{"href":"https://arxiv.org/pdf/1703.06870.pdf","target":"_blank"},"children":[{"type":"text","value":"https://arxiv.org/pdf/1703.06870.pdf"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 37.22682743029389%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAB/0lEQVQozw3Ky1MSAQDA4b1X1w7ccpymJhtFy0CDJlFBXWMCS1ixFZXXIiz4mNRII1/5QCiSRSWNHKrJonQmvDRd6tCUHTo39a/86jt/QrGYonK4y6u9DIV8gvKbDT4Un1NMrpCbniapdvNOy6CuP6V19Yjq8Arnbw0jip24/R6MbUautBswWM1MJOcRtOU4mfUZQt6O/8HNs9wsm+ksCy4bmSkf0n2F9/kCoUQf3QN2TvlS6EKLZGU7zZ0N1LVcQG+oo8mqx2mtQyiMWrG0GOmTDLTLPh4H7EjmRhxVJ1Btl7kqOpi642J23EkuYsYVTzARD6GFzUTCIh2yhNMt4w24CPrcCN8qW6xpOcLaNj1PtsmnEkwqEhH5Oqt3JRJjMpkHoxyXSxy+3uFtqcDBvJ/Sksr4vQQRJUQ8NsJkNMx4LIrw9cs+P79/5vjHLz5WPrFbLmORzQQjLWgzDmbSMbIvNQ6OjtjbL/P3z29MtbVEggEWHoboaatHEQ30em7S1dqEEFOMjHgaWJ5WyGSXmEvN0yzWU+2UaewdxNZrYXJRxT4coMMhMre1wZlrXfjcdm6PeahyDqHzxjEN+BlsMiJ0+vsxufqI3biEx1vDSExErz+LrsePIKUwDblYSKvkX+ywuabiTj7itGOUtNLNRYsVwRblZFeU4fpz9Nfo+AfHnDyQhGkZ4wAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Mask R-CNN Output","title":"Mask R-CNN Output","src":"/static/3f5fc157d275353710903db3e9176f85/b7c40/mask-rcnn-output.png","srcSet":["/static/3f5fc157d275353710903db3e9176f85/e4891/mask-rcnn-output.png 240w","/static/3f5fc157d275353710903db3e9176f85/0ce91/mask-rcnn-output.png 480w","/static/3f5fc157d275353710903db3e9176f85/b7c40/mask-rcnn-output.png 960w","/static/3f5fc157d275353710903db3e9176f85/0a810/mask-rcnn-output.png 1327w"],"sizes":["(max-width:","960px)","100vw,","960px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"Mask R-CNN output. Source: "},{"type":"element","tagName":"a","properties":{"href":"https://arxiv.org/pdf/1703.06870.pdf","target":"_blank"},"children":[{"type":"text","value":"https://arxiv.org/pdf/1703.06870.pdf"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We’re going to use "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Mask R-CNN"}]},{"type":"text","value":" network for testing. The only reason we’re using it is that this kind of network benefits more from a precise pooling layer, so it’s easier to show a "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"difference between RoI Align and RoI Pooling"}]},{"type":"text","value":". It doesn’t really matter which network we’re using until it does RoI Pooling. Because of that our setup remains the same and looks like that:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 36.26749611197512%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAACCUlEQVQoz2OQlOfl4xPlMBGWZzWU1eWyE1Nms5XRZDeU1eI1llbn4mHAAk6fPs2AE5i6CrnaBYj91zAV+MsjwPZLyZj7l5Q21z8pfc7fIppMpiA1796/6/z48WPemzdvtK5evcoKEtu/b5/SiZMnvdevXx+wb98+nwMHDri3tbYKMPiGqzslFKv/d4sR/2/gKPDfN1rqv7+f6H9TW4H/7CIM+iDNnz59ev4fCH79+vX/y5cvG0BiDx48KPn69ev/x0+e/H316tX/e/fu/d25a5chg52tg29ClO//xlqXfxmVmn+z8hX/xuUY/y8tiPze3pPo++/ff52PHz9cfPLkyf+XL1/+B2q+/PTpU0Ugv/nzly//nz99+uvtgwf/X9y8+W3x3LkWDCGhsf5NRVn/WzMD/iXEev0rzzP7m5Zh/r+syPPbtLlZYd+//rcBGnjp7t27IFf8Bxp0EWiw8aOHDzvfvX///9mjRz9f3br179mVK1/mTJtmxVBbUe00sa3pf1dT3f+C7Nz/CTEh/1PyTf8nFin99wrnhXj586fH/6EA6M0DIDGgwWUg/us3b/5/+fTp/zOgD/YfOGDEUJKX7zRlwpSfc2fP/9bW1PotOzXja3RUyPeYbNMvPonCxkA9DB8+vJ8PDMf2d+/euQC9KwgNQ63Hjx/HAl0a/uTp08i79++Hr127VggAoXUtvSeLXIUAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Mask R-CNN","title":"Mask R-CNN","src":"/static/84ee45d07a675553ef8c8b36381d197a/b7c40/one-cat-mapping.png","srcSet":["/static/84ee45d07a675553ef8c8b36381d197a/e4891/one-cat-mapping.png 240w","/static/84ee45d07a675553ef8c8b36381d197a/0ce91/one-cat-mapping.png 480w","/static/84ee45d07a675553ef8c8b36381d197a/b7c40/one-cat-mapping.png 960w","/static/84ee45d07a675553ef8c8b36381d197a/5a2b3/one-cat-mapping.png 1440w","/static/84ee45d07a675553ef8c8b36381d197a/eff2e/one-cat-mapping.png 1920w","/static/84ee45d07a675553ef8c8b36381d197a/f99da/one-cat-mapping.png 3215w"],"sizes":["(max-width:","960px)","100vw,","960px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"Model feature mapping process"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Our model takes an image input of size "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"512x512x3"}]},{"type":"text","value":" (width x height x RGB) and VGG16 is mapping it into a "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"16x16x512"}]},{"type":"text","value":" feature map. A scale factor is "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"32"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Next, we’re using one of the proposed RoIs ("},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"145x200"}]},{"type":"text","value":" box) and try to map it onto the feature map. Because not all of our object dimensions can be divided by 32, we’re placing RoI not align with our grid."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 878px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 99.31662870159454%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAADC0lEQVQ4y4VU204aURSlIKlCROsTTZrY1ktDqo2ibXzwP/rSH+m39L1vbWIkPBhftCCo8VKDeImhiMyVuXHRBDNkd+2DM4HWy0lWzp4156xZ++w9JxB4ZAwNDb0IhUKfEonEQOCJMTg46MdRYAQY7kGM1wDTwBcgDkTu+OF/MPIMo9fFDNRno9HoZCQSmb7DFM/gJmKx2CvEk728B7yfCofDHyEjBIWuLMu5Wq2W1XXdh6ZpWdM0Rayqas7jDMMQ4BjcL2AP8Tdozc7NzYWEQ2wk27b7YFkWNZtNchynj6vX69RoNETM+9rtNkmSdAiZd8lksnvOcOjChasoioAXw7UfezPcuDqgYA+eb23LJrzLQubt4uKiL8hkH7CYIEiqpolYBXjW4UqHOwW8qutu4/qa129BZmLBE6xWq8SivUAapLEYP0NI1nWq8nx6SsrJCVUvLqhaKrlWpcIf6gp6KT8oCKcsJEPA2N4m6fcR6aurZK2skJ7NUi2TcZubm77gh0Qi/Kigyq7Oz+nP/gFJqRRZP36Snc+Ts7VF5sYGmRBsZzJkrq8Lwa+BQPBBQVkCZxhkHx6StbNDUi5HMtJUcIb8IQnpS4bhOtirp9M5LsooGjwaiQz4guzKB3M4Q7NUolq5TNLGJsnFYrcYvPbqikVdB++UdDoPwZew9xnzwr1V5qqqqKZVKJC5u0sKHKoQ19CHosroAMW23QbW1tbW2OH480DgdTAYHL1fkDluahTD4oPHWdW4EKiycXxM2tERacWi2zo4IDOVEmfo/8tXsH9fypyezq5QmOrZmRDV8AEGO1byebe+v09KoSAE34+NhZ/uQ0Dm9gEkTpOLAkhcGPxJNhobrdXtw6Wlpxvbi+U71+IouMK8R5Jch89TloVgcn7eF+xgYx8g0oFgB03bx+F8Bc8xuFu+JLCG/+U3y8vL3duGbxC+WfgW8cDczc3Nf3yr1aJrpMnv+SbqdDqE62wPMjPj41xojHK5XKxUKn24vLwswkURBevjkI0Ax+AKmMt4/s4px+NxIfgXDCotjyPhruwAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"RoI Placement","title":"RoI Placement","src":"/static/9727b0363fddbe313141b1dbcdffd1ff/97b2d/roi-calculations.png","srcSet":["/static/9727b0363fddbe313141b1dbcdffd1ff/e4891/roi-calculations.png 240w","/static/9727b0363fddbe313141b1dbcdffd1ff/0ce91/roi-calculations.png 480w","/static/9727b0363fddbe313141b1dbcdffd1ff/97b2d/roi-calculations.png 878w"],"sizes":["(max-width:","878px)","100vw,","878px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"RoI placement"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"(9.25,6)"}]},{"type":"text","value":" - top left corner"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"6.25"}]},{"type":"text","value":" - width"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"4.53"}]},{"type":"text","value":" - height"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Once again we’re choosing our pooling layer to have a size of "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"3x3"}]},{"type":"text","value":" so the end result shape is "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"3x3x512"}]},{"type":"text","value":" (That’s just an arbitrary example to make it easier to display on image. Your pooling layer will probably have a different size)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 41.463414634146346%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAC4jAAAuIwF4pT92AAABcklEQVQoz22RvW7CMBDHk35MXTtWlbp0Zuk7VOJFurQPQadOfQpmhk6oEyMIUPgQAgaqOAECsX1OjJBYcj07oQ1VT/rLd5fkl/P/HC4ExtstijBEEQQo1muU7TZCs2lrHgQZZwzFZoNfjFUcijAMz8xZq9WcRqPh1Ot1p1qtuqbnKK1RTSa4G49xN5/jbjbL8+HQ5no6zTQ911T7m40FMsYs8N8AAgK9LMyUlIskQZGmPzlXKiOhGgyQ+b4FIqLjuu4VpXekW9IN6Z50bSeE0QhhtUIJgJIsKEsIkQnOMTHAIDgCL8zp+/6TlHIIAB7l73bCxPNQtVoo4zgHSnkiCySwnbDwUGt9ae1S6hWLoN5H7uFigdDpoIyi0wnLQJqwDDwcDkfg2xGYpulnDtzv7ZUtkLyT5FdZAiAj2SsHBZB+cm7O5XL5wDl/ofo5iqLH36UQUHW7qGg5QB8aqULgeRn0+5j0esjiuFJ4d2YW8zdM7xuXYbc2AHpZMgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"RoI Setup","title":"RoI Setup","src":"/static/2f7592bb906a8e72affefdd02a427f46/b7c40/roi-align-setup.png","srcSet":["/static/2f7592bb906a8e72affefdd02a427f46/e4891/roi-align-setup.png 240w","/static/2f7592bb906a8e72affefdd02a427f46/0ce91/roi-align-setup.png 480w","/static/2f7592bb906a8e72affefdd02a427f46/b7c40/roi-align-setup.png 960w","/static/2f7592bb906a8e72affefdd02a427f46/cad41/roi-align-setup.png 1312w"],"sizes":["(max-width:","960px)","100vw,","960px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"Pooling layer"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Up till this point, everything looks exactly the same as in "},{"type":"element","tagName":"a","properties":{"href":"https://erdem.pl/2020/02/understanding-region-of-interest-ro-i-pooling"},"children":[{"type":"text","value":"Part One"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"introducing-roi-align"},"children":[{"type":"element","tagName":"a","properties":{"href":"#introducing-roi-align","ariaLabel":"introducing roi align permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Introducing RoI Align"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The main difference between RoI Pooling and RoI Align is quantization. "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"RoI Align is not using quantization"}]},{"type":"text","value":" for data pooling. You know that Fast R-CNN is applying quantization twice. First time in the mapping process and the second time during the pooling process."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 39.11785972523499%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAC4jAAAuIwF4pT92AAACCklEQVQoz2NgYGBgBmJWIGYDYgkoDeKz/v//nwEG/v/5z7AtaxvDg8sPwPx1jaUMV2ub4PIPe3shjNu3b4ffu3fv2J07d7bduX179/0H97cD8eEjhw6VgA36/59x5fZNDB0KdgxIgAWZ4ybqwzCxr5uxvzSWkeHZs2e1QE3/X79+/f/Tly//P7z5+P//j7//L9+8vRBmIMKZ75k4ZDUEpRhEpRgCErgYkHwAB48fPy77+PHj/4ePn3x/dvnCn/dren783D/v/7WtK2eAzXj5A+yab1Oeyf+tfLlj98r1R6p/N+69M7H+5K/a5tmGjvLsvNJaAi39c1Xyy0tkGZ4/e1b+48eP/8+evfj1+vC+f5/nRP7+v6Po/605zdO5ZS1ldm/bXr/lwK7+Hem9YbcYsn90JPj853wr8X+3Otv/08AQYwhk4DzLsFhr9bTm//vK3VYyPH36tOwL0KtPnj79/uzJ498vr1388enBnf93zpyeBPbBjdvcy0/t5N4zZ5X+6UkbHm9cs/hj//nJr/fPn/bjzKSp+8G+YFggnBqot6POiKGM4cmTJ3WgMHzz5s3/T58////49RuI+//W3btzkYMGKMQMxMpArArEKkCsBsSye3xmMqKE4f3791UePHgQDIxpnwf37/s+vHfXB4iDLp4/pwc1iGHT0d2MDHjAf6DPt7cmMd6M4GMEAFNcLty1kQiOAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Quantization when mapping","title":"Quantization when mapping","src":"/static/e9c8da71e22237ae31c7e486f538e5ba/b7c40/box-cropped.png","srcSet":["/static/e9c8da71e22237ae31c7e486f538e5ba/e4891/box-cropped.png 240w","/static/e9c8da71e22237ae31c7e486f538e5ba/0ce91/box-cropped.png 480w","/static/e9c8da71e22237ae31c7e486f538e5ba/b7c40/box-cropped.png 960w","/static/e9c8da71e22237ae31c7e486f538e5ba/369ab/box-cropped.png 1383w"],"sizes":["(max-width:","960px)","100vw,","960px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"Quantization when mapping and pooling"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can skip that by dividing original RoI into 9 equal size boxes and applying bilinear interpolation inside every one of them. Let’s define boxes then:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 734px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 74.52316076294278%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAC4jAAAuIwF4pT92AAADJUlEQVQ4y1VU23ITRxDd/3/IDyRFVULBuwOJAYNkbEtVBuyAZLCRLZUs7WV2Lruzs1dJrj05oxAKHramq1vdfbrPaQXr9RpZlsG/UkkIfmEcweT0RSFkZpCuVkjGY+THxwjfv4d2DokQiJOEv8v5u6i3RYEkSUzgi203G+QMbFyL1jg4YfDgGhSJpq9DyWbu2TPsDg6Qj0ZomgZOSlh+HQuZOO53bQtXVSbYI6QzvJ3h7uAX3J39gdngEe5HT3E9+BXz4W8oT05hR2O0FxfIT07QnJ2hfPsWxXCIlg3y4bDfvnkDOZmYQMoU7fYByewKi5PfoTqDaTTAqpggVit8lH9BZSGsztDWFTRRNVWFwlrknK6lzRX0uy9fYM/PTZCmAnW3RTSbQowPUbWATFPUVQ2ranxOj3EjzmF0jrIqIRhz3KFhMaU1StrC2r67vkb+7p0JwnAN6yrcf77E/PgpYiuxXN8iNRGW4RwX4d8IxRIiEdxzhjAMYQyJYmGSgIx2qFRfTSZQ47EJfHADwCzukJ79iaSLsZY30PUa9+oGwi1Qlg6WI2423b5Y6wlw//k62qau+4fbW5SXlyRlueTCR4j++Qg7PIUqKiTrBDZziEMi0BapSBFF0Xd5aY4qvGzimKvQWEnZl58+QY5GJlAcYfv4MczVFSpqrSAKTS02TQ3FtyxLFIXdI/NyUUqhIhEenW/gCVIkZfv1K4oPH0wg2Lk5PIRkB0c5ZEyS7O4LeRQFJeUTpZQ/+XwDX9zRFnnet2Q58yz7USxhJ0RoeQmKSYn3EYGP+URfzBPgxf//6J4UX9xLJ9S6r6ZT6B9JyeZztBy52u2Qs8Gm6/YMNnW9l4ZlsT0BjLX+Uohs76NtyrJ/mM2+keIvhQkRO2SDAQR3EnLZ/nrWfBURCI4WEY355tMslNAXE6W/5ZUxvaNs5OkpSfHK326hFws0T56g4tj2xQt0fHO+DZuUr1+jePkSrfdx3w1Prjw6QvHqFVra+dFRv3v+HHY6NYGXgNeV5nh+NEdEhp1b7lITVcVdFoxlbNwy7n01kRbMy4my8b4k6TeswX8c8y/qzlAeKSTyFQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Define one box","title":"Define one box","src":"/static/30fac7257db220c26312628932ca4a7d/e804f/roi-align-box-size.png","srcSet":["/static/30fac7257db220c26312628932ca4a7d/e4891/roi-align-box-size.png 240w","/static/30fac7257db220c26312628932ca4a7d/0ce91/roi-align-box-size.png 480w","/static/30fac7257db220c26312628932ca4a7d/e804f/roi-align-box-size.png 734w"],"sizes":["(max-width:","734px)","100vw,","734px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"RoI Box size"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Each box size is determined by the size of the mapped RoI and the size of the pooling layer. We’re using a "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"3x3"}]},{"type":"text","value":" pooling layer so we have to divide mapped RoI ("},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"6.25x4.53"}]},{"type":"text","value":") by 3. That gives us a box with a height of "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"1.51"}]},{"type":"text","value":" and a width of "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"2.08"}]},{"type":"text","value":" (I’m rounding values here to make it easier). Now we can put our boxes into mapped RoI:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 47.98245614035088%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAC4jAAAuIwF4pT92AAACPElEQVQoz22SS2sTYRSG01JURPwP7X9QF4KbdiVdZqWCLko3XfpLXLryR4hovRTUYBptimlz68w3k7lkLt9tLkkakynyeiapINQDL2dm4Dzf+71zKlIp6HwMleZIyp5PoJmNZP8DtGkhOZ9BJRlkkhWgchznSYXKMIy1lZWVypWSgQ/e/ATRrkN3DhGdfoZoHkB9eQN+fADerUGcfgNvfS1+xwyu5y+AxP4PjUqwHkICJIIjjyN43k/IyEUqJeLQQhh0kYYhdDQsZl4Lnm0+vhy9TbpBuka6Trq1sbGxWuG2Ab9TA88TuraCLXqIVEBXVAiUC08zCE3whBfTuIfAtR/R8Gq1Wr23u7u7ube3d39nZ2drfX39Dn2/WVGsD6fzEWHm0ZALkzcxVAyx9uGpPgaqRQc4GGqbgCfwbetZaW8+n78oM724uMgu++Yyw3evEZknyLJzjNMJhtyGUhp5MoFQnMBDZHqMJBkX88jAgPWflnNpmr4sQdPpdFb2IAgeLjNs1MA678kNw1Ca6IV1DOIOfGHCilvk+Ag+N+DwfjEKjuFZbOEwy7JXJagoFj8fcRxvL4EDA0GvAT05RzYawS0zSyWt0AhRGiGgKHSWQ+Z5MSvB7GzhUAjxnFw2CLxPanied3cB5JShX38L4VpQAxMDo47IakPaJgLWgs9+QLIzxKxX/LKbcCxzsTbbWw+ubAwZJetKQrYbkN3v0P0jCNpF2Vm+l1116bl9CNGqFUhjRFz83cO1EvCvyvoDAes6Wgb7HtgAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"RoI divided","title":"RoI divided","src":"/static/ee8e78b572d14b0ebd98ff08e2c5852b/b7c40/roi-align-divided.png","srcSet":["/static/ee8e78b572d14b0ebd98ff08e2c5852b/e4891/roi-align-divided.png 240w","/static/ee8e78b572d14b0ebd98ff08e2c5852b/0ce91/roi-align-divided.png 480w","/static/ee8e78b572d14b0ebd98ff08e2c5852b/b7c40/roi-align-divided.png 960w","/static/ee8e78b572d14b0ebd98ff08e2c5852b/64481/roi-align-divided.png 1140w"],"sizes":["(max-width:","960px)","100vw,","960px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"RoI divided into boxes"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you look at the first box (top left), you can notice that it covers six different grid cells. To extract value for the pooling layer we have to sample some data from it. To sample data we have to create "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"four sampling points"}]},{"type":"text","value":" inside that box."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 74.85148514851485%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAC4jAAAuIwF4pT92AAADCklEQVQ4y0VUa3PbNhDU//8t/dKZTqdua8dx6jRNFFmWlVi23hIJEG8QJEUqzsx2aTnxBww4C+Dudm+Pg6IoEGNEvztnYbkKVSDEcMK8g7UWSiuE4H9ixhoopV7vOQfvPQZ9sK7rEMsS7eGIQ90gxYRje0QKxOoWzaFD9eEjns7+QpkJtO03NOn1Xtnfazq03RGD5wpTQpHtIP87g7j9B/nnS5i7a+yGl8jHf0PdvoX8cAY3PIccXkBOuMZvIG/ewk6vIW6uoD6ewS6mGPQ0D4xsshV2N5e4FxX2QmCvPO43Giv1FcELUtKo6gBnFAo3h3FbeKtQlZYSGLjtF5j5CINen6btoPdrmPtPCPV3Pg4oqw7eVSjilnJE6pfQNC2DJ+iSCaJBDNUJKxsEsYVd3Z0ol1WNYjPHYvQGk9xjSfrLQmO8yvEgpyjsDkLtYUMBUWTYmhkyvYRUGawnZgTEZgL5OMQghIDjE6uSO2Rfz6EPBXK3hK0zCLfBOowh4wrSr39iuzhFFh4gw+aExT1ENoJdj1khKVfzBdQFGzIbkl4DzepKdtBSx8wsaBsDo90zZpSDsBsoI2G1P2E2wmwXKB6ooasSOgZ0f/wGvRyjbnrtHLWhLr5kFWsm8fyOxA7Pu2ZFLmpqWKKhzUKs4PMVNZy8NIXC6vUjivtrxAMzOonUBOqjSW0GyyYYalU2NLSjZnFxCho0Uu15bmHyGQwLGig2JTGLZMn76TlMoygys1U5pN1i5cbI/QK5XcGkPXKebfwdMv8ISevYlEOEXsMbFPMfTfn2BNe3ffaJnvyOkrQ6TkeiLXS5Q0olp6JC154wlwStYk/YoUXJqSn5PmymL7ZJNQQpi+l7BGqojEWklbQN2PklTLD89sSq5z0PWxSUwLh4wuhRvV9APnzuJ8XhwMw23yG/+gWKQfPRBcwXjtToEtvJ70x0xZG8ovH/Rc59f/cnMo6k4OiZKUf19h3E+1/JkJT7P0Tb0u2kXgWHZDW8EmiigysEKm9Ruh6TxPwrZn9gL/ecQcNq/wfjEViid1m1GAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Sampling points","title":"Sampling points","src":"/static/3342f95267a184d134d7c20a96e48ad2/b7c40/roi-align-standard-distribution.png","srcSet":["/static/3342f95267a184d134d7c20a96e48ad2/e4891/roi-align-standard-distribution.png 240w","/static/3342f95267a184d134d7c20a96e48ad2/0ce91/roi-align-standard-distribution.png 480w","/static/3342f95267a184d134d7c20a96e48ad2/b7c40/roi-align-standard-distribution.png 960w","/static/3342f95267a184d134d7c20a96e48ad2/2bb2b/roi-align-standard-distribution.png 1010w"],"sizes":["(max-width:","960px)","100vw,","960px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"Sampling points distribution"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can calculate where each of those points should be by "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"dividing height and width of the box by 3"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In our case we’re calculating first point (top left) coordinates like this:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"X = X_box + (width/3) * 1 = 9.94"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Y = Y_box + (height/3) * 1 = 6.50"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To calculate the second point (bottom left) we have to change only the Y:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"X = X_box + (width/3) * 1 = 9.94"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Y = Y_box + (height/3) * 2 = 7.01"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now when we have all the points we can apply bilinear interpolation to sample data for this box. Bilinear interpolation is usually used in image processing to sample colors and its equation looks like this:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"src":"/f44e8b1ffd03a42ff6653978338af561/equation.svg","alt":"Bilinear Interpolation equation"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"Bilinear Interpolation equation"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Instead of trying to understand this equation please take a look on a graphical interpretation of how it works:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 71.42857142857143%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAC4jAAAuIwF4pT92AAACwElEQVQ4y1VT2W4bRxDk//9MHnPADpIYlmVSZiRDFCleyyWXO/e1ByUbQco1QyFAHho93TPbW11dPdFaI6WE7KWUOJ/PxZRS8M6haZpyF7xHKwQE8zknpYAxBm3blu8c38YYMfF8OI4jsrfWlkvjPELsELse2ji4ENENI0zLIicWUxo+dfAxlbfWB6R+wMA6pWDXdaXg5XIpSAZPdLJG7wQ63SKKE5JTiB//wOu7n+GPOwyM3fmAMedVgyCOGBIRZtghBMLXBYWsd2h+/wlqPoO8u4F+nKL++hvk4w3U4jP005Tn27fcJ+jFLe0zxMMHyPu/rgj7vr8ifPkG3VSob/loPkAuLVsfcXA7GP7Up54+Fl+ZLTwpMZ5xx7fWoV18wqQQzsfZd/mi3kA93MHULNCwoA44yjUHZOGMRUferLJo7Q6aXCbGnsUc+VfLKSZ5wnkoeUKv//zLj86o7t6h1Sec6jVaIl6rGRq7Qev29Lvin9UUrWdMpK1nV/oZYnlzRZjloWh9dYC6+RNiP4fyBi5qTtiikk/QTkJpiZAcpyxwcmtKiMOIDtoqmiRFt5jkdguHw4DXXQX3/hccFjNq8wItSYeLOKptkVQgX0Znn1C1K8RwjSNjKRXaxzcO80CKwDllcdigeSbKRHHHGjqesDVztrXDma2qVJe2K39fYtNRl6EubYvlxyvCgeiyf3n9DkttNZRIJGrLVkLwaNyGIjb8sYUnBdkf9eq/c4iedAjIJ7acVyYPJk9puLxAnfZol18Qhm9lE2Ia0fgDQhY/tyf13KrQkUPSw/uQhmKG2yLzlDM3ecKWAu/HC2WzxXn6KxS9Oaxoa+w3FPVhCVWtYI8byP0KdUUx7xawlJlmXvIsv374v7BHrp7TCnIxhXr+G/rNxGoGtbmHXDPePkAwJ9dfIFdz6PU9FPPiaYbQ7PED2s4MpwckuzUAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"First dot interpolation","title":"First dot interpolation","src":"/static/2ca4fe8bcefbad8d321fcae5b8992d79/b7c40/roi-align-first-dot.png","srcSet":["/static/2ca4fe8bcefbad8d321fcae5b8992d79/e4891/roi-align-first-dot.png 240w","/static/2ca4fe8bcefbad8d321fcae5b8992d79/0ce91/roi-align-first-dot.png 480w","/static/2ca4fe8bcefbad8d321fcae5b8992d79/b7c40/roi-align-first-dot.png 960w","/static/2ca4fe8bcefbad8d321fcae5b8992d79/7cbef/roi-align-first-dot.png 1134w"],"sizes":["(max-width:","960px)","100vw,","960px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"Bilinear Interpolation for the first point"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When you take the first point from our box, you’re connecting it with closest neighboring cells (exactly to the middle), unless it’s already taken. In this case, our point has coordinates "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"(9.44, 6.50)"}]},{"type":"text","value":". Closest middle of the cell in top-left direction is "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"(9.50, 6.50)"}]},{"type":"text","value":" (it would be (9.50, 5.50) if our point was only 0.01 higher on the grid). Then we have to select a bottom-left point and the closest one is "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"(9.50, 7.50)"}]},{"type":"text","value":". Following the same rule, we’re selecting "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"(10.50, 6.50)"}]},{"type":"text","value":" and "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"(10.50, 7.50)"}]},{"type":"text","value":" as top-right and bottom-right points. Above the RoI, you could see the whole calculation to get the value for the first point (0.14)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 80.37848605577689%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAC4jAAAuIwF4pT92AAADO0lEQVQ4y1VUa1fbRhT0//8j/d7HSdNS4oSQEMAhxhhq2dZzpdW+tHrYloGeMx0J2qYf9mg1e1f3zp25mlhrsd/vUVUV2rYdV+Xc/7CmaeC5HzDHs67rRqz6DhviBnxSluX4IqVEHEcQQiCKImitoZQa92mawNd+jBnehcgQMdaY72NSfthiUtc1jscelffo9j2z7OF9i8PhkR8Zsh7Qcd9ezXB88xY+Fdj1T+jaPavs0PePvNtgx7uH4+NLhQ0rLPMM5voEdnmO8tsUXXABPZ9C353CLD5AXvwGPzuFvD6FWkyhbqcob6bw958hb97DzE7g1nNMhjIPzGLzGNvzn2AzBRUnuLxY4e5G4PLrFZJoC2cK5CKCNyXC5AZ5sYIrc+TxBt5ppPfXSJlgMorSH2FEDLm8QLt7RllUuFvWCFYNMhvDN35sw9CO2ncofQ5b63HfDi1qKEyRQQdfXyl3O8h4jXT+DqZ1yIoYwVZgFWSYk8Y2jZBLXnAFZCkQqwdkejPutS1QaFYf3yEn/YmnGMfnv1ANgbdvoQ+SwWsEaYDcxVgkV9iQXm5DpDpgdQnWaobELlE4qqtWkM2g+iWKPz+xQlLuNiHK6e8ogxkFOsAoQ5UPsKqCrEKqaGE1vbkbzhxUNVQriVUvmPGoihRqNaMoXYt+FcD/+jM23854uYU1Bnmeo6k7RPIBxio4Sx8WEg3P4yKA1BkHwKMoCtTtDmLzALFghdYNk8IsESnefYDfN2NffMuqKoPUPUBTBONKYoZPBVGtST3luX6Jqy10HkAFV5iof0RJQ4Q3b9iPHJlas38hchNhrWkHu0KiAgi7GcUYehibJYQO2ccQwiVIkhmy5cdXUZ6e4SlKcv2ONujpqwpaaexoh9xuOZo16qqhF92ICRWOig/0rTa0Uw9JhsX9l/9sUxAoH76gPjyRMi8O3rQ1hOfM1o5UOZqHnmceJVmoWhGrX7AhmRKkfE1RXo1taczwjx+Y5QJi/p6L47Y4x2b+C8TyjP09R7Y4Q7H8jC3tldyeIL/9OMYNWPLpR0juJ8MvqO9Jk9QbRRpSwIkEHc3qOD0Nx2tY1YjJ8WzEGFf9G0eMBe34R/obp6icfeKiGXIAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Second dot interpolation","title":"Second dot interpolation","src":"/static/738e022f9e765dcded86cbb28c0d37a5/b7c40/roi-align-second-dot.png","srcSet":["/static/738e022f9e765dcded86cbb28c0d37a5/e4891/roi-align-second-dot.png 240w","/static/738e022f9e765dcded86cbb28c0d37a5/0ce91/roi-align-second-dot.png 480w","/static/738e022f9e765dcded86cbb28c0d37a5/b7c40/roi-align-second-dot.png 960w","/static/738e022f9e765dcded86cbb28c0d37a5/a505c/roi-align-second-dot.png 1004w"],"sizes":["(max-width:","960px)","100vw,","960px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"Bilinear Interpolation for the second point"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This time we’re interpolating from:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"top-left: (10.50, 6.50)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"bottom-left: (10.50, 7.50)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"top-right: (11.50, 6.50)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"bottom-right: (11.50, 7.50)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You should start seeing a pattern here :). Here are the other points:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 79.8611111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAC4jAAAuIwF4pT92AAADR0lEQVQ4y1VUy3LbRhDk//9HKhdfUkkclV2SGcWxZJkULYmiKEIEQbz2vYsXCZV8aDcgO1U5bGHQO7uY6e7BxBiDruvgnENdVeMa4rZt4b1HXdeoiAXG7c+8H9gQD2ettWiINU2DiVJqPCylRJqmSLMMyT5BKQR8CGOc5RkcL5SiHPf3Y16KoiyhrcEuScY4VAGTwEN93/OlwqE74lA1qF3AM+Pheaw7dO0B7adLfHt7gipJcex6dKFB4yv03Kusx6HpcDz2mAyV1SxV5ink1Qn08iPK6zNUDxcQ11OI21Po23PIz+8QhvfZGdTdFPKGa/E3/OoCJZ9m9g42usXEe4f++QW+THEz/RVlViJLNrhd3cNqj225gNQprNMoZIYQLOLiDqWOyZ1CUSQIdcB+PUe+/BcTYzS6wxEqjSHuLpCRp2i74gUVvG1R2Jj8OcYUrKZQtoZwKbSX8K6miA25bmGzGGpzjYnWFIUXynSL6MufWOdLLNYfsc1XKFnRTi8hbAqhcxgvWG2BvVkjN9sx1k5wX6JI7iAev7yK8vzyDV5kiK5/h2xzFOYJsbyH8Ake1RUytxkrTfUGMuwRqTn2lh90O6RqA1FniONLiM1nikIPtdET5OkJVLSgQD2MMqOSRnkeGlq2I5+DC4xyUD5jZfIVo8rGBHhyqYeWHRXueWF4/xZPX8/JRwNLsxdFQX5a7MQDDAVxtIagNwfOkvIR0uTkMKCk/+rmgGyzRHHPCgeXHw49dBKhWJ4jHGqalSZtWJXXSN0DdHjlyjdmrCz3Q+tU3qsxz1QWOl9DR3NOyuBDli32W8TXf5GPApmKRs4KkyDSM2T2kVxFyO0TMv2ESM6RmBX3Y5RDnk+R7K6Q05P/iRKo6H4+RdM+I7A9oznj9YEXbzmjnF1fj20PWK5i0sD2/UAPNSDfYruGWM9+TErbodiRl9UlquMLW2YSx0jbgDzsYILjBeEVowCizqGCIlYRO9KT/JjY04ds2TmLY/8MW9Jz73+BuDlHPjsd1zB629lvyL+eoVhMkXEkSwoXz/9AOj9BOf8w5pU3/2A/fQN592kYPf/6c2DrDSeipqJeC3SVg1OCmCVmRqwdMP0T+3/ekNO1Db4D+lCcsNh7vaMAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Third dot interpolation","title":"Third dot interpolation","src":"/static/bdfccd5f0e581b14843c24a1a247a3ae/b7c40/roi-align-third-dot.png","srcSet":["/static/bdfccd5f0e581b14843c24a1a247a3ae/e4891/roi-align-third-dot.png 240w","/static/bdfccd5f0e581b14843c24a1a247a3ae/0ce91/roi-align-third-dot.png 480w","/static/bdfccd5f0e581b14843c24a1a247a3ae/b7c40/roi-align-third-dot.png 960w","/static/bdfccd5f0e581b14843c24a1a247a3ae/b2e88/roi-align-third-dot.png 1008w"],"sizes":["(max-width:","960px)","100vw,","960px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"Bilinear Interpolation for the third point"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"top-left: (9.50, 6.50)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"bottom-left: (9.50, 7.50)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"top-right: (10.50, 6.50)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"bottom-right: (10.50, 7.50)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 78.67063492063492%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAC4jAAAuIwF4pT92AAADQklEQVQ4yy1U2W4bRxDk//9IAuQpBgLYOeyYEiU7OixSFCVSFLn33MdelGgjqNQu8yDMqLq3p7u6ihNjDJqmgVIK1trxT1QVmrqG1gpD3BHzIcCPmIb9H6uY13UdpBAwxANzJs45xBhRliUEi0pjkTPRRX7sPSpildLw1sEypyyYx4KSBTP+3/QHCG1QSn7LopOho77vYVm4H7otcsQ8w0FJhDRBz9d7dhrPz3D8+SfEmyu0jPV8NGQpXrUcz7YscPDsUEqJum0h0h3U1Qfo1SXE/Rn8+iuq+RTV6hP04wzV3We4p68Qi3PI5RmK5R8Q87MRG2Lm4QLq5k9MhrmPP/6FK16wX0zhwhE2q7BZJ1Chxz65hSwTBHJVWo3IaUTQ2LkN7weURjHWwLCp3VBwILk7vELsntjdFYyLkNst/PUd1MMaQmwQjIbTDl3TkUsux3Mhdkc8jpjTlos9QC0vMBm22w7EsmB6/wllKLHbfkM2v0S2ucP6eYpsP0cudijUDqVKkMoNNuKa9xQ5sVy+sPsMybffMfHc5BtHtgU/ePgbpjfc6pab3EHGAi/FP6j0BtJl7Io0+ByF3eLF3PJeENtDuGTMzRYcWXDLzeMTxK+/cNQ76q2jpgZtdlBCo/IJeXVQ0qAlZhS16sxY1Cg3YoqSiXUHsZyxQ5J5THP49++QLr+wYIvgPMUt0cQWmXomZw4171Ko8VSUUarWqJkrh2Ihwvka6c3HE4eDOKvtCsXqM3SnIDiaqSlgmyLxC4i45zb30HWOiuOVnopwc9KQwzQlKsZMKyklFjRm2PIbZLIhMIVtOZ4rYIKgUyrk4RGa/ChXQodqxITjQ24J4yVslGPMNhr54uPJeq/H7zDZFuntdBzZ0X5SSEQfT/IIljQEaFqw5mhKCW76CdHRnhx5oMhSTunNX3QKrVW3PYrnJdT6GuH1B18OaF+PfJkerzO4JkK7AXtjrIatA4pIWnwzYsp61IfvkKuLk2yGDl2VoZy9g3y4HC0lB4stZpTCBybOaLcLWnI2xitaL52/H+Py/vyUy1j15bdTwcPhwE0GRM1fmXJPTe4RJQnPd+MZFe/U6XBaxr1IEcUpXqvT6asEDa35H2FCnCQ5rvK7AAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Fourth dot interpolation","title":"Fourth dot interpolation","src":"/static/30a1be50f06203fb347ecc08b30f4c06/b7c40/roi-align-fourth-dot.png","srcSet":["/static/30a1be50f06203fb347ecc08b30f4c06/e4891/roi-align-fourth-dot.png 240w","/static/30a1be50f06203fb347ecc08b30f4c06/0ce91/roi-align-fourth-dot.png 480w","/static/30a1be50f06203fb347ecc08b30f4c06/b7c40/roi-align-fourth-dot.png 960w","/static/30a1be50f06203fb347ecc08b30f4c06/b2e88/roi-align-fourth-dot.png 1008w"],"sizes":["(max-width:","960px)","100vw,","960px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"Bilinear Interpolation for the fourth point"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"top-left: (10.50, 6.50)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"bottom-left: (10.50, 7.50)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"top-right: (11.50, 6.50)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"bottom-right: (11.50, 7.50)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we have all the points calculated and can apply "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Max Pooling"}]},{"type":"text","value":" on them (it could be Avg Pooling if you want):"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 50.67204301075269%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAC4jAAAuIwF4pT92AAACTElEQVQoz22Sy27TUBCGjbLgEdi0EhtWbHkJhAQ7WCGxYcGjFFiwaReookLqI6BWogVUJFC5pKRt6qZt7Njx9fhc7DixE58o/IzdSmw6mznXX98/M0ZZFMjzHONyhrwoUUzrPEU+KVC4Q+Rphsm0au7ySalBobLRS4MCC7TybtcoTdMoKVeuaxi1mOQJeK8N0T+CtLpgFwfgZwdIv2yBH++DWx2Ii0Pwi0P9VwwR9c1G8NoYE4mIffid7xBBhMjx4PunSEIXUnAksYsg6EGEIb0L5zpLYP/YXiHQm7D7t8neMrReprw0c5wlI59MIFiEgKhilUAyBo9bYDKCVBKxDBFIB0IJJKmcz6scg/buCtLpvd721otP6+tPP6ytPfu6uflcD4dPjIJqmHoOgv5PsCykTwEcfoJA2GCKyIUFV5iIhYdIeXo2S+D83nlVu1t9/+5Ou9N5c3p+/nZ3b+/xpWWloPY+IzAPoNQYiqcIkyE451BiRDlp9pLOpRzpeTGB/evj6/qv4skjXMW0LDcuBcdk+YqQ5zFkFmEoT4lmAE7EobLhqzPwlOizUM+1hNPeaQRFwu5XVdUIZlm2+r8pjOp09gcyH1GtJIm4EBmHTFOyHVMNaU9ORJbqaprXhE2XA8e6JYR4IKV8yBi72wjmNWHkITj6VncRMvTheSdgwYDWAeLAoq6bNAEeeOhrnTEM9rdXrpuYxWJhGGU5xYioOBEK+wTSNsFo7rjdhRiYTU7sIwiaT24d6wU1itm9hnAWD1pE2CLCFhHeqM/+AR1icdINqPjuAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"First Box Pooling","title":"First Box Pooling","src":"/static/3a43f0b9d96c7bba35d4b8e3b5c9e07e/b7c40/roi-align-first-box.png","srcSet":["/static/3a43f0b9d96c7bba35d4b8e3b5c9e07e/e4891/roi-align-first-box.png 240w","/static/3a43f0b9d96c7bba35d4b8e3b5c9e07e/0ce91/roi-align-first-box.png 480w","/static/3a43f0b9d96c7bba35d4b8e3b5c9e07e/b7c40/roi-align-first-box.png 960w","/static/3a43f0b9d96c7bba35d4b8e3b5c9e07e/5a2b3/roi-align-first-box.png 1440w","/static/3a43f0b9d96c7bba35d4b8e3b5c9e07e/717b2/roi-align-first-box.png 1488w"],"sizes":["(max-width:","960px)","100vw,","960px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"First Box Pooling"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"I’m not going to show you all interpolations because it would take to long and you probably know how to do them already. I’m going to show you how the whole process works for pooling data from this RoI using RoIAlign:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"src":"/e4f0fc7303311b463badff2fc95ccf30/roi-align.gif","alt":"RoIAlign Process"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"RoIAlign pooling process (open image in new tab to check all calculations)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And ofc. this process goes for every layer there is so end result contains 512 layers (the same as feature map input)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 445px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 104.26966292134831%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAADjklEQVQ4y7VUS09TQRi9bUFZdEFCYKEbkyaCRoWFiWJ0YUJ8dOGixsT4D9wZd/4EYCElBFsTAgkLNgRYsSA0tPJ+tbzfbyjl/X72XmY8Z7i3lKhLJzmZr3NnzpzvfN9U064PB2BLii1Yw27i36OpqUkrKChQJA6Hw2Wz2T4Cz4GnwFvgE/Aanz0m3gPvgDdJl18f7e3tak5NTc3A4VwgB+S37XZ7JuI7iHPT0tKyseUW8Bj4AGRr/2lcVxkOhz9PTU2FJycnA5FIJAT8mpiY4BwaGBgIYp1za3V1dR73u91uJ6b8lJSUv6c7MjLiFULI1dVVubW1JZeWluTa2prc3t6WKysrMhqNyoODAzk6Orra3NycwzPp6elPMN0zKR4BGckKC3d3d+X09PQZ1BhjY2NGf3+/mvkbSo3BwcHz5eVlifVYWVnZfZ7LzMy8i+kh8Mr09YYi7OjoKKayhYWFOAjk+Pg41ci+vj4J9QJrAkQSaetUj/VYUVFRnknKwjwDXgAvVUsNDQ0Vb2xsSPgYp4q5uTm5uLioAC/5W4BImLFOK4aHh6OlpaVMVcvKyqIN+cBNpZCEh4eHEinGZ2dnJVWCXHk5Pz+vFM/MzAhcIBjDGp0ZgTRWVVX1gBxOp5N+uhIp81amTBVIUymjQqolKddwiUAsaAe+6ywcxMQaGhqUUlTdrYoDfwpjsRhvjjM10y9FyArv7+/Lzc1NSTsQC4IxVMYvLi6ovtUqsMvlsrFtvpspn1MRlaDy3KgUUhGUKHIq7+7uVp6yC6gSa20k83g8l6yBQODrzs4OFenwSKXEyvIwSY6Pj+X6+rpk4XgxFYNIoNUMiYFzSiFCrb6+/vLptLS0/OAB3MweVKQsAq04OzuTe3t7qvFJfnR0pGKsGXwQ2NdmEfb09Fy9mFAo5GP1aHhvb69gxa3KdnZ2KhLawPTZAbDGMLsiQYi9mlZRUZF4k6j4Tz43fNDhEVtFpUcvqZae0QYTBq0CaYIQxbwkqqmpSZDCUx9J6SlsEPTp9PRU0EfDMCTTJPHJyYnyEMQJQmSmaXV1dYqosrLSlvSn66enIDVgQRze6DioIz0db1tH2+hI/xxZsAtCPKPruoZY0/x+vxYMBv8ghdJyFoCqmBoOqAKxMNZsVjliKcQFV0Wpra1Vs8/ns0jtXV1d33CgHE1fgt704qV48aK8jFGUEnz7gT+LLxZhY2Oj9hsd3JRi9YcoNgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"RoIAlign Full Size","title":"RoIAlign Full Size","src":"/static/62876dcafd909f58db894bafc86a2e4b/970e5/roi-align-full.png","srcSet":["/static/62876dcafd909f58db894bafc86a2e4b/e4891/roi-align-full.png 240w","/static/62876dcafd909f58db894bafc86a2e4b/970e5/roi-align-full.png 445w"],"sizes":["(max-width:","445px)","100vw,","445px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"RoIAlign full size"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Notice that even if we’re not placing our sampling points inside all cells from the feature map, we’re extracting data from them by bilinear interpolation."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In this case, cells 11x6, 11x7, 11x8, 11x9, 11x10, 13x6, 13x7, 13x8, 13x9, 13x10, 15x6, 15x7, 15x8, 15x9, 15x10 will never have any points in it. If you look on second point calculation (first box), it still uses cells 11x6 and 11x7 for bilinear interpolation even if the point is in cell 10x6."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you compare data lost/data gain from RoIAlign and RoIPooling you should see that RoIAlign uses the whole area to pool data from:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 44.3089430894309%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAC4jAAAuIwF4pT92AAAB4UlEQVQoz3WRzWsTQRiHt/UTDwpe/Q/8bzx58C6IBy8KKr1VEZQoPSgVlZaktU1TUEGjOVSLAU2ysws26QbzRSC7s7NJTPawm+wyW3/OrLEfWl94eWeGZx7ed0ZRDsaZv/YKAOU/cUrkyX9Oi8ViUtO0JCEkqapqiqhqkqilBV3TMmvp9JWJdFrWQqFwQ3AZwS9IVi2VUhohi7qur+RyuYRAjim+7yMMQwRB8LtyDi8MIINo2upEeERWxthneR7fEbxkR+NxzDaazY5AjiumaXLbtuOkcv29xpmqjf1WG+TT5rP9QsG+dV0Xgg2o5Jstbue/hEP9G+q1elkg0xICs22wbhdWtQozcw/e+i2O7B28S1x6ISHUirHQsqz3nueBOYzbzTboqzkgfS3Chxls3H+4LZDTu0Kn3wPbKqO1eBnu0gW+s3oRyzfPyw7PYu3R0T9CXwhp1+FupYr8UgIPXt6O5t/MYubqbEUg5/Y6dLpwGg2Qjaf4mr3LjfwcVlLX5ycjT+3vUD5Pr+dA1w08z5JoeXMbr9c/GnsjMyaheGz6YwCzP+T+DmDUW48PEwpevjn6YqqR249+Bj46nbYR//IBoUxKZfJgNEKlvPVEQFOHdRjfoTYsSqPBYIiqCIGc+AW8odHiYdScQgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"RoIAlign comparison","title":"RoIAlign comparison","src":"/static/80924c25532827aafc07e380b1f31b56/b7c40/roi-comparison.png","srcSet":["/static/80924c25532827aafc07e380b1f31b56/e4891/roi-comparison.png 240w","/static/80924c25532827aafc07e380b1f31b56/0ce91/roi-comparison.png 480w","/static/80924c25532827aafc07e380b1f31b56/b7c40/roi-comparison.png 960w","/static/80924c25532827aafc07e380b1f31b56/5a2b3/roi-comparison.png 1440w","/static/80924c25532827aafc07e380b1f31b56/eff2e/roi-comparison.png 1920w","/static/80924c25532827aafc07e380b1f31b56/6a172/roi-comparison.png 1968w"],"sizes":["(max-width:","960px)","100vw,","960px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"Comparing RoIAlign(left) and RoIPooling(right) data sources."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"green means additional data used for pooling."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"blue (both shades) means data lost when pooling."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"roiwarp---meet-me-in-the-middle"},"children":[{"type":"element","tagName":"a","properties":{"href":"#roiwarp---meet-me-in-the-middle","ariaLabel":"roiwarp   meet me in the middle permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"RoIWarp - meet me in the middle"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There is a third method of pooling data that was introduced in "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://arxiv.org/pdf/1512.04412.pdf"},"children":[{"type":"text","value":"Instance-aware semantic segmentation via multi-task network cascades"}]}]},{"type":"text","value":" and it’s called "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"RoIWarp"}]},{"type":"text","value":". The idea of RoIWarp is more or less the same as RoIAlign, the only difference is that "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"RoIWarp is quantizing RoI mapping onto a feature map"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 786px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 66.2849872773537%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADL0lEQVQ4y52Sy28bVRTGbxweIqpUVuwQYlXW7JBoKpU/gAV7FohWXXRZtamgUhcRoEq0RZSHIiJSb2gruY9EhdDEiZ3YQGySuI5NYnv8fsyM545n5s6948n4zpzeTEREkdjwSaMz+ubcn75z5qL11Cr6p/ahGMnUF8YB7Mi5U2+80DaNmX42u67NP/pFSyTSTcv8/KCPgjyekxcjRfNJZJfEI6vqN2NHkM9+io7LieR1Lb1xE/1L+u/ZEiyvgHsvBlDchf7m0yX0H+qx3cOX2xcejrXiTy6UN+cf/GbMvbfU/frklj03uUZmT20t35iWEj9+V0zMfrW7t/j9zmb0k5hy9d2cc2cy3r01mR7MnsyQ6OlYa+r1EBavzBxF7Q6lJDAA12OABwwGFIMW1JkxpMTxXZs4NsFMHSqjIhDbDvsINQMQagw3LoeQslIYF5CxqV9fO6ZY9b+G1AVKGbcxCUwLB3jYgCHdB9dxw0qoAR1aCKjlBjahAaOOdwCs29lLzy/gGopIg8yO5jSgpe/xbq8QtHA+KBnpoKtLQWdQDtq4HNSFV9CXgt6gFrT1knjKnu2rkMMLh8Cajs8q2/mZ1NyVd2RX2gDwwaSYY0sDze5AlxVBxT2wGAZsqNDVa9Bkm9DHqvB00K2+x8GFKktPhUA1k0mC0ofC2v0zKm0nD+ITk3LP8YEyGxS7BiNXXCLLESOPgDkUmmYefDfsA5d54chVI3sxBGqx2AL8vAh7d299KNHtNWXQAJ11eFMtQ10rQJ1moa6I60Kb0OqXoKJsg0RTUG0Lz26JxNUR8UQg8vhKCOxnM8uwloLSzU8/qrCnq65vQbtf8XS7x2VL4hX9D24wlYtRuWq2uUJqvKDFuck03tEkrlqtfQ8opOToNLqKXkFtVf0Bb+VwPvrFB7qnbsHfGgFwfyQ2So4s4GLDARfHu+APDy3fO6wVJ3nt5XvoTbSyuDCRAzj2ceP9iRJORXtm9c8GLq73TCndNHbSFSuVxE5rVSaVhEyqCZmVV8QfzTQG+VxV286KutEw8tKK/O15dBG9hP6XLqMJ9CV69e15dOKtmEg1jY4L78WDT88A+vfHL8yGgSIAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"RoIWarp","title":"RoIWarp","src":"/static/0baf3ae7bbf1cc2a8f1b7b18fe42a4e7/b40ed/roi-warp.png","srcSet":["/static/0baf3ae7bbf1cc2a8f1b7b18fe42a4e7/e4891/roi-warp.png 240w","/static/0baf3ae7bbf1cc2a8f1b7b18fe42a4e7/0ce91/roi-warp.png 480w","/static/0baf3ae7bbf1cc2a8f1b7b18fe42a4e7/b40ed/roi-warp.png 786w"],"sizes":["(max-width:","786px)","100vw,","786px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"RoI Warp"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And if you look on data lost/data gain:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"figure","properties":{"className":["image"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 807px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 110.65675340768277%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAC4jAAAuIwF4pT92AAAD7UlEQVQ4y41UXWibVRiOeFF0gpUxmducDAR3sRt34YUwwRsvA4ONXeyHMWkbt1XHEHE3DrdYU9jUXQ7GtOuozfKzC2sLnTFBmzYWt9ophcy2afMl33/+mrRJ+33J4/ue7AuVkekHD+973nO+5zzve95zXK7m90wb8LeFsJ3w7H+sddY//evs7Hyzo6Ojy+12P/8/lgvSTsJewsuEVx6r2YydhN1t5ji2jfA64TVBGYvF3JFI5HwikeiemJjwxONxD1saCzs1NdVD6CZ4JicnPc4aZ578boqf83q9bxPdc650Oj1hWRby+TxyuZywjHK53PI5XiqVUCwWW7GVlRVhNU0Df6FQ6DIR7nGlUqlIoVCAoigbmUymns1mBWhh3RmzVVW1LstyK+bMS5K0Xq1WMTo6+gkRvuCiYHRtbQ2madq0qOGAdhdW1/WGpmoNmm8YhtFQNVXESbXwFVWx6vU6xsbGLojzIIVRTocU2kQO2h1sOZXNY5qHLGchZSQxJsXCT0tpq1arYWRk5FMifNG1tLQU5XowIf/sgJQJS2kKAlMzkdPyMBQDhmqiaBaFr8uGVduwiPCHJqGjkH4UCh2wArZpaRkFdQXXJj/HQf9+nAi+i2PBd3D07gEcDR7A4e/fslLGDOKR35qEdMrR1dVVVmRzWkzEoJqJNBWZ1JVq+HWwF/6L2xHu34fwl3txt/8NhMgOe/dY98ZuYPzGUJNweXk5yi1CNbM5PUFCoAMQ6apZUlwoY2OgHxg4CTv0ERqBs9QnvWjcOYta4LTVHxmG/5Lvwr9SbnsoUhqSWYJ56zLM7w5DC3RB959CPvg+9OFTyNw5aV2J+RH44uqTh+IQMphQHAoT5kooDfahOngM5fAZVIIe1MIfoBLwoBDstr76JYiQ72vuw5dEDSuVStsaqtQqSnEV2ref4e/r7yE5dATJwUOYHzqER2T/vH3Q8o4P4EfftY+JcKtQyDUkEttpEwa3TbNl0ijmq7hJ9Tp+cQt6fLvR1bcTXb4d6OnbhROXtlo/jd/E/fD4efFQcA2flrLYJCtjXp7H3NJDzC0SUg/xSJoT/l8Lf1jWRhXxqcQ58QK168PNN4XuK3RVJxhQslQSWYOp54QvZxW6KeugV6eXCHe4aLHoQ2oT26kfg18YtkzMlttI07VmXVWFamw0r6MiW3bdxoP7D84Q4avchxF+luindVbpgDdg+/hK8sPBG7bm+RDZ0lyN7/Ls7GyPUEiHkuDXgkn5GWPLYNWOz3E+OK61E+POYMvK+ZuZmfmQCPe7ksnkN6QyQcQ/LywsxBYXFwWonWLOmC2tiVG9WzFnnhAh//fp6Wk3Ee76B4+d2hYyXuMQAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"RoIWarp data","title":"RoIWarp data","src":"/static/eb0087f56f93e2191dd180d2dd1769dd/a0800/roi-warp-data.png","srcSet":["/static/eb0087f56f93e2191dd180d2dd1769dd/e4891/roi-warp-data.png 240w","/static/eb0087f56f93e2191dd180d2dd1769dd/0ce91/roi-warp-data.png 480w","/static/eb0087f56f93e2191dd180d2dd1769dd/a0800/roi-warp-data.png 807w"],"sizes":["(max-width:","807px)","100vw,","807px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"RoI Warp data lost/data gain"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We’re only losing a small amount of it due to bilinear interpolation."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"how-roialign-and-roiwarp-affects-the-precision"},"children":[{"type":"element","tagName":"a","properties":{"href":"#how-roialign-and-roiwarp-affects-the-precision","ariaLabel":"how roialign and roiwarp affects the precision permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"How RoIAlign and RoIWarp affects the precision"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If we look at Mask R-CNN paper there are some important numbers to discuss. First one is a change in "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"average precision"}]},{"type":"text","value":" when applying different RoI layers on ResNet-50-C4 with stride 16:"}]},{"type":"text","value":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"type":"element","tagName":"table","properties":{},"children":[{"type":"element","tagName":"thead","properties":{},"children":[{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"th","properties":{},"children":[]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"align?"}]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"bilinear?"}]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"agg."}]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"AP"},{"type":"element","tagName":"sub","properties":{},"children":[{"type":"text","value":" "}]}]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"AP"},{"type":"element","tagName":"sub","properties":{},"children":[{"type":"text","value":"50"}]}]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"AP"},{"type":"element","tagName":"sub","properties":{},"children":[{"type":"text","value":"75"}]}]}]}]},{"type":"element","tagName":"tbody","properties":{},"children":[{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"RoIPool"}]},{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"max"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"26.9"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"48.8"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"26.4"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"RoIWarp"}]},{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"✓"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"max"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"27.2"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"49.2"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"27.1"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"✓"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"ave"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"27.1"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"48.9"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"27.1"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"RoIAlign"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"✓"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"✓"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"max"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"30.2"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"51.0"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"31.8"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"✓"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"✓"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"ave"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"30.3"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"51.2"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"31.5"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There is only a small improvement when RoIWarp is applied but applying RoIAlign gives us a significant boost in precision. That boost increases with stride:"}]},{"type":"text","value":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"type":"element","tagName":"table","properties":{},"children":[{"type":"element","tagName":"thead","properties":{},"children":[{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"th","properties":{},"children":[]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"AP"},{"type":"element","tagName":"sup","properties":{},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"sub","properties":{},"children":[{"type":"text","value":" "}]}]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"AP"},{"type":"element","tagName":"sup","properties":{},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"sub","properties":{},"children":[{"type":"text","value":"50"}]}]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"AP"},{"type":"element","tagName":"sup","properties":{},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"sub","properties":{},"children":[{"type":"text","value":"75"}]}]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"AP"},{"type":"element","tagName":"sup","properties":{},"children":[{"type":"text","value":"bb"}]},{"type":"element","tagName":"sub","properties":{},"children":[{"type":"text","value":" "}]}]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"AP"},{"type":"element","tagName":"sup","properties":{},"children":[{"type":"text","value":"bb"}]},{"type":"element","tagName":"sub","properties":{},"children":[{"type":"text","value":"50"}]}]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"AP"},{"type":"element","tagName":"sup","properties":{},"children":[{"type":"text","value":"bb"}]},{"type":"element","tagName":"sub","properties":{},"children":[{"type":"text","value":"75"}]}]}]}]},{"type":"element","tagName":"tbody","properties":{},"children":[{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"RoIPool"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"23.6"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"46.5"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"21.6"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"28.2"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"52.7"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"26.9"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"RoIAlign"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"30.9"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"51.8"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"32.1"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"34.0"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"55.3"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"36.4"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"+7.3"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"+5.3"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"+10.5"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"+5.8"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"+2.6"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"+9.5"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Where "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"AP"},{"type":"element","tagName":"sup","properties":{},"children":[{"type":"text","value":"bb"}]},{"type":"element","tagName":"sub","properties":{},"children":[{"type":"text","value":" "}]}]},{"type":"text","value":" is an average precision for detecting bounding boxes. The test is done on ResNet-50-C5 with stride 32."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"summary"},"children":[{"type":"element","tagName":"a","properties":{"href":"#summary","ariaLabel":"summary permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Summary"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Understanding RoI Pooling is important when we want to improve our R-CNN-like model accuracy. There is a significant difference between the standard approach proposed in the 2014 paper about Fast R-CNN and a new one proposed in the 2018 paper about Mask R-CNN. It doesn’t mean those methods apply only to specific networks, we can easily use RoIAlign in Fast R-CNN and RoIPooling in Mask R-CNN but you have to remember that RoIAlign gives us better precision on average."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"I really hope that my explanation is easy to understand because I’ve seen a lot of post writing about RoI Pooling without getting into calculations. In my opinion, a more visual approach is always better, especially if you don’t want to spend a whole day reading the original paper over and over to finally understand what it does."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"references"},"children":[{"type":"element","tagName":"a","properties":{"href":"#references","ariaLabel":"references permalink","className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"References:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"R. Girshick. Fast R-CNN. In ICCV, 2014 "},{"type":"element","tagName":"a","properties":{"href":"https://arxiv.org/pdf/1504.08083.pdf"},"children":[{"type":"text","value":"https://arxiv.org/pdf/1504.08083.pdf"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"J. Dai, K. He, and J. Sun. Instance-aware semantic segmentation via multi-task network cascades. In CVPR, 2016 "},{"type":"element","tagName":"a","properties":{"href":"https://arxiv.org/pdf/1512.04412.pdf"},"children":[{"type":"text","value":"https://arxiv.org/pdf/1512.04412.pdf"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"K. He, G. Gkioxari, P. Dollar and R. Girshick. Mask R-CNN In ICCV, 2018 "},{"type":"element","tagName":"a","properties":{"href":"https://arxiv.org/pdf/1703.06870.pdf"},"children":[{"type":"text","value":"https://arxiv.org/pdf/1703.06870.pdf"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"style","properties":{"className":["grvsc-styles"]},"children":[{"type":"text","value":"\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n"}]}],"data":{"quirksMode":false}}}},"pageContext":{"slug":"/2020/02/understanding-region-of-interest-part-2-ro-i-align"}}}